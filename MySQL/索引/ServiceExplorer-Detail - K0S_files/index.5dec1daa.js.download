var Ya=Object.defineProperty;var ma=Object.getOwnPropertySymbols;var Ja=Object.prototype.hasOwnProperty,Za=Object.prototype.propertyIsEnumerable;var Bt=(l,a,n)=>a in l?Ya(l,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[a]=n,Ct=(l,a)=>{for(var n in a||(a={}))Ja.call(a,n)&&Bt(l,n,a[n]);if(ma)for(var n of ma(a))Za.call(a,n)&&Bt(l,n,a[n]);return l};var Ge=(l,a,n)=>(Bt(l,typeof a!="symbol"?a+"":a,n),n);import{d as he,b as i,i as ze,_ as o,o as s,c as P,V as e,u as m,a as c,M as y,S as U,O as t,U as D,F as oe,av as Re,aw as Ne,e as Pe,Z as Fe,a3 as de,a5 as et,T as v,I as Be,A as Vt,ac as ot,al as ct,n as Va,J as st,x as nt,D as Qa,$ as Qe,h as Xa,E as Qt,H as va,G as Sa,a4 as el,ax as tl,ap as al}from"./@vue.c36d63e3.js";import{a as ll}from"./axios.70cb0bcf.js";import{c as nl}from"./vuex.dfd3fd7a.js";import{E as ye,a as Gt,b as kt,c as ol,i as sl}from"./element-plus.2ab311c4.js";import{h as mt}from"./moment.08a7f518.js";import{u as Da,a as Ue,o as Xt,c as rl,b as il}from"./vue-router.de1fc801.js";import{U as ul}from"./vue-echarts.39e4a0b3.js";import{M as tt,P as Ia,Q as It,R as dl,S as _a,T as Ra,t as cl,x as Ut,U as pl,V as ml,y as vl,W as _l,X as fl,w as Wt,A as Me,Y as St,_ as je,i as Pt,Z as Lt,$ as gl,a0 as yl,a1 as hl,a2 as bl,a3 as ea,a4 as wl,a5 as Cl,k as At,a6 as kl,a7 as ta,o as pt,v as $l,h as xl,m as Vl,a8 as Sl,a9 as Dl,aa as Il,ab as fa,ac as Rt,ad as Rl,ae as Na,f as Nl,q as Ul,af as ga,ag as Et,ah as Pl,ai as Ua,aj as Pa,g as Yt,ak as Al,l as El,al as Tl,am as Gl,an as Ll,F as Ol,ao as zl,ap as Ml,c as Aa}from"./@element-plus.006bd8a6.js";import{e as Ke}from"./monaco-editor.503e44a9.js";import{l as $t}from"./lodash.e2b20cba.js";import{j as Kt}from"./js-yaml.2f0635e4.js";import{u as ql,a as Hl,b as jl,c as Fl,d as Bl,e as Kl,f as Wl,g as Yl,i as Jl}from"./echarts.2d529afb.js";import"./lodash-es.032e1c7e.js";import"./@vueuse.b2b7b25e.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./dayjs.bfe651f5.js";import"./async-validator.ed4c92a2.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.1c4ac15a.js";import"./@floating-ui.ca37b337.js";import"./resize-detector.4e96b72b.js";import"./zrender.c3ab0193.js";const Zl=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const u of _.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function n(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerpolicy&&(_.referrerPolicy=p.referrerpolicy),p.crossorigin==="use-credentials"?_.credentials="include":p.crossorigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(p){if(p.ep)return;p.ep=!0;const _=n(p);fetch(p.href,_)}};Zl();class Ql{GetJwtToken(){return window.NeweggPlatform.generateJwtToken("k0s").then(a=>a)}DisableSearchPanel(){window.NeweggPlatform.disableSearchPanel()}EnableSearchPanel(a){window.NeweggPlatform.enableSearchPanel({placeholder:"name of group or service",doSearch:function(n){a(n)},allowEmpty:!1,width:450})}ClearSearchValue(){window.NeweggPlatform.clearSearchValue()}ShowLoading(){window.NeweggPlatform.showLoading()}HideLoading(){window.NeweggPlatform.hideLoading()}WatchSession(a){window.NeweggPlatform.watchReleasePortalSession(a)}}const vt=new Ql,Xl={gatewayPath:"https://apis.newegg.org",portalAddress:"http://dev.newegg.org",apiRoot:"http://10.16.217.40:8565"};class en{async GetUserAuth(){return ce.Get("/webapi/system/userRoles",{disableLoading:!0})}async GetEggKeeperData(a){return ce.Get(`${Xl.gatewayPath}/eggkeeper/v2${a}/_rawdata`,{disableLoading:!0})}async GetNeweggUser(a){return ce.Get("/webapi/common/newegg/user?query="+a,{disableLoading:!0})}async GetNeweggGroup(a){return ce.Get("/webapi/common/newegg/group?query="+a)}async GetGroupList(a){let n=`?pageIndex=${a.pageIndex}&pageSize=${a.pageSize}`;return a.name&&(n+=`&name=${a.name}`),a.soxId&&(n+=`&soxId=${a.soxId}`),ce.Get("/webapi/service-management/group/list"+n)}async CreateGroup(a){return ce.Post("/webapi/service-management/group",a)}async UpdateGroup(a){return ce.Put("/webapi/service-management/group/"+a.id,a).then(this.iniGroup)}async DeleteGroup(a){return ce.Delete("/webapi/service-management/group?id="+a)}async GetGroup(a){return ce.Get("/webapi/service-management/group?id="+a)}async GetServiceList(a){let n=`?groupId=${a.groupId}&pageIndex=${a.pageIndex}&pageSize=${a.pageSize}`;return a.name&&(n+=`&name=${a.name}`),a.kind&&(n+=`&kind=${a.kind}`),a.tag&&(n+=`&tag=${a.tag}`),ce.Get(`/webapi/service-management/${a.groupId}/service/list${n}`)}async CreateService(a){return ce.Post(`/webapi/service-management/${a.groupId}/service`,a)}async UpdateService(a){return ce.Put(`/webapi/service-management/${a.groupId}/service`,a).then(this.initService)}async DeleteService(a,n){return ce.Delete(`/webapi/service-management/${a}/service?id=${n}`)}async GetService(a,n){return ce.Get(`/webapi/service-management/${a}/service?id=${n}`)}async GetGroupTags(a){return ce.Get(`/webapi/service-management/${a}/tags`)}async GetVersionBase(a,n){let d=`?sid=${n.sid}&pageIndex=${n.pageIndex}&pageSize=${n.pageSize}`;return n.name&&(d+=`&name=${n.name}`),n.cluster&&(d+=`&cluster=${n.cluster}`),ce.Get(`/webapi/service-management/${a}/version/base${d}`)}async GetVersion(a,n){return ce.Get(`/webapi/service-management/${a}/version?vid=${n}`)}async GetVersionCluster(a,n,d,p){return ce.Get(`/webapi/service-management/${a}/version/cluster?vid=${n}&cluster=${d}&kind=${p}`)}async UpsertVersion(a,n){return ce.Post(`/webapi/service-management/${a}/version`,n)}async UpsertVersionWithCanary(a,n){return ce.Post(`/webapi/service-management/${a}/version/canary`,n)}async CopyVersion(a,n){return ce.Post(`/webapi/service-management/${a}/version/copy`,n)}async DeleteVersion(a,n){return ce.Delete(`/webapi/service-management/${a}/version?vid=${n}`)}async GetOption(){return ce.Get("/webapi/service-management/option")}async GetInstance(a,n,d){return ce.Get(`/webapi/service-management/${a}/instance?sid=${n}&cluster=${d}`,{disableLoading:!0})}async GetInstanceCluster(a,n){return ce.Get(`/webapi/service-management/${a}/instance/cluster?sid=${n}`,{disableLoading:!1})}async UnDeploy(a,n){return ce.Post(`/webapi/service-management/${a}/version/undeploy`,n)}async Deploy(a,n){return ce.Post(`/webapi/service-management/${a}/version/deploy`,n)}async ImportVersionCluster(a,n){return ce.Post(`/webapi/service-management/${a}/version/import`,n)}async GetDeployCount(a){let n=`?vid=${a.vid}`;return a.sid&&(n+=`&sid=${a.sid}`),a.cluster&&(n+=`&cluster=${a.cluster}`),ce.Get(`/webapi/service-management/${a.gid}/deploy/count${n}`)}initService(a){return ie.commit("setCurrentService",void 0),a}iniGroup(a){return ie.commit("setCurrentGroup",void 0),a}formatDate(a){return mt(a).format("YYYY-MM-DD HH:mm:ss")}async GetCanaryConfigList(){return ce.Get("/webapi/canary/config/list",{disableLoading:!0})}async GetCanaryConfigDetail(a,n){return ce.Get(`/webapi/canary/config/version/${a}/cluster/${n}`,{disableLoading:!0})}async UpdateCanaryConfigDetail(a){return ce.Post("/webapi/canary/config",a,{disableLoading:!0})}async CreateCanaryConfigDetail(a){return ce.Put("/webapi/canary/config",a,{disableLoading:!0})}async GetCanaryConfigByService(a){return ce.Get(`/webapi/canary/config/service/${a}`,{disableLoading:!0})}async StartCanaryAnalysis(a,n){return ce.Post(`/webapi/canary/start/analysis/${n}`,a,{disableLoading:!0})}async GetCanaryAnalysisByVersionAndCluster(a,n,d){return ce.Get(`/webapi/canary/analysis/status/version/${a}/${n}/${d}`,{disableLoading:!0})}async EndCanaryAnalysis(a,n){return ce.Post(`/webapi/canary/end/analysis/${n}`,a,{disableLoading:!0})}async GetCanaryAnalysisByCluster(a,n){return ce.Get(`/webapi/canary/analysis/status/cluster/${a}/${n}`,{disableLoading:!0})}}const fe=new en,ie=nl({state:{isAdmin:!1,isLogin:!1,jwtToken:void 0,expireDate:void 0,viewStatus:"ReadOnly",viewStatusBool:!1,jiraId:"",windowHeight:window.innerHeight,windowWidth:window.innerWidth,currentGroup:void 0,currentService:void 0,serviceManageOption:void 0,userAuth:void 0,searchStore:{},canaryConfig:[],canaryStatus:[]},mutations:{setUserIsAdmin(l,a){l.isAdmin=a},setUserIsLogin(l,a){l.isLogin=a},setUserToken(l,a){l.jwtToken=a.token,l.expireDate=a.expireDate},setViewStatus(l,a){l.viewStatus=a},setViewStatusBool(l,a){l.viewStatusBool=a},setJiraId(l,a){l.jiraId=a},setWindowWidth(l,a){l.windowWidth=a},setWindowHeight(l,a){l.windowHeight=a},setCurrentGroup(l,a){l.currentGroup=a},setCurrentService(l,a){l.currentService=a},setServiceManageOption(l,a){l.serviceManageOption=a},setUserAuth(l,a){l.userAuth=a},setSearchStore(l,a){l.searchStore[a.key]=a},setCanaryConfig(l,a){l.canaryConfig=a},setCanaryStatus(l,a){l.canaryStatus=a}},getters:{IsLogin(l){return l.isLogin},IsAdmin(l){return l.isAdmin},ViewStatus(l){return l.viewStatus},ViewStatusBool(l){return l.viewStatusBool},JiraId(l){return l.jiraId},setJiraId(l,a){l.jiraId=a},Token(l){return l.jwtToken},ExpireTime(l){return l.expireDate},WindowHeight(l){return l.windowHeight},WindowWidth(l){return l.windowWidth},SearchStore(l){return l.searchStore},CurrentGroup:l=>async a=>{if(l.currentGroup&&l.currentGroup.id==a)return l.currentGroup;let d=(await fe.GetGroup(a)).data;return l.currentGroup=d,d},CurrentService:l=>async a=>{if(l.currentService&&l.currentService.id==a)return l.currentService;let n=await fe.GetService(0,a);return l.currentService=n.data,l.currentService},ServiceManageOption:l=>async()=>{if(l.serviceManageOption)return l.serviceManageOption;let a=await fe.GetOption();l.serviceManageOption=a.data,l.serviceManageOption.resource={low:a.data.resource.low,middle:a.data.resource.middle,large:a.data.resource.large},l.serviceManageOption.soxMap={};for(let n of l.serviceManageOption.sox)l.serviceManageOption.soxMap[n.code]=n;return l.serviceManageOption},UserAuth(l){return l.userAuth},GroupUserAuth:l=>a=>l.userAuth.groups[a],EditAuth:l=>a=>{let n=l.userAuth;return n.isAdmin?!0:!!n.groups[a]},CanaryConfig(l){return l.canaryConfig},CanaryStatus(l){return l.canaryStatus}},actions:{async login({commit:l,state:a}){if(!a.isLogin){await this.dispatch("checkToken");const n=await nn.CheckUserIsAdmin(),d=await fe.GetUserAuth();vt.WatchSession(tn),l("setUserIsLogin",!0),l("setUserIsAdmin",n.data),l("setUserAuth",d.data)}},async checkToken({commit:l,state:a}){if(a.expireDate==null||mt.utc().valueOf()>=a.expireDate){const n=await vt.GetJwtToken();l("setUserToken",n)}}},modules:{}}),tn=l=>{l?(l.jiraIdList&&l.jiraIdList.length>0&&ie.commit("setJiraId",l.jiraIdList.join(",")),ie.getters.ViewStatus!="Operation"&&!ie.getters.ViewStatusBool&&(ie.commit("setViewStatus","Operation"),ie.commit("setViewStatusBool",!0))):(ie.commit("setJiraId",""),ie.getters.IsAdmin&&!ie.getters.ViewStatusBool&&ie.getters.ViewStatus!="Operation"&&(ie.commit("setViewStatus","Operation"),ie.commit("setViewStatusBool",!0)),!ie.getters.IsAdmin&&ie.getters.ViewStatus!="ReadOnly"&&ie.getters.ViewStatusBool&&(ie.commit("setViewStatus","ReadOnly"),ie.commit("setViewStatusBool",!1)))};class an{async request(a,n,d,p){p||(p={}),p.disableLoading||vt.ShowLoading();let _={Accept:"application/json, text/javascript, */*"};if(a!=="GET"&&a!=="DELETE"&&(_["Content-Type"]="application/json"),p&&p.headers&&typeof p.headers=="object")for(let u in p.headers)_[u]=p.headers[u];return a!="GET"&&(p.params?p.params.jiraId=ie.getters.JiraId:p.params={jiraId:ie.getters.JiraId}),await ll.request({url:n,method:a,data:d,headers:_,params:p.params,timeout:6e4}).catch(u=>{throw p.disableErrMsg||(console.log(u),ye.error(u.response&&u.response.data&&u.response.data.msg?u.response.data.msg:u.message)),u}).finally(()=>{p.disableLoading||vt.HideLoading()})}GetDefaultOption(){let a={};return a["x-dev-platform-jwt-auth"]=ie.getters.Token,{headers:a}}async Get(a,n){return this.request("GET",a,null,n)}async Put(a,n,d){return this.request("PUT",a,n,d)}async Post(a,n,d){return this.request("POST",a,n,d)}async Delete(a,n){return this.request("DELETE",a,null,n)}}const ce=new an;class ln{async CheckUserIsAdmin(){return ce.Get("/webapi/system/isAdmin")}}const nn=new ln;class on{async DashboardStatistics(){return ce.Get("/webapi/dashboard/statistics").then(a=>a.data)}async GetDeployStatisticsCount(a,n){return ce.Get(`/webapi/dashboard/statistics/deploy?startDate=${a}&endDate=${n}`).then(d=>d.data)}}const ya=new on;class sn{async SearchActivitys(a){return ce.Post("/webapi/common/activity/search",a).then(n=>n.data)}}const rn=new sn;class un{async SearchImageTags(a,n,d){let p={domain:a,isDetail:!1,type:"tag",project:n,repsitory:d,tag:""};return ce.Post("/webapi/image/searchImage",p,{disableLoading:!0}).then(_=>_.data)}async SearchImageProject(a,n){let d={domain:a,isDetail:!1,type:"project",project:n,repsitory:"",tag:""};return ce.Post("/webapi/image/searchImage",d,{disableLoading:!0}).then(p=>p.data)}async SearchImageRepository(a,n,d){let p={domain:a,isDetail:!1,type:"repository",project:n,repsitory:d,tag:""};return ce.Post("/webapi/image/searchImage",p,{disableLoading:!0}).then(_=>_.data)}}const Tt=new un;class dn{async GetClusterInfo(){return ce.Get("/webapi/system/config")}async GetCrdList(a){return ce.Post("/webapi/crd-management/crds",a)}async GetCrdById(a){return ce.Get("/webapi/crd-management/crd",a)}async GetCrdWorkLoads(a){return ce.Get("/webapi/crd-management/crd/workloads",a)}async GetCrsInfo(a){return ce.Get("/webapi/crd-management/crs",a)}async GetCrdKinds(){return ce.Get("/webapi/crd-management/crd/kinds")}async GetCrDetail(a){return ce.Get("/webapi/crd-management/cr/meta",a)}async InsertCrd(a){return ce.Post("/webapi/crd-management/crd",a)}async UpdateCrd(a){return ce.Put("/webapi/crd-management/crd",a)}async ReDeploy(a){return ce.Post("/webapi/crd-management/cr/redeploy",a)}}const Oe=new dn;class cn{async GlobalSearch(a){return ce.Get(`/webapi/common/globalsearch/${a}`,{disableLoading:!0,disableErrMsg:!0}).then(n=>n.data)}async GetWorkLoadResource(a){return ce.Get("/webapi/common/workload/resource",a)}async ApplyDeployWorkLoad(a,n){return ce.Post("/webapi/common/workload/deploy",a,n)}async GetResourceList(a){return ce.Post("/webapi/common/resourceList",a)}async GetDeployNamespace(a){return ce.Get("/webapi/common/deploy-namespaces",a)}async GetRepositoryList(a){return ce.Get("/webapi/chart/repository",a)}async GetChartList(a,n){return ce.Get(`/webapi/chart/list/${a}`,n)}async GetChartVersionList(a,n,d){return ce.Get(`/webapi/chart/list/${a}/${n}`,d)}async GetChartVersionDetail(a,n,d,p){return ce.Get(`/webapi/chart/detail/${a}/${n}/${d}`,p)}}const qe=new cn;class pn{async GetNamespaces(a){return ce.Get("/webapi/meta/namespaces",a)}async InsertNamespace(a){return ce.Post("/webapi/meta/namespace",a)}async UpdateNamespace(a){return ce.Put("/webapi/meta/namespace",a)}async DeleteNamespace(a,n){return ce.Delete(`/webapi/meta/${a}/namespace/${n}`).then(d=>d.data)}}const Dt=new pn,mn=he({props:{title:null,dateView:{type:Boolean},dateSelect:null},setup(l){const a=l,n=[];i(),i(""),i("");const d=i(["",""]),p=i({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},title:{text:a.title,left:"center"},xAxis:{type:"category",data:n},yAxis:{type:"value"},series:[{data:n,type:"line",smooth:!0}]});ze(()=>{let u=new Date;u.setDate(u.getDate()),d.value[1]=mt(u).format("YYYY-MM-DD"),u.setDate(u.getDate()-30),d.value[0]=mt(u).format("YYYY-MM-DD"),_()});function _(){a.dateSelect(d.value[0],d.value[1]).then(u=>{p.value.xAxis.data=u.dataX,p.value.series=[{data:u.dataY,type:"line",smooth:!0}]})}return(u,g)=>{const f=o("el-date-picker");return s(),P("div",null,[e(m(ul),{class:"chart",option:p.value,style:{height:"500px"}},null,8,["option"]),c("div",null,[l.dateView?(s(),y(f,{key:0,style:{"margin-left":"700px"},modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=C=>d.value=C),type:"daterange","range-separator":"To","unlink-panels":"","start-placeholder":"Start date","value-format":"YYYY-MM-DD","end-placeholder":"End date",onChange:_},null,8,["modelValue"])):U("",!0)])])}}});var ke=(l,a)=>{const n=l.__vccOpts||l;for(const[d,p]of a)n[d]=p;return n};const at=l=>(Re("data-v-36fe53f0"),l=l(),Ne(),l),vn=at(()=>c("div",{class:"card-header"},[c("strong",null,"Group")],-1)),_n={class:"card-body"},fn={class:"body-value"},gn=at(()=>c("div",{style:{"font-size":"12px","line-height":"16px","padding-top":"45px"}},"Total",-1)),yn=at(()=>c("div",{class:"card-header"},[c("strong",null,"Service")],-1)),hn={class:"card-body"},bn={class:"body-value"},wn=at(()=>c("div",{style:{"font-size":"12px","padding-top":"45px"}},"Total",-1)),Cn=at(()=>c("div",{class:"card-header"},[c("strong",null,"Version")],-1)),kn={class:"card-body"},$n={class:"body-value"},xn=at(()=>c("div",{style:{"font-size":"12px","padding-top":"45px"}},"Total",-1)),Vn=at(()=>c("div",{class:"card-header"},[c("strong",null,"Deploy")],-1)),Sn={class:"card-body"},Dn={class:"body-value"},In=at(()=>c("div",{style:{"font-size":"12px","padding-top":"45px"}},"Total",-1)),Rn=he({setup(l){let a=i({total:{group:0,service:0,version:0,deploy:0}});ze(()=>{ya.DashboardStatistics().then(d=>{a.value=d})});const n=(d,p)=>ya.GetDeployStatisticsCount(d,p).then(_=>({dataX:_.map(g=>g.date),dataY:_.map(g=>g.count.toString())}));return(d,p)=>{const _=o("el-card"),u=o("el-col"),g=o("el-row");return s(),P(oe,null,[e(g,{gutter:20},{default:t(()=>[e(u,{span:6},{default:t(()=>[e(_,null,{default:t(()=>[vn,c("div",_n,[c("div",fn,D(m(a).total.group),1),gn])]),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(_,null,{default:t(()=>[yn,c("div",hn,[c("div",bn,D(m(a).total.service),1),wn])]),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(_,null,{default:t(()=>[Cn,c("div",kn,[c("div",$n,D(m(a).total.version),1),xn])]),_:1})]),_:1}),e(u,{span:6},{default:t(()=>[e(_,null,{default:t(()=>[Vn,c("div",Sn,[c("div",Dn,D(m(a).total.deploy),1),In])]),_:1})]),_:1})]),_:1}),e(mn,{style:{"margin-top":"50px"},"date-view":!1,dateSelect:n,title:"Deploy in Past 30 Days"})],64)}}});var Nn=ke(Rn,[["__scopeId","data-v-36fe53f0"]]);class Un{async GetNamespace(a){return ce.Get("/webapi/service-explorer/namespaces/"+a,{disableLoading:!0})}async GetCluster(){return ce.Get("/webapi/service-explorer/cluster",{disableLoading:!0})}async GetPodLogs(a,n,d,p,_,u){return ce.Get(`/webapi/service-explorer/pod/logs/${a}/${n}/${d}/${p}/${_}/${u}`,{disableErrMsg:!0})}async GetPodDetail(a,n,d){return ce.Get(`/webapi/service-explorer/pod/detail/${a}/${n}/${d}`)}async GetPodMetrics(a,n,d,p){return ce.Get(`/webapi/service-explorer/pod/metrics/${a}/${n}/${d}/${p}`)}async GetNamespaceResource(a,n){return ce.Get(`/webapi/service-explorer/namespace/resource/${a}/${n}`)}async DeletePodMetrics(a,n,d){return ce.Delete(`/webapi/service-explorer/pod/delete/${a}/${n}/${d}`)}async GetServiceExplorer(a,n,d,p,_){return ce.Get(`/webapi/service-explorer/search/${a}/${n}/${p}/${_}?keyword=${d}`)}async GetServiceDetail(a,n,d,p,_){return ce.Get(`/webapi/service-explorer/detail/${a}/${n}/${d}/${p}${_==""?"":"/"}${_}`,{disableLoading:!0})}async UpdateHPA(a,n){return ce.Put("/webapi/service-explorer/hpa/update/"+a,n,ce.GetDefaultOption())}async GetEvents(a,n,d,p,_,u){return ce.Get(`/webapi/service-explorer/events/${a}/${n}/${d}/${p}/${_}/${u}`,{disableLoading:!0})}async RestartDeployment(a,n,d){return ce.Put(`/webapi/service-explorer/restart/${a}/${n}/${d}`,"")}async GetAlerts(a,n,d){return ce.Get(`/webapi/service-explorer/alerts/${a}/${n}/${d}`)}}const Ae=new Un;function ft(l){let a=new Date(l*1e3),n=a.getFullYear()+"-",d=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",p=a.getDate()<10?"0"+a.getDate()+" ":a.getDate()+" ",_=a.getHours()<10?"0"+a.getHours()+":":a.getHours()+":",u=a.getMinutes()<10?"0"+a.getMinutes()+":":a.getMinutes()+":",g=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return n+d+p+_+u+g}function Ot(l){const a=Math.floor(l%31536e3/86400),n=Math.floor(l%31536e3%86400/3600),d=Math.floor(l%31536e3%86400%3600/60),p=l%31536e3%86400%3600%60;return a>0?`${a}d${n}h`:n>0?`${n}h${d}m`:d>0?`${d}m${p}s`:`${p}s`}function Pn(l){return l.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,n){return+a==0?"":n===0?a.toLowerCase():a.toUpperCase()})}const zt=l=>(Re("data-v-18e3b467"),l=l(),Ne(),l),An={class:"common-layout"},En=zt(()=>c("div",{class:"title"},[c("h2",null,"Service Explorer")],-1)),Tn={style:{display:"flex"}},Gn=zt(()=>c("span",{style:{"margin-right":"30px"}},"Cluster",-1)),Ln=zt(()=>c("span",{style:{"margin-right":"40px"}}," Namespace ",-1)),On=zt(()=>c("h3",{style:{margin:"0px"}},"Service ",-1)),zn={style:{"margin-left":"auto","margin-right":"15px","font-width":"bold",color:"#909399"}},Mn=he({setup(l){const[a,n]=[Da(),Ue()],d=20,p=i(),_=i([]),u=i({cluster:a.params.cluster?a.params.cluster.toString():"e11qk8s",namespace:a.params.namespace?a.params.namespace.toString():"all",keyword:"",currentPage:1}),g=i(""),f=i(""),C=i([]),r=i(!1),b=i(!1),T=i(0),k=i([]),S=i([]),x=i([]),E=i(!1),z=i({minReplicas:0,maxReplicas:0,currentReplicas:0,setMetric:[],currentMetric:[],apiVersion:""}),[te,F]=[i(""),i("")],h=()=>{Ae.GetCluster().then(ae=>{k.value=ae.data.map(j=>({value:j,label:j.toUpperCase()}))});let X=ie.getters.SearchStore.explorer;X&&X.route===n.currentRoute.value.path&&(u.value=X.data),u.value.cluster!=""&&N(u.value.cluster)};Pe(()=>u.value.namespace,Z=>{Z&&(u.value.keyword="",B(u.value.cluster,Z,"",1),n.push({path:`/service-explorer/${u.value.cluster}/${Z}`}))});const V=Z=>{_.value=Z},I=()=>{b.value=!1},w=()=>{r.value=!1},G=(Z,X)=>{C.value=X,r.value=!0},J=()=>{B(u.value.cluster,u.value.namespace,u.value.keyword)},H=Z=>{B(u.value.cluster,u.value.namespace,u.value.keyword,Z)},N=Z=>{!Z||(S.value=[],Ae.GetNamespace(Z).then(X=>{S.value=X.data.map(ae=>({value:ae,label:ae})),S.value.sort((ae,j)=>ae.value>j.value?1:-1),J()}))},A=(Z,X)=>{f.value=X,b.value=!0,g.value=Z},Y=(Z,X,ae,j)=>{te.value=Z,F.value=X,Ae.GetServiceDetail(u.value.cluster,te.value,F.value,ae,j==null?"":j).then(K=>{z.value=K.data.hpa,E.value=!0})},R=()=>{E.value=!1},O=Z=>Z?Z.map(X=>X.restartCount).reduce((X,ae)=>X+ae):0,$=Z=>{const X=parseInt((new Date().getTime()/1e3).toFixed(0));return Ot(X-Z)},L=Z=>Z.replicas==0?"UnAvailable":Z.replicas==Z.availableReplicas?"Available":"Pending",W=Z=>Z&&Z["app.canary.suffixname"]?Z["app.canary.suffixname"]:"",B=(Z,X,ae,j=u.value.currentPage)=>{let K={key:"explorer",route:n.currentRoute.value.path,data:u.value};Ae.GetServiceExplorer(Z,X,ae,d,j).then(M=>{x.value=M.data.apps,x.value.sort((se,be)=>se.name>be.name?1:-1),T.value=M.data.page.pageTotal,u.value.currentPage=j,ie.commit("setSearchStore",K)})};return h(),(Z,X)=>{const ae=o("el-header"),j=o("el-option"),K=o("el-select"),M=o("el-form-item"),se=o("el-button"),be=o("el-input"),Ve=o("el-form"),ve=o("router-link"),le=o("el-table-column"),Se=o("el-tooltip"),ge=o("el-table"),ne=o("el-pagination"),ee=o("el-footer"),Q=o("el-card"),_e=o("el-main"),$e=o("el-container");return s(),P("div",An,[e($e,null,{default:t(()=>[e(ae,{class:"el-header"},{default:t(()=>[En]),_:1}),e(_e,{style:{"maring-top":"20px"}},{default:t(()=>[e(Ve,{onSubmit:X[4]||(X[4]=Fe(re=>J(),["prevent"]))},{default:t(()=>[c("div",Tn,[e(M,null,{default:t(()=>[e(K,{filterable:"",modelValue:u.value.cluster,"onUpdate:modelValue":X[0]||(X[0]=re=>u.value.cluster=re),onChange:N,placeholder:"Select Cluster..."},{prefix:t(()=>[Gn]),default:t(()=>[(s(!0),P(oe,null,de(k.value,re=>(s(),y(j,{key:re.value,label:re.label,value:re.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(M,null,{default:t(()=>[e(K,{filterable:"",modelValue:u.value.namespace,"onUpdate:modelValue":X[1]||(X[1]=re=>u.value.namespace=re),placeholder:"Select Cluster..."},{prefix:t(()=>[Ln]),default:t(()=>[e(j,{label:"--ALL--",value:"all"}),(s(!0),P(oe,null,de(S.value,re=>(s(),y(j,{key:re.value,label:re.label,value:re.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(M,{style:{width:"800px"}},{default:t(()=>[e(be,{modelValue:u.value.keyword,"onUpdate:modelValue":X[2]||(X[2]=re=>u.value.keyword=re),placeholder:"Keyword...",onKeyup:X[3]||(X[3]=et(re=>J(),["enter","native"]))},{append:t(()=>[e(se,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})])]),_:1}),e(Q,{class:"box-card"},{default:t(()=>[e(ae,{style:{padding:"0px",display:"flex"}},{default:t(()=>[On,c("div",zn,"Total: "+D(T.value),1)]),_:1}),e(ge,{ref_key:"multipleTableRef",ref:p,data:x.value,style:{width:"100%"},onSelectionChange:V},{default:t(()=>[e(le,{label:"Name","min-width":"220"},{default:t(re=>[e(ve,{to:{path:`/service-detail/${u.value.cluster}/${re.row.namespace}/${re.row.name}/${re.row.realName?re.row.realName:re.row.name}${W(re.row.labels)?`/${W(re.row.labels)}`:""}`}},{default:t(()=>[v(D(re.row.name),1)]),_:2},1032,["to"])]),_:1}),e(le,{label:"Service","min-width":"120"},{default:t(re=>[e(m(sm),{servicePorts:re.row.service?re.row.service.ports:[]},null,8,["servicePorts"])]),_:1}),e(le,{label:"PodStatus","min-width":"180"},{default:t(re=>[re.row.pod!=null?(s(),y(m(nm),{key:0,pods:re.row.pod,namespace:re.row.namespace,onPodClick:A},null,8,["pods","namespace"])):U("",!0)]),_:1}),e(le,{label:"Replicas","show-overflow-tooltip":"","min-width":"100"},{default:t(re=>[c("span",{class:Be({warn:re.row.status.replicas!==re.row.status.readyReplicas,down:re.row.status.replicas===re.row.status.readyReplicas&&re.row.status.replicas===0,success:re.row.status.replicas===re.row.status.readyReplicas})},D(re.row.status.readyReplicas)+"/"+D(re.row.status.replicas),3)]),_:1}),e(le,{label:"HPA","show-overflow-tooltip":"",width:"180"},{default:t(re=>[re.row.hpa!=null?(s(),y(Se,{key:0,class:"box-item",effect:"dark",content:"Edit HPA Setting",placement:"top"},{default:t(()=>[e(m(dm),{hpa:re.row.hpa,class:"hpa",onClick:Le=>Y(re.row.namespace,re.row.name,re.row.realName,re.row.canaryName)},null,8,["hpa","onClick"])]),_:2},1024)):U("",!0)]),_:1}),e(le,{label:"Restart","show-overflow-tooltip":"","min-width":"80"},{default:t(re=>[c("span",{class:Be({warn:O(re.row.pod)>0,error:O(re.row.pod)>10})},D(O(re.row.pod)),3)]),_:1}),e(le,{label:"Age","show-overflow-tooltip":"","min-width":"90"},{default:t(re=>[c("span",null,D($(re.row.createTime)),1)]),_:1}),e(le,{label:"Status","show-overflow-tooltip":"",width:"100"},{default:t(re=>[c("span",{class:Be({success:L(re.row.status)==="Available",warn:L(re.row.status)=="Pending",notify:L(re.row.status)=="UnAvailable"})},D(L(re.row.status)),3)]),_:1})]),_:1},8,["data"]),e(ee,{style:{"margin-top":"20px",height:"30px","padding-right":"0px"}},{default:t(()=>[e(ne,{currentPage:u.value.currentPage,"onUpdate:currentPage":X[5]||(X[5]=re=>u.value.currentPage=re),layout:"total,prev, pager, next",total:T.value,"page-size":d,onCurrentChange:H,style:{float:"right"}},null,8,["currentPage","total"])]),_:1})]),_:1}),e(m(ia),{isOpen:r.value,cluster:u.value.cluster,namespace:u.value.namespace,pod:f.value,containers:C.value,onClose:w},null,8,["isOpen","cluster","namespace","pod","containers"]),e(m(ja),{isOpen:b.value,cluster:u.value.cluster,namespace:g.value,pod:f.value,onClose:I,onOpenLog:G},null,8,["isOpen","cluster","namespace","pod"]),e(m(Fa),{isOpen:E.value,onClose:R,cluster:u.value.cluster,namespace:m(te),service:m(F),hpa:z.value},null,8,["isOpen","cluster","namespace","service","hpa"])]),_:1})]),_:1})])}}});var ha=ke(Mn,[["__scopeId","data-v-18e3b467"]]);function Ea(l,a,n){if(l===4)return!0;if(l===1)return a.toLowerCase()==="e9k8s";if(l===2||l===3)if(n){if(ie.getters.ViewStatusBool)return!0}else return!0;return!1}const lt=l=>(Re("data-v-0ea69e68"),l=l(),Ne(),l),qn={class:"title",style:{"margin-bottom":"10px"}},Hn={class:"title",style:{"align-items":"flex-end","margin-left":"20px"}},jn={style:{"margin-right":"20px",display:"flex","align-items":"center"}},Fn={style:{"margin-right":"20px",display:"flex","align-items":"center"}},Bn={key:0,style:{"margin-right":"20px",display:"flex","align-items":"center"}},Kn={key:0,style:{display:"flex","align-items":"center"}},Wn={style:{"margin-left":"auto"}},Yn=v(" Restart "),Jn={style:{"text-align":"center"}},Zn=v(" Restart Deployment will "),Qn=lt(()=>c("span",{style:{color:"red","font-weight":"bold"}},"rebuild each pod",-1)),Xn=v(","),eo=lt(()=>c("br",null,null,-1)),to=v("Please confirm that "),ao=lt(()=>c("span",{style:{color:"red","font-weight":"bold"}},"config",-1)),lo=v(" has no change and "),no=lt(()=>c("span",{style:{color:"red","font-weight":"bold"}},"readiness",-1)),oo=v(" valid before restarting "),so=lt(()=>c("br",null,null,-1)),ro=v("Confirm and Restart "),io=v(" Events "),uo={key:1},co=lt(()=>c("h5",null,"Pods",-1)),po={class:"metrics"},mo={class:"right"},vo=lt(()=>c("h5",null,"Restarts",-1)),_o={class:"metrics"},fo=lt(()=>c("h5",null,"Status",-1)),go={class:"metrics"},yo=v(" Alert "),ho={style:{"margin-top":"5px","margin-bottom":"5px",color:"red"}},bo={style:{"font-weight":"bold"}},wo=["href"],Co=he({setup(l){const a=Da(),n=Ue(),[d,p,_,u,g]=[i(a.params.cluster),i(a.params.namespace),i(a.params.service),i(a.params.realName),i(a.params.canaryName)],f=i(""),C=i(""),r=i(""),b=i("true"),T=i(""),k=i(!1),S=i(!1),x=i(null),E=i(!1),z=i([]),te=A=>{Ae.GetServiceDetail(d.value,p.value,_.value,u.value,g.value==null?"":g.value).then(Y=>{if(x.value=Y.data,Y.data.labels){let R=Y.data.labels;f.value=R["k0s.app.group"]||"",T.value=R["k0s.app.version"]||"",C.value=R["k0s.app.serviceName"]||"",r.value=R["k0s.app.serviceId"]||"",b.value=R["k0s.app.primary"]||"",F()}}),A&&Ae.GetAlerts(d.value,p.value,_.value).then(Y=>{const O=Y.data.filter($=>{try{const L=$.alerts[0].labels;if(L.pod&&L.pod.startsWith(_.value)||L.job&&L.job===_.value||L.service&&L.service===_.value||L.container&&L.container===_.value)return!0}catch{}});z.value=O})};function F(){let A=ie.getters.UserAuth;if(A.isAdmin){E.value=!0;return}if(!f.value||f.value==="")return;let Y=Object.values(A.groups).find(O=>O.name===f.value);if(!Y)return;let R=Y.auth;ie.getters.ServiceManageOption().then(O=>{let $=O.cluster[d.value];$&&(E.value=Ea(R,$.name,$.isPrd))})}te(!0);let h=setInterval(()=>te(!1),5e3);Vt(()=>{clearInterval(h)});const V=()=>{Ae.RestartDeployment(d.value,p.value,u.value).then(A=>{})},I=()=>{k.value=!1},w=()=>{S.value=!1},G=()=>{window.history.length>2?n.go(-1):n.push(`/service-explorer/${d.value}/${p.value}`)},J=()=>{if(f.value==="")return;const A={name:f.value,pageIndex:1,pageSize:10,soxId:""};fe.GetGroupList(A).then(Y=>{const O=Y.data.data.filter($=>$.name==f.value);O.length==1?n.push(`/service-management/${O[0].id}/service`):alert("Can't find K0S Group")})},H=()=>{if(f.value===""||r.value==="")return;const A={name:f.value,pageIndex:1,pageSize:10,soxId:""};fe.GetGroupList(A).then(Y=>{const O=Y.data.data.filter($=>$.name==f.value);if(O.length==1){const $=O[0].id;n.push(`/service-management/${$}/service/${r.value}/detail/instance?cluster=${d.value}`)}else alert("Can't find K0S Group")})},N=A=>A?A.map(Y=>Y.Status.restartCount).reduce((Y,R)=>Y+R):0;return(A,Y)=>{const R=o("el-icon"),O=o("el-button"),$=o("el-tooltip"),L=o("el-popover"),W=o("el-skeleton"),B=o("el-card"),Z=o("el-col"),X=o("el-row"),ae=o("el-tag"),j=o("el-collapse-item"),K=o("el-collapse");return s(),P("div",null,[c("div",qn,[e(O,{link:"",onClick:G},{default:t(()=>[e(R,null,{default:t(()=>[e(m(Ia))]),_:1})]),_:1}),c("h1",null,D(m(_)),1)]),c("div",Hn,[e($,{content:"K8S Cluster"},{default:t(()=>[c("div",jn,[e(R,{size:15},{default:t(()=>[e(m(It))]),_:1}),v(D(m(d)),1)])]),_:1}),e($,{content:"K8S Namespace"},{default:t(()=>[c("div",Fn,[e(R,{size:15},{default:t(()=>[e(m(dl))]),_:1}),v(D(m(p)),1)])]),_:1}),f.value?(s(),y($,{key:0,content:"K0S Group"},{default:t(()=>[f.value?(s(),P("div",{key:0,style:{"margin-right":"20px",display:"flex","align-items":"center"},class:"r-link",onClick:J},[e(R,{size:15},{default:t(()=>[e(m(_a))]),_:1}),v(" "+D(f.value),1)])):U("",!0)]),_:1})):U("",!0),f.value&&C.value&&r.value?(s(),y($,{key:1,content:"K0S Service"},{default:t(()=>[f.value&&C.value&&r.value?(s(),P("div",{key:0,style:{"margin-right":"20px",display:"flex","align-items":"center"},class:"r-link",onClick:H},[e(R,{size:15},{default:t(()=>[e(m(_a))]),_:1}),v(" "+D(C.value),1)])):U("",!0)]),_:1})):U("",!0),T.value?(s(),y($,{key:2,content:"K0S Version"},{default:t(()=>[T.value?(s(),P("div",Bn,[e(R,{size:15},{default:t(()=>[e(m(Ra))]),_:1}),v(D(T.value),1)])):U("",!0)]),_:1})):U("",!0),m(g)&&m(g)!="default"?(s(),y($,{key:3,content:"K0S Canary"},{default:t(()=>[m(g)?(s(),P("div",Kn,[e(R,{size:15},{default:t(()=>[e(m(cl))]),_:1}),v(" "+D(m(g)),1)])):U("",!0)]),_:1})):U("",!0),c("div",Wn,[E.value?(s(),y(L,{key:0,placement:"bottom",width:300,trigger:"click"},{reference:t(()=>[e(O,{plan:"",type:"warning",style:{"margin-right":"0px"}},{default:t(()=>[e(R,{style:{"margin-right":"5px"}},{default:t(()=>[e(m(Ut))]),_:1}),Yn]),_:1})]),default:t(()=>[c("div",Jn,[Zn,Qn,Xn,eo,to,ao,lo,no,oo,so,e(O,{plan:"",type:"warning",onClick:V,style:{"margin-right":"0px"}},{default:t(()=>[e(R,{style:{"margin-right":"5px"}},{default:t(()=>[e(m(Ut))]),_:1}),ro]),_:1})])]),_:1})):U("",!0),e(O,{plan:"",type:"success",onClick:Y[0]||(Y[0]=M=>S.value=!0)},{default:t(()=>[e(R,{style:{"margin-right":"5px"}},{default:t(()=>[e(m(pl))]),_:1}),io]),_:1})])]),x.value==null?(s(),y(W,{key:0,rows:4,animated:""})):U("",!0),x.value!=null?(s(),P("div",uo,[e(X,null,{default:t(()=>[e(Z,{span:10,class:"container padding"},{default:t(()=>[e(X,{gutter:12},{default:t(()=>[e(Z,{span:7},{default:t(()=>[e(B,{class:"metrics-card",shadow:"always","body-style":{padding:"12px"}},{default:t(()=>[co,c("div",po,[c("h2",null,[e(R,null,{default:t(()=>[e(m(ml))]),_:1})]),c("h2",mo,D(x.value.pod?x.value.pod.length:0),1)])]),_:1})]),_:1}),e(Z,{span:7},{default:t(()=>[e(B,{class:"metrics-card",shadow:"always","body-style":{padding:"12px"}},{default:t(()=>[vo,c("div",_o,[c("h2",null,[e(R,null,{default:t(()=>[e(m(vl))]),_:1})]),c("h2",{class:Be(["right",{warn:N(x.value.pod)>0,success:N(x.value.pod)===0}])},D(N(x.value.pod)),3)])]),_:1})]),_:1}),e(Z,{span:10},{default:t(()=>[e(B,{class:"metrics-card",shadow:"always","body-style":{padding:"12px"}},{default:t(()=>[fo,c("div",go,[c("h2",null,[e(R,null,{default:t(()=>[x.value.status.availableReplicas===x.value.status.replicas?(s(),y(m(_l),{key:0})):U("",!0),x.value.status.availableReplicas!==x.value.status.replicas?(s(),y(m(fl),{key:1})):U("",!0)]),_:1})]),c("h2",{class:Be(["right",{warn:x.value.status.availableReplicas!==x.value.status.replicas,success:x.value.status.availableReplicas===x.value.status.replicas}])},D(x.value.status.availableReplicas===x.value.status.replicas?"Available":"NotReady"),3)])]),_:1})]),_:1})]),_:1}),e(K,{class:"alert",style:{"background-color":"#007acc"}},{default:t(()=>[e(j,{name:"1"},{title:t(()=>[yo,e(ae,{effect:"dark",type:z.value.length>0?"danger":"",style:{"margin-left":"10px"}},{default:t(()=>[v(D(z.value.length),1)]),_:1},8,["type"])]),default:t(()=>[(s(!0),P(oe,null,de(z.value,M=>(s(),y(B,{style:{"margin-bottom":"10px"}},{default:t(()=>[c("h4",ho,D(M.labels.alertname),1),(s(!0),P(oe,null,de(M.alerts,se=>(s(),P("div",null,[c("div",bo,D(se.annotations.summary),1),v(" "+D(se.annotations.description)+" ",1),c("a",{href:se.generatorURL},"more...",8,wo)]))),256))]),_:2},1024))),256))]),_:1})]),_:1}),e(m(jv),{serviceDetail:x.value},null,8,["serviceDetail"])]),_:1}),e(Z,{span:14,class:"container"},{default:t(()=>[e(m(Sv),{service:x.value.service},null,8,["service"]),e(m(Pv),{isOpen:k.value,onClose:I,cluster:m(d),namespace:m(p),service:m(_),hpa:x.value.hpa},null,8,["isOpen","cluster","namespace","service","hpa"]),e(m(Lv),{ingress:x.value.ingress},null,8,["ingress"]),e(m(f_),{isOpen:S.value,onClose:w,cluster:m(d),namespace:m(p),service:m(_)},null,8,["isOpen","cluster","namespace","service"])]),_:1}),e(Z,{span:24,class:"container"},{default:t(()=>[e(m(wv),{cluster:m(d),namespace:m(p),podList:x.value.pod},null,8,["cluster","namespace","podList"])]),_:1})]),_:1})])):U("",!0)])}}});var ba=ke(Co,[["__scopeId","data-v-0ea69e68"]]);const ko={},$o={style:{"text-align":"center"}},xo=c("h1",null,"401",-1),Vo=c("h3",{class:"font-bold"},"No Permission",-1),So=c("div",{class:"error-desc"}," Please check your account. ",-1),Do=[xo,Vo,So];function Io(l,a){return s(),P("div",$o,Do)}var Ro=ke(ko,[["render",Io]]);const No={},Uo={style:{"text-align":"center"}},Po=c("h1",null,"404",-1),Ao=c("h3",{class:"font-bold"},"Page Not Found",-1),Eo=c("div",{class:"error-desc"}," Sorry, but the page you are looking for has note been found. Try checking the URL for error, then hit the refresh button on your browser or try found something else in our app. ",-1),To=[Po,Ao,Eo];function Go(l,a){return s(),P("div",Uo,To)}var Lo=ke(No,[["render",Go]]);const Ta=l=>(Re("data-v-6cef4425"),l=l(),Ne(),l),Oo={key:0,class:"search-card"},zo=Ta(()=>c("div",{class:"card-header"},[c("strong",null,"Groups")],-1)),Mo={key:0},qo=["v-if"],Ho={key:1,class:"item notfound"},jo=v(" No Group Found. "),Fo=Ta(()=>c("div",{class:"card-header"},[c("strong",null,"Services")],-1)),Bo={key:0},Ko=["v-if"],Wo={key:1,class:"item notfound"},Yo=v(" No Service Found. "),Jo={key:1,class:"search-card"},Zo=v(" Press Enter for searching group and service. "),Qo=he({props:{globalSearchData:null,enabled:{type:Boolean},keywords:null},setup(l){const a=l;return Ue(),(n,d)=>{const p=o("router-link"),_=o("el-icon"),u=o("el-card"),g=o("el-row");return s(),P(oe,null,[a.enabled&&a.keywords?(s(),P("div",Oo,[e(u,{class:"box-card",shadow:"never"},{header:t(()=>[zo]),default:t(()=>[a.globalSearchData.groups.length?(s(),P("div",Mo,[(s(!0),P(oe,null,de(a.globalSearchData.groups,f=>(s(),P("div",{key:f.groupId,class:"item","v-if":f.groupId},[e(p,{to:{path:`/service-management/${f.groupId}/service`}},{default:t(()=>[v(D(f.groupName),1)]),_:2},1032,["to"])],8,qo))),128))])):U("",!0),a.globalSearchData.groups.length?U("",!0):(s(),P("div",Ho,[e(_,{size:15},{default:t(()=>[e(m(Wt))]),_:1}),jo]))]),_:1}),e(u,{class:"box-card",shadow:"never"},{header:t(()=>[Fo]),default:t(()=>[a.globalSearchData.services.length?(s(),P("div",Bo,[(s(!0),P(oe,null,de(a.globalSearchData.services,f=>(s(),P("div",{"v-if":f.groupId&&f.serviceId,key:f.groupId,class:"item"},[e(g,null,{default:t(()=>[v(D(f.groupName)+" / ",1)]),_:2},1024),e(g,null,{default:t(()=>[e(p,{to:{path:`/service-management/${f.groupId}/service/${f.serviceId}/detail/instance`}},{default:t(()=>[v(D(f.serviceName),1)]),_:2},1032,["to"])]),_:2},1024)],8,Ko))),128))])):U("",!0),a.globalSearchData.services.length?U("",!0):(s(),P("div",Wo,[e(_,{size:15},{default:t(()=>[e(m(Wt))]),_:1}),Yo]))]),_:1})])):U("",!0),a.enabled&&!a.keywords?(s(),P("div",Jo,[e(u,{class:"box-card content",shadow:"never"},{default:t(()=>[Zo]),_:1})])):U("",!0)],64)}}});var Xo=ke(Qo,[["__scopeId","data-v-6cef4425"]]);const es=["id"],ts=he({props:{type:{required:!0,type:String,default:"simple"},language:{required:!1,type:String,default:"yaml"},readOnly:{required:!1,type:Boolean,default:!1},contextVal:{required:!1,type:String,default:""},oldContent:{required:!1,type:String,default:""},newContent:{required:!1,type:String,default:""},height:{required:!1,type:Number,default:400},theme:{required:!1,type:String,default:"vs-dark"}},emits:["change"],setup(l,{emit:a}){const n=l,{type:d,language:p,readOnly:_,contextVal:u,oldContent:g,newContent:f,height:C}=ot(n),r=i(),b=i();Pe(u,x=>{!S()&&k()!==x&&T()}),Pe(f,x=>{S()&&k()!==x&&T()}),Pe(d,()=>{T()}),Pe(_,()=>{T()}),Pe(p,()=>{S()?(Ke.setModelLanguage(ct(b.value).getModifiedEditor().getModel(),p==null?void 0:p.value),Ke.setModelLanguage(ct(b.value).getOriginalEditor().getModel(),p==null?void 0:p.value)):Ke.setModelLanguage(ct(b.value).getModel(),p==null?void 0:p.value)}),ze(()=>{T()});const T=()=>{Va(()=>{if(r.value&&(r.value.innerHTML=""),S()){let x=Ke.createDiffEditor(r.value,{enableSplitViewResizing:!1,readOnly:n.readOnly,theme:n.theme,lineNumbers:"on"});const E=Ke.createModel(n.oldContent,n.language),z=Ke.createModel(n.newContent,n.language);x.setModel({original:E,modified:z}),x.getModifiedEditor().onDidChangeModelContent(()=>{a("change",k())}),b.value=x}else b.value=Ke.create(r.value,{readOnly:n.readOnly,value:n.contextVal,language:n.language,lineNumbers:"on",automaticLayout:!0,theme:n.theme}),b.value.onDidChangeModelContent(()=>{a("change",k())})})},k=()=>S()?ct(b.value).getModifiedEditor().getValue():ct(b.value).getValue(),S=()=>(d==null?void 0:d.value)==="edit";return Vt(()=>{b.value&&(b.value="")}),(x,E)=>(s(),P("div",{id:new Date().getTime().toString()+"_monaco",style:st(`height: ${m(C)}px`),ref_key:"editorRef",ref:r},null,12,es))}});var xt=ke(ts,[["__scopeId","data-v-0b4e25a2"]]);const as={style:{"text-decoration":"underline"}},Nt=he({props:{timestamp:{type:Number,required:!0}},setup(l){const a=l,{timestamp:n}=ot(a),d=i(Array(60,60,24)),p={MILLISECONDS_PER_SECOND:1e3,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,DAYS_PER_MONTH:30,DAYS_PER_YEAR:365,MONTHS_PER_YEAR:12},_=i(),u=i("-");ze(()=>{g()}),Pe(n,()=>{g()});const g=()=>{const k=C(b());u.value=r(k),_.value=setInterval(()=>{u.value=r(k)},k*1e3)},f=nt(()=>ft(a.timestamp));Qa(()=>{clearInterval(_.value),_.value=null});const C=k=>{let S=0,x=1;for(;S<d.value.length&&k/d.value[S]>=1;)k/=d.value[S],S++;for(;S>0;)x*=d.value[--S];return x};function r(k){if(k<=0)return"-";const S=T(),x=Math.floor(S/p.MILLISECONDS_PER_SECOND),E=Math.floor(x/p.SECONDS_PER_MINUTE),z=Math.floor(E/p.MINUTES_PER_HOUR),te=Math.floor(z/p.HOURS_PER_DAY),F=Math.floor(te/p.DAYS_PER_MONTH),h=Math.floor(te/p.DAYS_PER_YEAR);return x<1?"0 second ago":E<1?x+" seconds ago":z<1?E+" minutes ago":te<1?z+" hours ago":F<1?te+" days ago":h<1?F+" months ago":h+" years ago"}const b=()=>Math.floor(T()/1e3),T=()=>new Date().getTime()-a.timestamp*1e3;return(k,S)=>{const x=o("el-tooltip");return s(),y(x,{class:"box-item",effect:"dark",content:m(f),placement:"top"},{default:t(()=>[c("span",as,D(u.value),1)]),_:1},8,["content"])}}});function Jt(l){return Gt.confirm(l,"",{type:"warning",confirmButtonText:"Yes",cancelButtonText:"No",closeOnClickModal:!1,closeOnPressEscape:!1,dangerouslyUseHTMLString:!1})}function Ze(l){ye({type:"success",showClose:!0,dangerouslyUseHTMLString:!0,message:l})}function ls(l){ye({type:"warning",showClose:!0,dangerouslyUseHTMLString:!0,message:l})}function wa(l){ye({type:"error",showClose:!0,dangerouslyUseHTMLString:!0,message:l})}let We="WebService",_t="Console",Ca="Job",Xe="HelmRelease";var ns={id:"",name:"",kind:"WebService",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",namespace:"",clusterName:[],ingressClusters:[],formTags:[],repository:"",chart:"",helmChart:""};const aa=l=>(Re("data-v-e6e0746a"),l=l(),Ne(),l),os={class:"app-container"},ss=aa(()=>c("div",null,[c("h1",null,"CRD")],-1)),rs={style:{display:"flex"}},is=aa(()=>c("span",{style:{"margin-right":"30px"}}," Cluster ",-1)),us=aa(()=>c("span",{style:{"vertical-align":"middle"}}," Add CRD ",-1)),ds={class:"table-container"},cs={class:"table-container"},ps={class:"expand-crds"},ms=v(" Edit "),vs=v(" Log "),_s=v(" Delete "),fs=v(" Delete "),gs=v(" Edit "),ys={key:0,style:{margin:"20px"}},hs={class:"dialog-footer"},bs=v("Cancel"),ws=v("Apply"),Cs={key:0,style:{margin:"6px"}},ks={class:"dialog-footer"},$s={style:{"margin-right":"10px"}},xs=v("Cancel"),Vs=v("Apply"),Ss=he({setup(l){const a=i(1),n=i(25),d=i([]),p=i(!1),_=i(""),u=i(!1),g=i(450),f="100px",C=i({}),r=i(!1),b=i(""),T=i(),k=i({id:0,name:"",image:"",apiVersion:"v1",crdVersion:"",kind:"WebService",api:"crd.newegg.org",checkCluster:"",yamlDate:""}),S=i(""),x=i({}),E=i(Array()),z=i(Array()),te=i(Array()),F=i(0),h=i([]),V=Qe({cluster:"",keyword:""}),I=i(Array()),w=i(),G=Qe({name:[{required:!0,message:"Please input name",trigger:"blur"}],crdVersion:[{required:!0,message:"Please input crd version",trigger:"blur"}],checkCluster:[{required:!0,message:"Please check cluster",trigger:"blur"}]}),J=i(!1),H=Qe({cluster:"",namespace:"",podName:"",containers:[""]}),N=ue=>{A(ue==null?void 0:ue.id),_.value="Edit CRD",p.value=!0,r.value=!0},A=async ue=>{const me={params:{id:ue}},q=await Oe.GetCrdById(me),pe=q==null?void 0:q.data;pe&&(k.value.id=ue,k.value.name=pe.resource,k.value.api=pe.api,k.value.kind=pe.kind,k.value.crdVersion=pe.imageVersion,k.value.image=pe.image,k.value.yamlDate=pe.yamlData,k.value.checkCluster=pe.env)},Y=ue=>{ue.container&&(H.podName=ue.name,H.cluster=S.value,H.namespace=C.value.namespace,H.containers.length=0,ue.container.forEach(me=>{H.containers.push(me.name)}),J.value=!0)},R=ue=>{b.value="";const me={params:{type:"deployment",name:ue.name,namespace:ue.namespace,cluster:S.value}};O(me),u.value=!0},O=async ue=>{const me=await qe.GetWorkLoadResource(ue);me&&(b.value=me.data)},$=ue=>{debugger;const me=ue==null?void 0:ue.name,q=C.value.namespace;Jt("Delete the Pod [ "+me+" ]?").then(()=>{L(q,me)})},L=async(ue,me)=>{await Ae.DeletePodMetrics(S.value,ue,me),Ze("Delete success."),await M(S.value)},W=ue=>{const me=ue==null?void 0:ue.name,q=C.value.namespace;Jt("Delete the ConfigMap [ "+me+" ]?").then(pe=>{B(q,me)}).catch(pe=>{})},B=async(ue,me)=>{await Ae.DeletePodMetrics(S.value,ue,me),Ze("Delete success."),await M(S.value)};ze(()=>{Z()});const Z=async()=>{const ue=await Oe.GetClusterInfo(),me=ue==null?void 0:ue.data.envs;I.value=Object.keys(me).map(q=>({name:q})),await X()},X=async()=>{var we;let ue=[];V.cluster?ue.push(V.cluster):I.value&&I.value.forEach(Te=>{ue.push(Te.name)});const me={cluster:ue,crdName:V.keyword,pageSize:n.value,pageIndex:a.value},q=await Oe.GetCrdList(me),pe=q==null?void 0:q.data;F.value=pe==null?void 0:pe.page.pageTotal,h.value=(we=pe==null?void 0:pe.crds)!=null?we:[]},ae=()=>{X()},j=ue=>{T.value.setCurrentRow(ue),K(ue)},K=ue=>{const me=ue==null?void 0:ue.env;x.value=ue,S.value=ue==null?void 0:ue.env,d.value.length>0?ue.id==d.value[0]?(d.value.pop(),T.value.setCurrentRow(null),S.value="",x.value={},se()):(d.value[0]=ue.id,se(),M(me)):(d.value.push(ue.id),M(me))},M=async ue=>{const me={params:{cluster:ue,kind:x.value.kind}},q=await Oe.GetCrdWorkLoads(me),pe=q==null?void 0:q.data;pe&&(se(),C.value=pe,be(pe.deployment)||E.value.push(pe.deployment),be(pe.pod)||(z.value=z.value.concat(pe.pod)),be(pe.configMap)||te.value.push(pe.configMap))},se=()=>{C.value={},E.value.length=0,z.value.length=0,te.value.length=0},be=ue=>ue===null||ue==null||ue==="",Ve=ue=>ue==null?void 0:ue.id,ve=()=>{X()},le=ue=>{n.value=ue,X()},Se=ue=>{a.value=ue,X()},ge=(ue,me)=>{const q=ue[me.property];return q===""?"":ft(new Date(q).getTime()/1e3)},ne=()=>{p.value=!1,k.value.checkCluster="",k.value.yamlDate="",w.value.resetFields(),r.value=!1},ee=()=>{u.value=!1},Q=()=>{k.value.id=0,_.value="Add CRD",p.value=!0,r.value=!1},_e=()=>{p.value=!1,r.value=!1},$e=()=>{u.value=!1},re=()=>{if(b.value&&b.value.trim()){const ue=b.value.trim(),me={headers:{"Content-Type":"text/html"},params:{cluster:S.value}};qe.ApplyDeployWorkLoad(ue,me).then(q=>{var pe;Ze((pe=q.data.msg)!=null?pe:"Apply Success.")}).finally(()=>{u.value=!1})}else ls("Data must be exist,got empty.")},Le=()=>{J.value=!1},Ye=async ue=>{!ue||await ue.validate(me=>{me&&He()})},He=()=>{var me,q;const ue={id:(me=k.value.id)!=null?me:0,api:k.value.api,version:k.value.apiVersion,kind:k.value.kind,resource:k.value.name,env:k.value.checkCluster,imageVersion:k.value.crdVersion,image:k.value.image,yamlData:(q=k.value.yamlDate)==null?void 0:q.trim()};ue.id===0?Oe.InsertCrd(ue).then(pe=>{var we;Ze((we=pe.data.msg)!=null?we:"Add Crd Success!"),p.value=!1,X()}):Oe.UpdateCrd(ue).then(pe=>{var we;Ze((we=pe.data.msg)!=null?we:"Update Crd Success!"),p.value=!1,X()})},it=ue=>{k.value.yamlDate=ue},ht=ue=>{b.value=ue};return(ue,me)=>{const q=o("el-option"),pe=o("el-select"),we=o("el-form-item"),Te=o("el-button"),ut=o("el-input"),Je=o("el-form"),De=o("el-table-column"),bt=o("el-tab-pane"),wt=o("el-tag"),Ft=o("el-tabs"),xe=o("el-pagination"),ca=o("el-radio"),Ka=o("el-radio-group"),Wa=o("el-card"),pa=o("el-dialog");return s(),P("div",os,[ss,e(Je,{onSubmit:me[3]||(me[3]=Fe(Ce=>ae(),["prevent"]))},{default:t(()=>[c("div",rs,[e(we,null,{default:t(()=>[e(pe,{modelValue:m(V).cluster,"onUpdate:modelValue":me[0]||(me[0]=Ce=>m(V).cluster=Ce),onChange:ve,placeholder:"Select Cluster..."},{prefix:t(()=>[is]),default:t(()=>[e(q,{label:"--ALL--",value:""}),(s(!0),P(oe,null,de(I.value,Ce=>{var Ie;return s(),y(q,{label:(Ie=Ce.name)==null?void 0:Ie.toUpperCase(),value:Ce.name},null,8,["label","value"])}),256))]),_:1},8,["modelValue"])]),_:1}),e(we,{style:{width:"800px"}},{default:t(()=>[e(ut,{clearable:"",style:{width:"100%"},modelValue:m(V).keyword,"onUpdate:modelValue":me[1]||(me[1]=Ce=>m(V).keyword=Ce),placeholder:"Enter CRD name",onKeyup:me[2]||(me[2]=et(Ce=>ae(),["enter","native"]))},{append:t(()=>[e(Te,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),m(ie).getters.IsAdmin?(s(),y(we,{key:0,style:{"margin-left":"10px"}},{default:t(()=>[e(Te,{type:"primary",onClick:Q,plain:"",icon:m(Me)},{default:t(()=>[us]),_:1},8,["icon"])]),_:1})):U("",!0)])]),_:1}),c("div",ds,[c("div",cs,[e(m(kt),{data:h.value,ref_key:"singleTableRef",ref:T,border:"",stripe:"","highlight-current-row":"","table-layout":"fixed","row-key":Ve,"expand-row-keys":d.value,onRowClick:K,onExpandChange:j},{default:t(()=>[e(De,{type:"expand",class:"expand-class"},{default:t(Ce=>[c("div",ps,[e(Ft,{"tab-position":"top",type:"border-card"},{default:t(()=>[e(bt,{label:"Deployments"},{default:t(()=>[e(m(kt),{data:E.value,border:"",style:{width:"100%"}},{default:t(()=>[e(De,{prop:"name",label:"Name"}),e(De,{prop:"namespace",label:"Namespace"}),e(De,{prop:"replicas",label:"Replicas",width:"100px"}),e(De,{prop:"image",label:"Image","min-width":"170px"}),e(De,{prop:"createTime",label:"Age",width:"140px"},{default:t(Ie=>[e(Nt,{timestamp:Ie.row.createTime},null,8,["timestamp"])]),_:2},1024),e(De,{label:"Operate",align:"center",width:"120px"},{default:t(({row:Ie})=>[e(Te,{size:"small",onClick:dt=>R(Ie)},{default:t(()=>[ms]),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])]),_:2},1024),e(bt,{label:"Pods"},{default:t(()=>[e(m(kt),{data:z.value,border:"",style:{width:"100%"}},{default:t(()=>[e(De,{prop:"name",label:"Name"}),e(De,{label:"Images","show-overflow-tooltip":""},{default:t(Ie=>[(s(!0),P(oe,null,de(Ie.row.container,dt=>(s(),y(wt,{key:dt.image},{default:t(()=>[v(D(dt.image),1)]),_:2},1024))),128))]),_:2},1024),e(De,{prop:"Status.restartCount",label:"Restarts",width:"80px"}),e(De,{prop:"Status.nodeName",label:"Node",width:"220px"}),e(De,{prop:"createTime",label:"Age",width:"140px"},{default:t(Ie=>[e(Nt,{timestamp:Ie.row.Status.createTime},null,8,["timestamp"])]),_:2},1024),e(De,{label:"Status",width:"90px"},{default:t(Ie=>[e(wt,{type:Ie.row.Status.state==="Running"?"success":"warning"},{default:t(()=>[v(D(Ie.row.Status.state),1)]),_:2},1032,["type"])]),_:2},1024),e(De,{label:"Operate",align:"center",width:"200px"},{default:t(Ie=>[e(Te,{size:"small",onClick:dt=>Y(Ie.row)},{default:t(()=>[vs]),_:2},1032,["onClick"]),e(Te,{size:"small",onClick:dt=>$(Ie.row)},{default:t(()=>[_s]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024),e(bt,{label:"ConfigMaps"},{default:t(()=>[e(m(kt),{data:te.value,border:"",style:{width:"100%"}},{default:t(()=>[e(De,{prop:"name",label:"Name",width:"350px"}),e(De,{prop:"namespace",label:"Namespace",width:"150px"}),e(De,{prop:"keys",label:"Keys"},{default:t(Ie=>[v(D(Ie.row.keys.toString()),1)]),_:2},1024),e(De,{prop:"createTime",label:"Age",width:"140px"},{default:t(Ie=>[e(Nt,{timestamp:Ie.row.createTime},null,8,["timestamp"])]),_:2},1024),e(De,{label:"Operate",align:"center",width:"100px"},{default:t(Ie=>[e(Te,{size:"small",onClick:dt=>W(Ie.row)},{default:t(()=>[fs]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:2},1024)]),_:2},1024)])]),_:1}),e(De,{type:"index",align:"center"}),e(De,{prop:"resource",resizable:"",label:"Name"}),e(De,{label:"Api",resizable:""},{default:t(Ce=>[v(D(Ce.row.api)+"/"+D(Ce.row.version),1)]),_:1}),e(De,{prop:"imageVersion",resizable:"",label:"CRD Version",width:"120px"}),e(De,{prop:"env",label:"Cluster",resizable:"",width:"150px"},{default:t(Ce=>{var Ie;return[v(D((Ie=Ce.row.env)==null?void 0:Ie.toUpperCase()),1)]}),_:1}),e(De,{prop:"inUser",label:"Create User",resizable:"",width:"100px"}),e(De,{prop:"inDate",label:"Create Date",formatter:ge,resizable:""}),e(De,{prop:"lastEditUser",label:"Edit User",resizable:"",width:"100px"}),e(De,{prop:"lastEditDate",label:"Edit Date",formatter:ge,resizable:""}),m(ie).getters.IsAdmin?(s(),y(De,{key:0,label:"Operate",align:"center","class-name":"fixed-width",width:"150px"},{default:t(({row:Ce})=>[e(Te,{size:"small",icon:m(St),onClick:Fe(Ie=>N(Ce),["stop"])},{default:t(()=>[gs]),_:2},1032,["icon","onClick"])]),_:1})):U("",!0)]),_:1},8,["data","expand-row-keys"])]),e(xe,{class:"pagination",background:"","page-sizes":[25,50,75,100],"hide-on-single-page":"",total:F.value,currentPage:a.value,"onUpdate:currentPage":me[4]||(me[4]=Ce=>a.value=Ce),"page-size":n.value,"onUpdate:page-size":me[5]||(me[5]=Ce=>n.value=Ce),onSizeChange:le,onCurrentChange:Se,layout:"total, sizes, prev, pager, next, jumper"},null,8,["total","currentPage","page-size"])]),e(pa,{modelValue:p.value,"onUpdate:modelValue":me[14]||(me[14]=Ce=>p.value=Ce),title:_.value,width:"70%",top:"8vh",onClose:ne},{footer:t(()=>[c("span",hs,[e(Te,{onClick:_e},{default:t(()=>[bs]),_:1}),m(ie).getters.IsAdmin?(s(),y(Te,{key:0,type:"primary",onClick:me[13]||(me[13]=Ce=>Ye(w.value))},{default:t(()=>[ws]),_:1})):U("",!0)])]),default:t(()=>[e(Je,{ref_key:"dialogForm",ref:w,inline:!0,model:k.value,rules:m(G)},{default:t(()=>[e(we,{label:"Kind","label-width":f,prop:"kind"},{default:t(()=>[e(pe,{modelValue:k.value.kind,"onUpdate:modelValue":me[6]||(me[6]=Ce=>k.value.kind=Ce)},{default:t(()=>[e(q,{label:m(We),value:m(We)},null,8,["label","value"]),e(q,{label:m(Ca),value:m(Ca)},null,8,["label","value"]),e(q,{label:m(_t),value:m(_t)},null,8,["label","value"])]),_:1},8,["modelValue"])]),_:1}),e(we,{label:"Api","label-width":f,prop:"api"},{default:t(()=>[e(pe,{modelValue:k.value.api,"onUpdate:modelValue":me[7]||(me[7]=Ce=>k.value.api=Ce)},{default:t(()=>[e(q,{label:"crd.newegg.org",value:"crd.newegg.org"}),e(q,{label:"devops.newegg.org",value:"devops.newegg.org"})]),_:1},8,["modelValue"])]),_:1}),e(we,{label:"Api Version","label-width":f,prop:"apiVersion"},{default:t(()=>[e(pe,{modelValue:k.value.apiVersion,"onUpdate:modelValue":me[8]||(me[8]=Ce=>k.value.apiVersion=Ce)},{default:t(()=>[e(q,{label:"v1",value:"v1"})]),_:1},8,["modelValue"])]),_:1}),e(we,{label:"CRD Name","label-width":f,prop:"name"},{default:t(()=>[e(ut,{modelValue:k.value.name,"onUpdate:modelValue":me[9]||(me[9]=Ce=>k.value.name=Ce),modelModifiers:{trim:!0},autocomplete:"off",maxlength:"30"},null,8,["modelValue"])]),_:1}),e(we,{label:"CRD Version","label-width":f,prop:"crdVersion"},{default:t(()=>[e(ut,{modelValue:k.value.crdVersion,"onUpdate:modelValue":me[10]||(me[10]=Ce=>k.value.crdVersion=Ce),modelModifiers:{trim:!0},maxlength:"20"},null,8,["modelValue"])]),_:1}),e(we,{label:"Image","label-width":f,prop:"image"},{default:t(()=>[e(ut,{modelValue:k.value.image,"onUpdate:modelValue":me[11]||(me[11]=Ce=>k.value.image=Ce),modelModifiers:{trim:!0},maxlength:"200"},null,8,["modelValue"])]),_:1}),e(Wa,{class:"box-card"},{default:t(()=>[e(we,{label:"Cluster Deployment:","label-width":"150px",prop:"checkCluster"},{default:t(()=>[e(Ka,{modelValue:k.value.checkCluster,"onUpdate:modelValue":me[12]||(me[12]=Ce=>k.value.checkCluster=Ce)},{default:t(()=>[(s(!0),P(oe,null,de(I.value,Ce=>(s(),y(ca,{label:Ce.name,disabled:r.value},{default:t(()=>{var Ie;return[v(D((Ie=Ce.name)==null?void 0:Ie.toUpperCase()),1)]}),_:2},1032,["label","disabled"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),p.value?(s(),P("div",ys,[e(xt,{language:"yaml",height:400,type:"simple","context-val":k.value.yamlDate,onChange:it},null,8,["context-val"])])):U("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(pa,{modelValue:u.value,"onUpdate:modelValue":me[15]||(me[15]=Ce=>u.value=Ce),title:"Edit Deployment",width:"70%",top:"8vh",onClose:ee},{footer:t(()=>[c("span",ks,[c("div",$s,[e(Te,{onClick:$e},{default:t(()=>[xs]),_:1}),e(Te,{type:"primary",onClick:re},{default:t(()=>[Vs]),_:1})])])]),default:t(()=>[u.value?(s(),P("div",Cs,[e(xt,{language:"yaml",height:g.value,type:"simple","context-val":b.value,onChange:ht},null,8,["height","context-val"])])):U("",!0)]),_:1},8,["modelValue"]),e(m(ia),{isOpen:J.value,cluster:m(H).cluster,namespace:m(H).namespace,pod:m(H).podName,containers:m(H).containers,onClose:Le},null,8,["isOpen","cluster","namespace","pod","containers"])])}}});var Ds=ke(Ss,[["__scopeId","data-v-e6e0746a"]]);const la=l=>(Re("data-v-6fb60621"),l=l(),Ne(),l),Is={class:"app-container"},Rs=v(" Service-Version "),Ns=v("ReDeploy"),Us={style:{display:"flex"}},Ps=la(()=>c("span",{style:{"margin-right":"20px"}}," Cluster ",-1)),As=la(()=>c("span",{style:{"margin-right":"20px"}}," Namespace ",-1)),Es=la(()=>c("span",{style:{"margin-right":"20px"}}," Kind ",-1)),Ts={class:"table-container"},Gs=v("Yes"),Ls=v(" Detail"),Os={class:"page-class"},zs={style:{margin:"6px"}},Ms=he({setup(l){const a=Ue(),n=i(!1),d=i(""),p=i(!0),_=i(1),u=i(25),g=i(0),f=i([]),C=Qe({cluster:"",serviceName:"",namespace:"",crdKind:""}),r=i(Array()),b=i(Array()),T=i(Array()),k=()=>{a.push({name:"crd-redeploy"})},S=()=>{h()},x=N=>{d.value="",N&&E(N)},E=async N=>{const A=N.primary===!0?N.serviceName:N.version+"-"+N.serviceName,Y={params:{type:"crd",crdVersion:"v1",name:A,namespace:N.namespace,crdKind:N.kind,cluster:N.cluster}},R=await Oe.GetCrDetail(Y);R&&R.data&&(d.value=R.data,n.value=!0)},z=()=>{n.value=!1,d.value=""};ze(()=>{te()});const te=async()=>{const N=await Oe.GetClusterInfo(),A=N==null?void 0:N.data.envs;r.value=Object.keys(A).map(R=>({name:R}));const Y=await Oe.GetCrdKinds();b.value=Y==null?void 0:Y.data.crdKinds,r.value&&r.value.length>0&&b.value&&b.value.length>0&&(C.cluster=r.value[0].name,C.crdKind=b.value[0],await h(),await F())},F=async()=>{const N={params:{cluster:C.cluster}},A=await qe.GetDeployNamespace(N);T.value=A==null?void 0:A.data},h=async()=>{var R,O;const N={params:{cluster:C.cluster,serviceName:C.serviceName,crdKind:C.crdKind,namespace:C.namespace,pageIndex:_.value,pageSize:u.value}},A=await Oe.GetCrsInfo(N),Y=A==null?void 0:A.data;Y&&(g.value=(R=Y.page)==null?void 0:R.pageTotal,f.value=(O=Y.crs)!=null?O:[])},V=()=>{_.value=1,C.namespace="",h(),F()},I=()=>{_.value=1,h()},w=()=>{_.value=1,h()},G=N=>{_.value=1,u.value=N,h()},J=N=>{_.value=N,h()},H=(N,A)=>{const Y=N[A.property];return Y===""?"":ft(new Date(Y).getTime()/1e3)};return(N,A)=>{const Y=o("el-button"),R=o("el-option"),O=o("el-select"),$=o("el-form-item"),L=o("el-input"),W=o("el-form"),B=o("el-table-column"),Z=o("el-tag"),X=o("el-table"),ae=o("el-pagination"),j=o("el-dialog");return s(),P("div",Is,[c("div",null,[c("h1",null,[Rs,e(Y,{type:"info",icon:m(St),onClick:k},{default:t(()=>[Ns]),_:1},8,["icon"])])]),e(W,{onSubmit:A[5]||(A[5]=Fe(K=>S(),["prevent"]))},{default:t(()=>[c("div",Us,[e($,null,{default:t(()=>[e(O,{modelValue:m(C).cluster,"onUpdate:modelValue":A[0]||(A[0]=K=>m(C).cluster=K),onChange:V,placeholder:"Select Cluster..."},{prefix:t(()=>[Ps]),default:t(()=>[(s(!0),P(oe,null,de(r.value,K=>{var M;return s(),y(R,{label:(M=K.name)==null?void 0:M.toUpperCase(),value:K.name},null,8,["label","value"])}),256))]),_:1},8,["modelValue"])]),_:1}),e($,null,{default:t(()=>[e(O,{filterable:"",modelValue:m(C).namespace,"onUpdate:modelValue":A[1]||(A[1]=K=>m(C).namespace=K),onChange:w,placeholder:"Select Namespace"},{prefix:t(()=>[As]),default:t(()=>[e(R,{label:"--ALL--",value:""}),(s(!0),P(oe,null,de(T.value,K=>(s(),y(R,{label:K,value:K},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e($,null,{default:t(()=>[e(O,{filterable:"",modelValue:m(C).crdKind,"onUpdate:modelValue":A[2]||(A[2]=K=>m(C).crdKind=K),onChange:I,placeholder:"Select CRd Kind"},{prefix:t(()=>[Es]),default:t(()=>[(s(!0),P(oe,null,de(b.value,K=>(s(),y(R,{label:K,value:K},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e($,{style:{width:"500px"}},{default:t(()=>[e(L,{clearable:"",style:{width:"100%"},modelValue:m(C).serviceName,"onUpdate:modelValue":A[3]||(A[3]=K=>m(C).serviceName=K),placeholder:"Enter Service name",onKeyup:A[4]||(A[4]=et(K=>S(),["enter","native"]))},{append:t(()=>[e(Y,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})])]),_:1}),c("div",Ts,[e(X,{data:f.value,border:"",stripe:"","table-layout":"fixed"},{default:t(()=>[e(B,{type:"index",align:"center",width:"70px"}),e(B,{prop:"serviceName",label:"Service Name"}),e(B,{prop:"version",label:"Version"}),e(B,{prop:"description",label:"Version Description"}),e(B,{label:"IsPrimary",width:"100px"},{default:t(K=>[K.row.primary===!0?(s(),y(Z,{key:0,size:"small"},{default:t(()=>[Gs]),_:1})):U("",!0)]),_:1}),e(B,{prop:"groupName",label:"Group"}),e(B,{prop:"namespace",label:"Namespace"}),e(B,{prop:"lastEditUser",label:"Edit User",resizable:"",width:"100px"}),e(B,{prop:"lastEditDate",label:"Edit Date",formatter:H,resizable:""}),e(B,{label:"Operate",align:"center","class-name":"fixed-width",width:"120px"},{default:t(({row:K})=>[e(Y,{size:"small",onClick:M=>x(K)},{default:t(()=>[Ls]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),c("div",Os,[e(ae,{class:"pagination",background:"","page-sizes":[25,50,75,100],"hide-on-single-page":"",total:g.value,currentPage:_.value,"onUpdate:currentPage":A[6]||(A[6]=K=>_.value=K),"page-size":u.value,onSizeChange:G,onCurrentChange:J,layout:"total, sizes, prev, pager, next, jumper"},null,8,["total","currentPage","page-size"])]),e(j,{modelValue:n.value,"onUpdate:modelValue":A[7]||(A[7]=K=>n.value=K),title:"Service Detail",width:"70%",top:"8vh",onClose:z},{default:t(()=>[c("div",zs,[e(xt,{language:"yaml","read-only":p.value,height:400,type:"simple","context-val":d.value},null,8,["read-only","context-val"])])]),_:1},8,["modelValue"])])}}});var qs=ke(Ms,[["__scopeId","data-v-6fb60621"]]);const Hs={class:"app-container"},js=v(" Service-Version "),Fs=v("Go Back"),Bs={style:{display:"flex"}},Ks=c("span",{style:{"margin-right":"30px"}}," Cluster ",-1),Ws=c("span",{style:{"margin-right":"30px"}}," Kind ",-1),Ys={class:"table-container"},Js={style:{"margin-bottom":"10px"}},Zs=v("Confirm Deploy "),Qs=v("Clear selection"),Xs=v("Refresh"),er=v("Yes"),tr=v("Yes"),ar=he({setup(l){const a=Xa(),n=!1,d=i(Array()),p=i(Array()),_=i(new Map),u=i(),g=i(Array()),f=i(0),C=i(0),r=Qe({cluster:"",serviceName:"",crdKind:""}),b=i(0),T=Ue(),k=i(Array()),S=N=>{C.value=Number(N.index);const A=N.props.name;b.value!==A&&A!==0&&(b.value=Number(A),H())},x=()=>{T.push({name:"cr"})},E=N=>!!(N.sId&&N.vId&&N.cId===0),z=()=>{H()},te=()=>{H()},F=()=>{H()},h=()=>{const N=ct(_.value),A={gId:b.value,cluster:r.cluster,versions:Object.fromEntries(N)};Oe.ReDeploy(A).then(Y=>{var R,O;Ze((O=(R=Y==null?void 0:Y.data)==null?void 0:R.msg)!=null?O:"Deploy success"),I()})},V=()=>{_.value&&_.value.size>0&&(a==null?void 0:a.refs.multipleTableRef)[C.value].clearSelection()},I=()=>{V(),H()},w=N=>{_.value.clear(),N&&N.forEach(A=>{if(A.sId&&A.vId)if(_.value.has(A.sId)){const Y=_.value.get(A.sId);_.value.set(A.sId,Array.from(new Set(Y).add(A.vId)))}else _.value.set(A.sId,Array.of(A.vId))})};ze(()=>{G()});const G=async()=>{const N=await Oe.GetClusterInfo(),A=N==null?void 0:N.data.envs;k.value=Object.keys(A).map(R=>({name:R}));const Y=await Oe.GetCrdKinds();d.value=Y==null?void 0:Y.data.crdKinds,k.value&&k.value.length>0&&d.value&&d.value.length>0&&(r.cluster=k.value[0].name,r.crdKind=d.value[0],J())},J=()=>{const N={name:"",soxId:"0",pageIndex:1,pageSize:1e3};fe.GetGroupList(N).then(A=>{const Y=A==null?void 0:A.data;g.value=Y.data,f.value=Y.totalCount,g.value&&g.value.length>0&&(g.value.sort((R,O)=>R.name>O.name?1:-1),b.value=g.value[0].id,H())})},H=async()=>{var R;const N={params:{cluster:r.cluster,serviceName:r.serviceName,crdKind:r.crdKind,pageIndex:1,pageSize:1e3,groupId:b.value}},A=await Oe.GetCrsInfo(N),Y=A==null?void 0:A.data;Y&&(p.value=(R=Y.crs)!=null?R:[])};return(N,A)=>{const Y=o("el-button"),R=o("el-option"),O=o("el-select"),$=o("el-form-item"),L=o("el-input"),W=o("el-form"),B=o("el-table-column"),Z=o("el-tag"),X=o("el-tab-pane"),ae=o("el-tabs");return s(),P("div",Hs,[c("div",null,[c("h1",null,[js,e(Y,{type:"info",icon:m(St),onClick:x},{default:t(()=>[Fs]),_:1},8,["icon"])])]),e(W,{onSubmit:A[4]||(A[4]=Fe(j=>F(),["prevent"]))},{default:t(()=>[c("div",Bs,[e($,null,{default:t(()=>[e(O,{modelValue:m(r).cluster,"onUpdate:modelValue":A[0]||(A[0]=j=>m(r).cluster=j),onChange:te,placeholder:"Select Cluster..."},{prefix:t(()=>[Ks]),default:t(()=>[(s(!0),P(oe,null,de(k.value,j=>{var K;return s(),y(R,{label:(K=j.name)==null?void 0:K.toUpperCase(),value:j.name},null,8,["label","value"])}),256))]),_:1},8,["modelValue"])]),_:1}),e($,null,{default:t(()=>[e(O,{filterable:"",modelValue:m(r).crdKind,"onUpdate:modelValue":A[1]||(A[1]=j=>m(r).crdKind=j),onChange:z,placeholder:"Select CRd Kind"},{prefix:t(()=>[Ws]),default:t(()=>[(s(!0),P(oe,null,de(d.value,j=>(s(),y(R,{label:j,value:j},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e($,{style:{width:"800px"}},{default:t(()=>[e(L,{clearable:"",style:{width:"100%"},modelValue:m(r).serviceName,"onUpdate:modelValue":A[2]||(A[2]=j=>m(r).serviceName=j),placeholder:"Enter Service name",onKeyup:A[3]||(A[3]=et(j=>F(),["enter","native"]))},{append:t(()=>[e(Y,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1})])]),_:1}),c("div",Ys,[e(ae,{"tab-position":"left",stretch:n,type:"border-card","model-value":b.value,style:{height:"720px"},onTabClick:S},{default:t(()=>[(s(!0),P(oe,null,de(g.value,j=>(s(),y(X,{label:j.name,name:j.id},{default:t(()=>[c("div",null,[c("div",Js,[e(Y,{type:"primary",disabled:_.value.size<1,onClick:h},{default:t(()=>[Zs]),_:1},8,["disabled"]),e(Y,{disabled:_.value.size<1,onClick:V},{default:t(()=>[Qs]),_:1},8,["disabled"]),e(Y,{onClick:I},{default:t(()=>[Xs]),_:1})]),c("div",null,[e(m(kt),{border:"",ref_for:!0,ref_key:"multipleTableRef",ref:u,data:p.value,style:{width:"100%"},onSelectionChange:w},{default:t(()=>[e(B,{type:"selection",selectable:E,width:"55"}),e(B,{type:"index",align:"center"}),e(B,{prop:"serviceName",label:"Service Name"}),e(B,{prop:"version",label:"Version"}),e(B,{prop:"description",label:"Version Description","show-overflow-tooltip":""}),e(B,{label:"IsPrimary",width:"100px"},{default:t(K=>[K.row.primary===!0?(s(),y(Z,{key:0,size:"small"},{default:t(()=>[er]),_:1})):U("",!0)]),_:1}),e(B,{prop:"groupName",label:"Group"}),e(B,{prop:"namespace",label:"Namespace"}),e(B,{label:"Canary",width:"100px"},{default:t(K=>{var M;return[((M=K.row)==null?void 0:M.cId)!==0?(s(),y(Z,{key:0,size:"small"},{default:t(()=>[tr]),_:1})):U("",!0)]}),_:1})]),_:1},8,["data"])])])]),_:2},1032,["label","name"]))),256))]),_:1},8,["model-value"])])])}}}),lr=c("span",null,"Are you sure you want to delete?",-1),nr=v("Please input "),or={style:{color:"red"}},sr=v(" to confirm."),rr=v("Yes"),ir=v("No"),na=he({props:{modelValue:{type:Boolean},title:null,sourceName:null,deleteHandle:null},emits:["update:modelValue"],setup(l,{emit:a}){const n=l,d=nt({get:()=>n.modelValue,set:u=>{p.value="",a("update:modelValue",u)}}),p=i("");function _(){if(p.value!==n.sourceName){ye({showClose:!0,message:"Please enter the correct resource name.",type:"error"});return}let u=n.deleteHandle();u&&u.then(()=>{d.value=!1})}return(u,g)=>{const f=o("el-form-item"),C=o("el-input"),r=o("el-button"),b=o("el-form"),T=o("el-dialog");return s(),y(T,{modelValue:m(d),"onUpdate:modelValue":g[2]||(g[2]=k=>Qt(d)?d.value=k:null),title:n.title,width:"20%"},{default:t(()=>[e(b,null,{default:t(()=>[e(f,null,{default:t(()=>[lr]),_:1}),e(f,null,{default:t(()=>[c("span",null,[nr,c("span",or,D(l.sourceName),1),sr])]),_:1}),e(f,null,{default:t(()=>[e(C,{modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=k=>p.value=k)},null,8,["modelValue"])]),_:1}),e(f,null,{default:t(()=>[e(r,{type:"danger",onClick:_},{default:t(()=>[rr]),_:1}),e(r,{type:"info",onClick:g[1]||(g[1]=k=>d.value=!1)},{default:t(()=>[ir]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])}}});const Ga=l=>(Re("data-v-b4328c22"),l=l(),Ne(),l),ur={class:"common-layout"},dr=Ga(()=>c("div",null,[c("h2",{style:{"font-size":"var(--el-font-size-large)"}},"Group List")],-1)),cr={style:{display:"flex"}},pr=Ga(()=>c("span",{style:{"margin-right":"30px"}}," SoxApp ",-1)),mr=v(" Add Group "),vr=["onClick"],_r=he({setup(l){const a=Ue(),n=i({name:"",sox:"0",currentPage:1}),d=i([{code:"0",desc:"--All--"}]),p=i([]),_=i(0),u=i(!1),g=i(0),f=i("");function C(x,E){return fe.formatDate(x[E.property])}function r(){let E=ie.getters.SearchStore.group;E&&E.route===a.currentRoute.value.path&&(n.value=E.data),ie.getters.ServiceManageOption().then(z=>{d.value=d.value.concat(z.sox)}),b()}r();function b(x=n.value.currentPage){let E={pageIndex:x,pageSize:10,soxId:n.value.sox,name:n.value.name},z={key:"group",route:a.currentRoute.value.path,data:n.value};fe.GetGroupList(E).then(te=>{p.value=te.data.data,ie.commit("setSearchStore",z),n.value.currentPage=x,_.value=te.data.totalCount})}function T(x){a.push({name:"service-list",params:{gId:x}})}function k(x){x>0?a.push({name:"edit-group",params:{id:x}}):a.push({path:"/service-management/group/new"})}function S(){if(!!g.value)return fe.DeleteGroup(g.value).then(x=>{ye({showClose:!0,message:"Delete successfully.",type:"success"}),b(),u.value=!1})}return(x,E)=>{const z=o("el-header"),te=o("el-option"),F=o("el-select"),h=o("el-form-item"),V=o("el-button"),I=o("el-input"),w=o("el-form"),G=o("el-table-column"),J=o("el-tag"),H=o("el-tooltip"),N=o("el-button-group"),A=o("el-table"),Y=o("el-pagination"),R=o("el-card"),O=o("el-main"),$=o("el-container");return s(),P(oe,null,[c("div",ur,[e($,null,{default:t(()=>[e(z,null,{default:t(()=>[dr]),_:1}),e(O,{style:{"margin-top":"20px"}},{default:t(()=>[e(w,{onSubmit:E[5]||(E[5]=Fe(L=>b(),["prevent"]))},{default:t(()=>[c("div",cr,[e(h,{class:"form-left"},{default:t(()=>[e(F,{filterable:"",modelValue:n.value.sox,"onUpdate:modelValue":E[0]||(E[0]=L=>n.value.sox=L),onChange:E[1]||(E[1]=L=>b()),placeholder:"Select Cluster..."},{prefix:t(()=>[pr]),default:t(()=>[(s(!0),P(oe,null,de(d.value,L=>(s(),y(te,{key:L.desc,label:L.desc,value:L.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(h,{style:{width:"800px"},class:"m-r-8 form-right"},{default:t(()=>[e(I,{modelValue:n.value.name,"onUpdate:modelValue":E[2]||(E[2]=L=>n.value.name=L),placeholder:"Enter group name",onKeyup:E[3]||(E[3]=et(L=>b(),["enter","native"]))},{append:t(()=>[e(V,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[m(ie).getters.IsAdmin?(s(),y(V,{key:0,type:"primary",onClick:E[4]||(E[4]=L=>k(-1)),icon:m(Me),plain:""},{default:t(()=>[mr]),_:1},8,["icon"])):U("",!0)]),_:1})])]),_:1}),e(R,{shadow:"hover"},{default:t(()=>[e(A,{data:p.value,stripe:""},{default:t(()=>[e(G,{label:"Group",width:"600"},{default:t(L=>[c("a",{style:{"font-size":"var(--el-font-size-large)"},class:"a-class",href:"",onClick:Fe(W=>T(L.row.id),["prevent"])},D(L.row.name),9,vr)]),_:1}),e(G,{label:"Description","show-overflow-tooltip":"",prop:"description"}),e(G,{label:"AuthType",align:"center",width:"180"},{default:t(L=>[e(J,null,{default:t(()=>[v(D(L.row.auth===0?"K0S":"NAS"),1)]),_:2},1024)]),_:1}),e(G,{label:"ServiceCount",align:"center",width:"180"},{default:t(L=>[e(J,null,{default:t(()=>[v(D(L.row.serviceCount),1)]),_:2},1024)]),_:1}),e(G,{label:"Edit Date",prop:"lastEditDate",formatter:C,width:"240"}),e(G,{label:"Edit User",prop:"lastEditUser",width:"140"}),e(G,{label:"Contact",prop:"contact",width:"140"}),e(G,{label:"Operation",width:"120",fixed:"right"},{default:t(L=>[e(N,null,{default:t(()=>[e(H,{content:"Edit Group",placement:"left"},{default:t(()=>[e(V,{onClick:W=>k(L.row.id),type:"primary",icon:m(St),plain:""},null,8,["onClick","icon"])]),_:2},1024),e(H,{content:"Delete Group",placement:"left","hide-after":0,offset:30},{default:t(()=>[e(V,{disabled:!m(ie).getters.IsAdmin,onClick:W=>{u.value=!0,g.value=L.row.id,f.value=L.row.name},type:"danger",icon:m(je),plain:""},null,8,["disabled","onClick","icon"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"]),e(Y,{currentPage:n.value.currentPage,"onUpdate:currentPage":E[6]||(E[6]=L=>n.value.currentPage=L),layout:"prev, pager, next","hide-on-single-page":!0,total:_.value,onCurrentChange:b},null,8,["currentPage","total"])]),_:1})]),_:1})]),_:1})]),e(na,{modelValue:u.value,"onUpdate:modelValue":E[7]||(E[7]=L=>u.value=L),title:"DeleteGroup","source-name":f.value,"delete-handle":S},null,8,["modelValue","source-name"])],64)}}});var fr=ke(_r,[["__scopeId","data-v-b4328c22"]]);const Ee=he({props:{title:{required:!0,type:String},content:{required:!0,type:String},top:{required:!1,type:Number,default:8}},setup(l){const a=l;return(n,d)=>{const p=o("el-icon"),_=o("el-popover");return s(),y(_,{placement:"top",title:a.title,trigger:"hover",content:a.content,"popper-class":"tips-popover",width:200},{reference:t(()=>[e(p,{style:st({"padding-left":"2px","padding-top":l.top+"px"})},{default:t(()=>[e(m(Pt))]),_:1},8,["style"])]),_:1},8,["title","content"])}}});const oa=l=>(Re("data-v-b9af0d98"),l=l(),Ne(),l),gr={style:{"margin-bottom":"10px"}},yr={key:0,style:{"font-size":"var(--el-font-size-large)"}},hr={key:1,style:{"font-size":"var(--el-font-size-large)"}},br=v("Group List"),wr=v("Edit Group"),Cr=v("New Group"),kr=oa(()=>c("span",null," Set Robot Account(Robot has owner permission.)",-1)),$r={style:{display:"inline-block",width:"60%"}},xr=oa(()=>c("span",{style:{"vertical-align":"middle"}}," Copy ",-1)),Vr=oa(()=>c("span",{style:{"vertical-align":"middle"}}," Set Token ",-1)),Sr=v(" Contact "),Dr=v("Save"),Ir=v("Cancel"),Rr=he({props:{id:null},setup(l){const a=l,n=i([]),d=Ue(),p=[{value:0,label:"K0S"},{value:1,label:"NAS"}];ot(a);const _=i(!1),u=i(!1),g=i(),f=i([]),C=i([]),r=i([]),b=i([]),T=i([]);let k=[];const S=i({id:0,name:"",description:"",auth:0,soxApp:"0",token:"",contact:"",owners:[],namespaces:[],role:""}),x=(O,$,L)=>{$.length===0?L(new Error(O.field+" is required")):L()};let E=new RegExp(/^(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?$/);const z=(O,$,L)=>{let W=$;E.test(W)||L(new Error("regex used for validation is (([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?")),L()},te=!!a.id,F=i([{code:"0",desc:"None"}]),h=i({name:[{required:!0,message:"Please input group name",trigger:"blur"},{min:1,max:62,message:"Length should be 1 to 62",trigger:"blur"},{validator:z,trigger:"blur"}],description:[{min:0,max:255,message:"Length should be 0 to 255",trigger:"blur"}],namespaces:[{required:!0,message:"Please select namespace",trigger:"blur"},{validator:x,trigger:"blur"}]});w();function V(O){O?(u.value=!0,fe.GetNeweggUser(O).then($=>{u.value=!1,n.value=$.data})):n.value=[]}function I(){Ae.GetNamespace("e9k8s").then(O=>{T.value=O.data})}function w(){I(),fe.GetEggKeeperData("/bts/sox-applications").then(O=>{F.value=F.value.concat(O.data),F.value.sort(($,L)=>L.desc==="None"||$.desc>L.desc?1:-1)}),te&&G()}function G(){fe.GetGroup(Number(a.id)).then(O=>{S.value=O.data;let $=[],L=[];k=O.data.owners;for(let W of k)W.ownerType==0?$.push(W):L.push(W);_.value=!!O.data.token,r.value=r.value.concat($),f.value=f.value.concat($),b.value=b.value.concat(L),C.value=C.value.concat(L)})}function J(O){let $=document.createElement("input");$.value=O,document.body.appendChild($),$.select(),document.execCommand("Copy"),document.body.removeChild($),ye({showClose:!0,message:"Copy successfully.",type:"success"})}function H(){S.value.token="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(O){let $=Math.random()*16|0;return(O=="x"?$:$&3|8).toString(16)})}async function N(O){!O||await O.validate(($,L)=>{$?(S.value.owners=[],S.value.owners=S.value.owners.concat(f.value).concat(C.value),te?fe.UpdateGroup(S.value).then(W=>{ye({showClose:!0,message:"Update successfully.",type:"success"}),R()}):fe.CreateGroup(S.value).then(W=>{ye({showClose:!0,message:"Create successfully.",type:"success"}),R()})):ye({showClose:!0,message:"Validate failed",type:"error"})})}function A(O){O?(u.value=!0,fe.GetNeweggUser(O).then($=>{u.value=!1,r.value=$.data.map(L=>({id:0,referenceId:0,ownerName:L.UserId,fullName:L.FullName,ownerType:0,action:-1}))})):r.value=[]}function Y(O){O?(u.value=!0,fe.GetNeweggGroup(O).then($=>{u.value=!1,b.value=$.data.filter(L=>L.GroupName.toLowerCase().includes(O.toLowerCase())).map(L=>({id:0,referenceId:0,ownerName:L.GroupName,fullName:"",ownerType:1,action:-1}))})):b.value=[]}function R(){d.push({path:"/service-management"})}return(O,$)=>{const L=o("el-breadcrumb-item"),W=o("el-breadcrumb"),B=o("el-header"),Z=o("el-input"),X=o("el-form-item"),ae=o("el-option"),j=o("el-select"),K=o("el-switch"),M=o("el-icon"),se=o("el-button"),be=o("el-form"),Ve=o("el-main"),ve=o("el-container");return s(),y(ve,null,{default:t(()=>[e(B,null,{default:t(()=>[c("div",gr,[te?(s(),P("span",yr,D(S.value.name),1)):U("",!0),te?U("",!0):(s(),P("span",hr,"New Group"))]),e(W,{separator:"/"},{default:t(()=>[e(L,{to:{path:"/service-management"}},{default:t(()=>[br]),_:1}),te?(s(),y(L,{key:0},{default:t(()=>[wr]),_:1})):U("",!0),te?U("",!0):(s(),y(L,{key:1},{default:t(()=>[Cr]),_:1}))]),_:1})]),_:1}),e(Ve,{class:"radius",style:st({borderRadius:"var(--el-border-radius-base)"})},{default:t(()=>[e(be,{model:S.value,"label-width":"120px",rules:h.value,ref_key:"ruleFormRef",ref:g},{default:t(()=>[e(X,{label:"Group Name",prop:"name"},{default:t(()=>[e(Z,{maxlength:"62",class:"form-body",disabled:te,modelValue:S.value.name,"onUpdate:modelValue":$[0]||($[0]=le=>S.value.name=le)},null,8,["modelValue"])]),_:1}),e(X,{label:"Description",prop:"description"},{default:t(()=>[e(Z,{maxlength:"255",class:"form-body",modelValue:S.value.description,"onUpdate:modelValue":$[1]||($[1]=le=>S.value.description=le),type:"textarea"},null,8,["modelValue"])]),_:1}),e(X,{label:"Auth"},{default:t(()=>[e(j,{disabled:!m(ie).getters.IsAdmin,class:"form-body",modelValue:S.value.auth,"onUpdate:modelValue":$[2]||($[2]=le=>S.value.auth=le),placeholder:"please select your auth method"},{default:t(()=>[(s(),P(oe,null,de(p,le=>e(ae,{label:le.label,value:le.value},null,8,["label","value"])),64))]),_:1},8,["disabled","modelValue"])]),_:1}),e(X,{label:"Sox Application"},{default:t(()=>[e(j,{modelValue:S.value.soxApp,"onUpdate:modelValue":$[3]||($[3]=le=>S.value.soxApp=le),class:"m-2 form-body",placeholder:"Select"},{default:t(()=>[(s(!0),P(oe,null,de(F.value,le=>(s(),y(ae,{key:le.code,label:le.desc,value:le.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(X,{label:"Namespace",prop:"namespaces"},{default:t(()=>[e(j,{multiple:"",filterable:"",class:"form-body",modelValue:S.value.namespaces,"onUpdate:modelValue":$[4]||($[4]=le=>S.value.namespaces=le),placeholder:"please select your k8s namespace"},{default:t(()=>[(s(!0),P(oe,null,de(T.value,le=>(s(),y(ae,{key:le,label:le,value:le},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),S.value.auth===0?(s(),y(X,{key:0,label:"Owners"},{default:t(()=>[e(j,{modelValue:f.value,"onUpdate:modelValue":$[5]||($[5]=le=>f.value=le),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":A,loading:u.value,class:"form-body","value-key":"ownerName"},{default:t(()=>[(s(!0),P(oe,null,de(r.value,le=>(s(),y(ae,{key:le.ownerName,label:le.fullName+"/"+le.ownerName,value:le},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})):U("",!0),S.value.auth===0?(s(),y(X,{key:1,label:"Group Owners"},{default:t(()=>[e(j,{modelValue:C.value,"onUpdate:modelValue":$[6]||($[6]=le=>C.value=le),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":Y,loading:u.value,class:"form-body","value-key":"ownerName"},{default:t(()=>[(s(!0),P(oe,null,de(b.value,le=>(s(),y(ae,{key:le.ownerName,label:le.ownerName,value:le},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})):U("",!0),e(X,{label:"Use Token"},{default:t(()=>[e(K,{modelValue:_.value,"onUpdate:modelValue":$[7]||($[7]=le=>_.value=le)},null,8,["modelValue"]),kr]),_:1}),_.value?(s(),y(X,{key:2,label:"Robot Token"},{default:t(()=>[c("div",$r,[e(Z,{disabled:!0,modelValue:S.value.token,"onUpdate:modelValue":$[8]||($[8]=le=>S.value.token=le)},null,8,["modelValue"])]),e(se,{type:"info",onClick:$[9]||($[9]=le=>J(S.value.token))},{default:t(()=>[e(M,{style:{"vertical-align":"middle"}},{default:t(()=>[e(m(Lt))]),_:1}),xr]),_:1}),e(se,{type:"primary",onClick:$[10]||($[10]=le=>H())},{default:t(()=>[e(M,{style:{"vertical-align":"middle"}},{default:t(()=>[e(m(gl))]),_:1}),Vr]),_:1})]),_:1})):U("",!0),e(X,{prop:"contact"},{label:t(()=>[Sr,e(m(Ee),{title:"Contact User",content:"The default contact of the version to which it belongs"})]),default:t(()=>[e(j,{style:{width:"100%"},modelValue:S.value.contact,"onUpdate:modelValue":$[11]||($[11]=le=>S.value.contact=le),filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":V,loading:u.value,class:"form-body"},{default:t(()=>[(s(!0),P(oe,null,de(n.value,le=>(s(),y(ae,{key:le.FullName,label:le.FullName,value:le.FullName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(X,null,{default:t(()=>[e(se,{type:"primary",onClick:$[12]||($[12]=le=>N(g.value))},{default:t(()=>[Dr]),_:1}),e(se,{onClick:$[13]||($[13]=le=>R())},{default:t(()=>[Ir]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["style"])]),_:1})}}});var ka=ke(Rr,[["__scopeId","data-v-b9af0d98"]]);const La=l=>(Re("data-v-c9735928"),l=l(),Ne(),l),Nr={class:"common-layout"},Ur={style:{"margin-bottom":"10px"}},Pr={style:{"font-size":"var(--el-font-size-large)"}},Ar=v("Group list"),Er={style:{display:"flex"}},Tr=La(()=>c("span",{style:{"margin-right":"30px"}}," Tag ",-1)),Gr=La(()=>c("span",{style:{"margin-right":"30px"}}," Kind ",-1)),Lr=v("Add Service "),Or=["onClick"],zr={style:{"margin-right":"5px"}},Mr=he({setup(l){const a=i(!1),n=i(""),d=i(""),p="--All--",_=Ue();let u=i(parseInt(_.currentRoute.value.params.gId));const g=i([p]),f=i({kind:"",name:"",tag:p,currentPage:1}),C=i(0),r=i([]),b=i(!1),T=i({id:u.value,name:"",description:"",auth:0,soxApp:"0",token:"",contact:"",owners:[],namespaces:[],role:""});k(),Xt(F=>{u.value=parseInt(F.params.gId),k()});function k(){let h=ie.getters.SearchStore.service;h&&h.route===_.currentRoute.value.path&&(f.value=h.data),ie.getters.CurrentGroup(u.value).then(V=>{V||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),_.push({name:"service-management"})),b.value=ie.getters.EditAuth(V.id),T.value=V}),fe.GetGroupTags(u.value).then(V=>{g.value=g.value.concat(V.data)}),x()}function S(F,h){return fe.formatDate(F[h.property])}function x(F=f.value.currentPage){let h={groupId:Number(u.value),pageIndex:F,pageSize:10,tag:f.value.tag,kind:f.value.kind,name:f.value.name};h.tag===p&&(h.tag="");let V={key:"service",route:_.currentRoute.value.path,data:f.value};fe.GetServiceList(h).then(I=>{r.value=I.data.data,f.value.currentPage=F,ie.commit("setSearchStore",V),C.value=I.data.totalCount})}function E(F){_.push({name:"service-instance",params:{sId:F}})}function z(){_.push({name:"service-create",params:{gId:T.value.id}})}function te(){if(!!n.value)return fe.DeleteService(u.value,n.value).then(F=>{ye({showClose:!0,message:"Delete successfully.",type:"success"}),x(),a.value=!1})}return(F,h)=>{const V=o("el-breadcrumb-item"),I=o("el-breadcrumb"),w=o("el-header"),G=o("el-option"),J=o("el-select"),H=o("el-form-item"),N=o("el-button"),A=o("el-input"),Y=o("el-form"),R=o("el-table-column"),O=o("el-tag"),$=o("el-tooltip"),L=o("el-table"),W=o("el-pagination"),B=o("el-card"),Z=o("el-main"),X=o("el-container");return s(),P(oe,null,[c("div",Nr,[e(X,null,{default:t(()=>[e(w,null,{default:t(()=>[c("div",Ur,[c("h2",Pr,D(T.value.name),1)]),e(I,{separator:"/"},{default:t(()=>[e(V,{to:{path:"/service-management"}},{default:t(()=>[Ar]),_:1}),e(V,{to:{name:"service-list",params:{gId:m(u)}}},{default:t(()=>[v(D(T.value.name),1)]),_:1},8,["to"])]),_:1})]),_:1}),e(Z,null,{default:t(()=>[e(Y,{onSubmit:h[7]||(h[7]=Fe(ae=>x(),["prevent"]))},{default:t(()=>[c("div",Er,[e(H,{class:"form-left"},{default:t(()=>[e(J,{filterable:"",modelValue:f.value.tag,"onUpdate:modelValue":h[0]||(h[0]=ae=>f.value.tag=ae),onChange:h[1]||(h[1]=ae=>x()),placeholder:"Select Cluster..."},{prefix:t(()=>[Tr]),default:t(()=>[(s(!0),P(oe,null,de(g.value,ae=>(s(),y(G,{label:ae,value:ae},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(H,{class:"form-mind"},{default:t(()=>[e(J,{filterable:"",modelValue:f.value.kind,"onUpdate:modelValue":h[2]||(h[2]=ae=>f.value.kind=ae),onChange:h[3]||(h[3]=ae=>x()),placeholder:"Select Cluster..."},{prefix:t(()=>[Gr]),default:t(()=>[e(G,{label:"--All--",value:""}),e(G,{label:"WebService",value:"WebService"}),e(G,{label:"Job",value:"Job"})]),_:1},8,["modelValue"])]),_:1}),e(H,{class:"m-r-8 form-right",style:{width:"800px"}},{default:t(()=>[e(A,{modelValue:f.value.name,"onUpdate:modelValue":h[4]||(h[4]=ae=>f.value.name=ae),class:"search",placeholder:"Enter service name",onKeyup:h[5]||(h[5]=et(ae=>x(),["enter","native"]))},{append:t(()=>[e(N,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),b.value?(s(),y(H,{key:0,class:"m-r-8"},{default:t(()=>[e(N,{type:"primary",onClick:h[6]||(h[6]=ae=>z()),icon:m(Me),plain:""},{default:t(()=>[Lr]),_:1},8,["icon"])]),_:1})):U("",!0)])]),_:1}),e(B,{shadow:"hover",class:"card"},{default:t(()=>[e(L,{data:r.value,stripe:""},{default:t(()=>[e(R,{label:"Service",width:"600"},{default:t(ae=>[c("a",{style:{"font-size":"var(--el-font-size-large)"},class:"a-class",href:"",onClick:Fe(j=>E(ae.row.id),["prevent"])},D(ae.row.name),9,Or)]),_:1}),e(R,{label:"Description","show-overflow-tooltip":"",prop:"description"}),e(R,{label:"VersionCount",width:"140",align:"center"},{default:t(ae=>[e(O,null,{default:t(()=>[v(D(ae.row.versionCount),1)]),_:2},1024)]),_:1}),e(R,{label:"DeployCount",width:"140",align:"center"},{default:t(ae=>[e(O,null,{default:t(()=>[v(D(ae.row.deployCount),1)]),_:2},1024)]),_:1}),e(R,{label:"Tag",width:"200"},{default:t(ae=>[c("span",zr,[(s(!0),P(oe,null,de(ae.row.tags,(j,K)=>(s(),y(O,{type:"info"},{default:t(()=>[v(D(j.tagName),1)]),_:2},1024))),256))])]),_:1}),e(R,{label:"Edit Date",prop:"lastEditDate",formatter:S,width:"200"}),e(R,{label:"Edit User",prop:"lastEditUser",width:"100",align:"center"}),b.value?(s(),y(R,{key:0,label:"Operation",width:"100",fixed:"right"},{default:t(ae=>[e($,{content:"Delete Service",placement:"left"},{default:t(()=>[e(N,{style:{"margin-left":"10px"},onClick:j=>{a.value=!0,n.value=ae.row.id,d.value=ae.row.name},type:"danger",icon:m(je),plain:""},null,8,["onClick","icon"])]),_:2},1024)]),_:1})):U("",!0)]),_:1},8,["data"]),e(W,{currentPage:f.value.currentPage,"onUpdate:currentPage":h[8]||(h[8]=ae=>f.value.currentPage=ae),layout:"prev, pager, next","hide-on-single-page":!0,total:C.value,onCurrentChange:x},null,8,["currentPage","total"])]),_:1})]),_:1})]),_:1})]),e(na,{modelValue:a.value,"onUpdate:modelValue":h[9]||(h[9]=ae=>a.value=ae),title:"DeleteService","source-name":d.value,"delete-handle":te},null,8,["modelValue","source-name"])],64)}}});var qr=ke(Mr,[["__scopeId","data-v-c9735928"]]);const gt=l=>(Re("data-v-cba5b7e0"),l=l(),Ne(),l),Hr={style:{"margin-bottom":"10px",display:"flex"}},jr={style:{"font-size":"var(--el-font-size-large)"}},Fr={style:{"margin-left":"auto"}},Br={style:{"margin-right":"20px"}},Kr=v("Kind: "),Wr={style:{"margin-right":"20px"}},Yr=v("Group: "),Jr={key:0},Zr=v("Sox: "),Qr={style:{"margin-bottom":"10px",display:"flex"}},Xr=v("Group List"),ei=v("Service"),ti={class:"menu-group-title"},ai=gt(()=>c("span",null,"Setting",-1)),li=gt(()=>c("span",null,"BaseInfo",-1)),ni=gt(()=>c("span",null,"Versions",-1)),oi={class:"menu-group-title"},si=gt(()=>c("span",null,"Monitor",-1)),ri=gt(()=>c("span",null,"Instances",-1)),ii=gt(()=>c("span",null,"Activity",-1)),ui=he({setup(l){const a=Ue(),n=i(a.currentRoute.value.params.sId),d=i(a.currentRoute.value.params.gId),p=i({id:parseInt(a.currentRoute.value.params.gId),name:"",description:"",auth:0,soxApp:"0",token:"",contact:"",owners:[],namespaces:[],role:""}),_=i({id:"",name:"",kind:"",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",clusterName:[],formTags:[],ingressClusters:[],namespace:"",repository:"",chart:"",helmChart:""}),u=i("service-instance"),g=i("");f(),Xt(C=>{d.value=C.params.gId,n.value=C.params.sId,f()});function f(){ie.getters.ServiceManageOption().then(C=>{var r;g.value=p.value.soxApp==="0"?"None":(r=C.soxMap[p.value.soxApp])==null?void 0:r.desc}),u.value=a.currentRoute.value.name,ie.getters.CurrentService(a.currentRoute.value.params.sId).then(C=>{C||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),a.push({name:"service-management"})),_.value=C}),ie.getters.CurrentGroup(a.currentRoute.value.params.gId).then(C=>{C||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),a.push({name:"service-management"})),p.value=C})}return Pe(a.currentRoute,C=>{u.value=C.name}),(C,r)=>{const b=o("el-breadcrumb-item"),T=o("el-breadcrumb"),k=o("el-header"),S=o("el-icon"),x=o("el-menu-item"),E=o("el-menu-item-group"),z=o("el-menu"),te=o("el-card"),F=o("el-aside"),h=o("router-view"),V=o("el-main"),I=o("el-container");return s(),y(I,null,{default:t(()=>[e(k,null,{default:t(()=>{var w,G,J;return[c("div",Hr,[c("div",null,[c("span",jr,D((w=_.value)==null?void 0:w.name),1)]),c("div",Fr,[c("span",Br,[Kr,c("span",null,D((G=_.value)==null?void 0:G.kind),1)]),c("span",Wr,[Yr,c("span",null,D((J=p.value)==null?void 0:J.name),1)]),g.value?(s(),P("span",Jr,[Zr,c("span",null,D(g.value),1)])):U("",!0)])]),c("div",Qr,[c("div",null,[e(T,{separator:"/"},{default:t(()=>[e(b,{to:{path:"/service-management"}},{default:t(()=>[Xr]),_:1}),e(b,{to:{name:"service-list",params:{gId:p.value.id}}},{default:t(()=>[v(D(p.value.name),1)]),_:1},8,["to"]),e(b,null,{default:t(()=>[ei]),_:1}),e(b,null,{default:t(()=>{var H;return[v(D((H=_.value)==null?void 0:H.name),1)]}),_:1})]),_:1})])])]}),_:1}),e(V,null,{default:t(()=>[e(I,null,{default:t(()=>[e(F,{style:{width:"auto"}},{default:t(()=>[e(te,{"body-style":{padding:"0px"},shadow:"hover"},{default:t(()=>[e(z,{class:"el-menu-vertical","default-active":u.value,router:""},{default:t(()=>[e(E,null,{title:t(()=>[c("div",ti,[e(S,null,{default:t(()=>[e(m(yl))]),_:1}),ai])]),default:t(()=>[e(x,{index:"service-base",route:{name:"service-base"}},{default:t(()=>[e(S,null,{default:t(()=>[e(m(hl))]),_:1}),li]),_:1}),e(x,{index:"version-list",route:{name:"version-list"}},{default:t(()=>[e(S,null,{default:t(()=>[e(m(bl))]),_:1}),ni]),_:1})]),_:1}),e(E,{title:"Monitor"},{title:t(()=>[c("div",oi,[e(S,null,{default:t(()=>[e(m(ea))]),_:1}),si])]),default:t(()=>[e(x,{index:"service-instance",route:{name:"service-instance"}},{default:t(()=>[e(S,null,{default:t(()=>[e(m(wl))]),_:1}),ri]),_:1}),e(x,{index:"service-activity",route:{name:"service-activity"}},{default:t(()=>[e(S,null,{default:t(()=>[e(m(Cl))]),_:1}),ii]),_:1})]),_:1})]),_:1},8,["default-active"])]),_:1})]),_:1}),e(V,{style:{"padding-top":"0","padding-right":"0"}},{default:t(()=>[e(h)]),_:1})]),_:1})]),_:1})]),_:1})}}});var di=ke(ui,[["__scopeId","data-v-cba5b7e0"]]);const ci={style:{"margin-bottom":"10px"}},pi={style:{"font-size":"var(--el-font-size-large)"}},mi=v("Group List"),vi=v("New Service"),_i=v("Save"),fi=v("Cancel"),gi=he({setup(l){const a=i(!1),n=Ue(),d=i({id:parseInt(n.currentRoute.value.params.gId),name:"",description:"",auth:0,soxApp:"0",token:"",contact:"",owners:[],namespaces:[],role:""}),p=i({id:n.currentRoute.value.params.sId,name:"",kind:"WebService",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",namespace:"",clusterName:[],ingressClusters:[],formTags:[],repository:"",chart:"",helmChart:""}),u=ie.getters.UserAuth.isAdmin,g=i({id:"",name:"",kind:"WebService",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",namespace:"",clusterName:[],ingressClusters:[],formTags:[],repository:"",chart:"",helmChart:""}),f=(Y,R,O)=>{R.length===0?O(new Error(Y.field+" is required")):O()},C=i([]),r=i([]),b=i([]),T=i(!1),k=i();let S=new RegExp(/^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/);const E=i({name:[{required:!0,message:"Please input service name",trigger:"blur"},{validator:(Y,R,O)=>{let $=R;S.test($)?O():O(new Error("service name must consist of lower case alphanumeric characters or '-' "))},trigger:"blur"},{min:1,max:45,message:"Length should be 1 to 45",trigger:"blur"}],description:[{min:0,max:255,message:"Length should be 0 to 255",trigger:"blur"}],clusterName:[{required:!0,message:"Please input cluster",trigger:"blur"},{validator:f,trigger:"blur"}],namespace:[{required:!0,message:"Please input namespace",trigger:"blur"}],repository:[{required:!0,message:"Please select repository",trigger:"blur"}],chart:[{required:!0,message:"Please select chart",trigger:"blur"}]}),z=i(!1),te=i({}),F=i([]);h();function h(){z.value=!!n.currentRoute.value.params.sId;let Y=ie.getters.ServiceManageOption().then(R=>(C.value=Object.values(R.cluster).map(O=>O.name),R));if(z.value){let R=ie.getters.CurrentService(n.currentRoute.value.params.sId).then(O=>{if(O||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),n.push({name:"service-management"})),p.value=O,w(O),O.kind===Xe){qe.GetRepositoryList({}).then(L=>{te.value=L.data});const $=O.helmChart.split("|");g.value.repository=$[0],g.value.chart=$.length>0?$[1]:"",g.value.repository!==""&&V()}});Promise.all([Y,R]).then(O=>{z.value&&u&&O[0].systemControl&&O[0].systemControl.serviceNameEdit&&fe.GetDeployCount({gid:d.value.id,sid:p.value.id,vid:0,cluster:""}).then($=>T.value=$.data===0)})}ie.getters.CurrentGroup(n.currentRoute.value.params.gId).then(R=>{var O;R||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),n.push({name:"service-management"})),a.value=ie.getters.EditAuth(R.id),d.value=R,g.value.groupId=(O=d.value)==null?void 0:O.id,fe.GetGroupTags(d.value.id).then($=>{r.value=$.data}),b.value=R.namespaces})}const V=()=>{!g.value.repository||qe.GetChartList(g.value.repository,{}).then(Y=>{F.value=Y.data})},I=()=>{g.value.kind===Xe&&qe.GetRepositoryList({}).then(Y=>{te.value=Y.data})};function w(Y){g.value=$t.exports.cloneDeep(Y),g.value.formTags=g.value.tags.map(R=>R.tagName)}function G(Y){g.value.ingressClusters.map((R,O)=>{R===Y&&g.value.ingressClusters.splice(O,1)})}function J(){let Y=new Map(g.value.tags.map(R=>[R.tagName,R]));g.value.tags=[];for(let R of g.value.formTags){let O=Y.get(R);O?g.value.tags.push(O):g.value.tags.push({id:0,tagName:R,serviceId:p.value.id})}g.value.helmChart=`${g.value.repository}|${g.value.chart}`,z.value?fe.UpdateService(g.value).then(R=>{ye({showClose:!0,message:"Update successfully.",type:"success"})}):fe.CreateService(g.value).then(R=>{ye({showClose:!0,message:"Create successfully.",type:"success"}),A(R.data.id)})}async function H(Y){!Y||await Y.validate((R,O)=>{if(R){let $=!1;for(let L of p.value.clusterName)if(!g.value.clusterName.find(B=>B===L)){$=!0;break}$?Gt.confirm("Deleting a cluster will clear the cluster information under version and clear their deployed instances,are you sure?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{J()}):J()}else ye({showClose:!0,message:"Validate failed",type:"error"})})}function N(){var Y;n.push({name:"service-list",params:{gId:(Y=d.value)==null?void 0:Y.id}})}function A(Y){var R;n.push({name:"version-list",params:{gId:(R=d.value)==null?void 0:R.id,sId:Y}})}return(Y,R)=>{const O=o("el-breadcrumb-item"),$=o("el-breadcrumb"),L=o("el-header"),W=o("el-input"),B=o("el-form-item"),Z=o("el-option"),X=o("el-select"),ae=o("el-button"),j=o("el-form"),K=o("el-main"),M=o("el-container");return s(),y(M,null,{default:t(()=>[z.value?U("",!0):(s(),y(L,{key:0},{default:t(()=>[c("div",ci,[c("h2",pi,D(d.value.name),1)]),e($,{separator:"/"},{default:t(()=>[e(O,{to:{path:"/service-management"}},{default:t(()=>[mi]),_:1}),e(O,{to:{name:"service-list",params:{gId:d.value.id}}},{default:t(()=>[v(D(d.value.name),1)]),_:1},8,["to"]),e(O,null,{default:t(()=>[vi]),_:1})]),_:1})]),_:1})),e(K,{class:"radius",style:st({borderRadius:"var(--el-border-radius-base)"})},{default:t(()=>[e(j,{style:{"margin-top":"10px"},model:g.value,"label-width":"120px",rules:E.value,ref_key:"ruleFormRef",ref:k},{default:t(()=>[e(B,{label:"Service Name",prop:"name"},{default:t(()=>[e(W,{disabled:z.value&&!T.value,maxlength:"45",class:"form-body",modelValue:g.value.name,"onUpdate:modelValue":R[0]||(R[0]=se=>g.value.name=se)},null,8,["disabled","modelValue"])]),_:1}),e(B,{label:"Description",prop:"description"},{default:t(()=>[e(W,{maxlength:"255",class:"form-body",modelValue:g.value.description,"onUpdate:modelValue":R[1]||(R[1]=se=>g.value.description=se),type:"textarea"},null,8,["modelValue"])]),_:1}),e(B,{label:"Kind"},{default:t(()=>[e(X,{disabled:z.value,class:"form-body",modelValue:g.value.kind,"onUpdate:modelValue":R[2]||(R[2]=se=>g.value.kind=se),placeholder:"please select your kind",onChange:I},{default:t(()=>[e(Z,{label:m(We),value:m(We)},null,8,["label","value"]),e(Z,{label:m(_t),value:m(_t)},null,8,["label","value"]),e(Z,{label:m(Xe),value:m(Xe)},null,8,["label","value"])]),_:1},8,["disabled","modelValue"])]),_:1}),e(B,{label:"Cluster",prop:"clusterName"},{default:t(()=>[e(X,{modelValue:g.value.clusterName,"onUpdate:modelValue":R[3]||(R[3]=se=>g.value.clusterName=se),onRemoveTag:G,multiple:"",filterable:"","reserve-keyword":"",placeholder:"Please enter a keyword",class:"form-body"},{default:t(()=>[(s(!0),P(oe,null,de(C.value,se=>(s(),y(Z,{label:se==null?void 0:se.toUpperCase(),value:se},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(B,{label:"Namespace",prop:"namespace"},{default:t(()=>[e(X,{modelValue:g.value.namespace,"onUpdate:modelValue":R[4]||(R[4]=se=>g.value.namespace=se),placeholder:"Please enter a keyword",class:"form-body"},{default:t(()=>[(s(!0),P(oe,null,de(b.value,se=>(s(),y(Z,{label:se,value:se},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),m(u)&&g.value.kind===m(We)?(s(),y(B,{key:0,label:"Ingress",prop:"ingressClusters"},{default:t(()=>[e(X,{modelValue:g.value.ingressClusters,"onUpdate:modelValue":R[5]||(R[5]=se=>g.value.ingressClusters=se),multiple:"",filterable:"","reserve-keyword":"",placeholder:"Please enter a keyword",class:"form-body"},{default:t(()=>[(s(!0),P(oe,null,de(g.value.clusterName,se=>(s(),y(Z,{label:se==null?void 0:se.toUpperCase(),value:se},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):U("",!0),g.value.kind===m(Xe)?(s(),y(B,{key:1,label:"Repository",prop:"repository"},{default:t(()=>[e(X,{class:"form-body",onChange:V,modelValue:g.value.repository,"onUpdate:modelValue":R[6]||(R[6]=se=>g.value.repository=se),placeholder:"please select your Repository"},{default:t(()=>[(s(!0),P(oe,null,de(Object.keys(te.value),se=>(s(),y(Z,{label:se,value:se},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):U("",!0),g.value.kind===m(Xe)?(s(),y(B,{key:2,label:"Chart",prop:"chart"},{default:t(()=>[e(X,{class:"form-body",modelValue:g.value.chart,"onUpdate:modelValue":R[7]||(R[7]=se=>g.value.chart=se),placeholder:"please select your Chart"},{default:t(()=>[(s(!0),P(oe,null,de(F.value,se=>(s(),y(Z,{label:se==null?void 0:se.name,value:se==null?void 0:se.name},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})):U("",!0),e(B,{label:"Tags"},{default:t(()=>[e(X,{class:"form-body",modelValue:g.value.formTags,"onUpdate:modelValue":R[8]||(R[8]=se=>g.value.formTags=se),multiple:"",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"Choose tags or input new tags"},{default:t(()=>[(s(!0),P(oe,null,de(r.value,se=>(s(),y(Z,{key:se,label:se,value:se},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.value?(s(),y(B,{key:3},{default:t(()=>[e(ae,{type:"primary",onClick:R[9]||(R[9]=se=>H(k.value))},{default:t(()=>[_i]),_:1}),z.value?U("",!0):(s(),y(ae,{key:0,onClick:R[10]||(R[10]=se=>N())},{default:t(()=>[fi]),_:1}))]),_:1})):U("",!0)]),_:1},8,["model","rules"])]),_:1},8,["style"])]),_:1})}}});var $a=ke(gi,[["__scopeId","data-v-46b0e1c7"]]);const yi={key:0},hi={key:1},bi=v("Import"),wi=he({props:{kind:null,cluster:null},emits:["importResult"],setup(l,{emit:a}){const n=l,d=i(),p=Ue(),_=parseInt(p.currentRoute.value.params.gId);p.currentRoute.value.params.sId,i("1");const u=i([]),g=i(!1),f=i([]),C=i([]),r=i([]),b=i([]),T=i({kind:n.kind,nes:{cluster:"",serviceId:""},spinnaker:{cluster:"",namespace:"",name:""}});k();function k(){ie.getters.ServiceManageOption().then(h=>{u.value=Object.values(h.cluster).map(V=>V.name),T.value.spinnaker.cluster=n.cluster})}const S=h=>{let V={cluster:T.value.spinnaker.cluster,resourceType:"namespace",keywords:h,namespace:""};qe.GetResourceList(V).then(I=>{f.value=I.data})},x=h=>{let V={cluster:T.value.spinnaker.cluster,resourceType:"deployment",keywords:h,namespace:T.value.spinnaker.namespace};qe.GetResourceList(V).then(I=>{C.value=I.data})},E=h=>{let V={cluster:"",resourceType:"nes-cluster",keywords:h,namespace:""};qe.GetResourceList(V).then(I=>{r.value=I.data})},z=h=>{let V={cluster:T.value.nes.cluster,resourceType:"nes-service",keywords:h,namespace:""};qe.GetResourceList(V).then(I=>{b.value=I.data})};function te(h,V){switch(V){case 0:r.value=[];break;case 1:b.value=[];break;case 2:f.value=[];break;case 3:C.value=[];break}}async function F(h){!h||await h.validate((V,I)=>{V?fe.ImportVersionCluster(_,T.value).then(w=>{a("importResult",w.data);for(let G in w.data.warningMsg){let J="";for(let[H,N]of w.data.warningMsg[G].entries())J=J.concat(`<p><span>${H+1}. </span>${N.warningMsg}</p>`);setTimeout(()=>{ol({title:G,duration:0,dangerouslyUseHTMLString:!0,type:"warning",message:J})},500)}}):ye({showClose:!0,message:"Validate failed",type:"error"})})}return(h,V)=>{const I=o("el-option"),w=o("el-select"),G=o("el-form-item"),J=o("el-button"),H=o("el-form");return s(),y(H,{model:T.value,"label-width":"200px",ref_key:"ruleFormRef",ref:d},{default:t(()=>[T.value.kind===1?(s(),P("div",yi,[e(G,{rules:{required:!0,message:"cluster can not be null",trigger:"blur"},label:"NES Cluster",prop:"nes.cluster"},{default:t(()=>[e(w,{modelValue:T.value.nes.cluster,"onUpdate:modelValue":V[0]||(V[0]=N=>T.value.nes.cluster=N),clearable:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":E,loading:g.value,onChange:V[1]||(V[1]=N=>T.value.nes.serviceId=""),style:{width:"500px"},onVisibleChange:V[2]||(V[2]=N=>te(N,0))},{default:t(()=>[(s(!0),P(oe,null,de(r.value,N=>(s(),y(I,{key:N.name,label:`${N.name}-(location:${N.location})`,value:N.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(G,{rules:{required:!0,message:"service can not be null",trigger:"blur"},label:"NES Service",prop:"nes.serviceId"},{default:t(()=>[e(w,{modelValue:T.value.nes.serviceId,"onUpdate:modelValue":V[3]||(V[3]=N=>T.value.nes.serviceId=N),filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":z,loading:g.value,style:{width:"500px"},onVisibleChange:V[4]||(V[4]=N=>te(N,1))},{default:t(()=>[(s(!0),P(oe,null,de(b.value,N=>(s(),y(I,{key:N.name,label:N.name,value:N.serviceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})])):U("",!0),T.value.kind===2?(s(),P("div",hi,[e(G,{label:"Kubernetes Cluster",prop:"spinnaker.cluster"},{default:t(()=>[e(w,{style:{width:"200px"},modelValue:T.value.spinnaker.cluster,"onUpdate:modelValue":V[5]||(V[5]=N=>T.value.spinnaker.cluster=N),onChange:V[6]||(V[6]=N=>{T.value.spinnaker.namespace="",T.value.spinnaker.name=""})},{default:t(()=>[(s(!0),P(oe,null,de(u.value,N=>(s(),y(I,{label:N==null?void 0:N.toUpperCase(),value:N},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(G,{label:"Kubernetes Namespace",rules:{required:!0,message:"namespace can not be null",trigger:"blur"},prop:"spinnaker.namespace"},{default:t(()=>[e(w,{modelValue:T.value.spinnaker.namespace,"onUpdate:modelValue":V[7]||(V[7]=N=>T.value.spinnaker.namespace=N),filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":S,loading:g.value,onChange:V[8]||(V[8]=N=>T.value.spinnaker.name=""),style:{width:"500px"},onVisibleChange:V[9]||(V[9]=N=>te(N,2))},{default:t(()=>[(s(!0),P(oe,null,de(f.value,N=>(s(),y(I,{key:N.name,label:N.name,value:N.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(G,{label:"Deployment Name",rules:{required:!0,message:"name can not be null",trigger:"blur"},prop:"spinnaker.name"},{default:t(()=>[e(w,{modelValue:T.value.spinnaker.name,"onUpdate:modelValue":V[10]||(V[10]=N=>T.value.spinnaker.name=N),filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":x,loading:g.value,style:{width:"500px"},onVisibleChange:V[11]||(V[11]=N=>te(N,3))},{default:t(()=>[(s(!0),P(oe,null,de(C.value,N=>(s(),y(I,{key:N.name,label:N.name,value:N.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})])):U("",!0),e(G,null,{default:t(()=>[e(J,{type:"primary",onClick:V[12]||(V[12]=N=>F(d.value))},{default:t(()=>[bi]),_:1})]),_:1})]),_:1},8,["model"])}}});var Ci=ke(wi,[["__scopeId","data-v-2bba34d5"]]);const Oa=l=>(Re("data-v-39b10134"),l=l(),Ne(),l),ki=Oa(()=>c("span",null,"old",-1)),$i=Oa(()=>c("span",null,"new",-1)),xi=["id"],Vi=he({props:{oldContent:null,newContent:null,language:null,show:{type:Boolean}},setup(l){const a=l,n=i();var d;const p=()=>{setTimeout(()=>{d=Ke.createDiffEditor(n.value,{enableSplitViewResizing:!1,readOnly:!0,theme:"vs-dark",lineNumbers:"on"});var _=Ke.createModel(a.oldContent,a.language),u=Ke.createModel(a.newContent,a.language);d.setModel({original:_,modified:u})},0)};return Pe(()=>a.show,(_,u)=>{_?p():d&&d.dispose()}),Pe(()=>a.oldContent,_=>{d&&d.dispose(),p()}),Pe(()=>a.newContent,(_,u)=>{d&&d.dispose(),p()}),ze(()=>{a.show&&p()}),(_,u)=>{const g=o("el-col"),f=o("el-row");return s(),P(oe,null,[l.show?(s(),y(f,{key:0,style:{width:"100%"}},{default:t(()=>[e(g,{span:12,style:{width:"50%"}},{default:t(()=>[va(_.$slots,"oldTitle",{},()=>[ki],!0)]),_:3}),e(g,{span:12},{default:t(()=>[va(_.$slots,"newTitle",{},()=>[$i],!0)]),_:3})]),_:3})):U("",!0),l.show?(s(),P("div",{key:1,id:new Date().getTime().toString()+"_monaco",class:"monaco",ref_key:"d",ref:n},null,8,xi)):U("",!0)],64)}}});var Mt=ke(Vi,[["__scopeId","data-v-39b10134"]]);const Si={style:{display:"flex",width:"100%"}},Di={style:{display:"flex",width:"100%"}},Ii=c("span",{style:{color:"red"}},"Please enter complete image information.",-1),za=he({props:{flush:null,get:null,isPrd:{type:Boolean}},emits:["update:flush","update:get"],setup(l,{emit:a}){const n=l,d="dev-harbor.newegg.org",p="harbor.newegg.org",_=i(d),u=i(""),g=i(""),f=i([]),C=i([]),r=i(!1),b=i(!1);Pe(n,()=>{u.value===""&&g.value===""&&(_.value=n.isPrd?p:d)}),Sa(()=>{a("update:flush",F=>{let h=te(F);_.value=n.isPrd?p:h.domain,u.value=h.projectName,g.value=h.repositoryName}),a("update:get",()=>_.value+"/"+u.value+"/"+g.value)});const T=(F,h,V)=>{if(u.value==""){V(new Error("Project is null"));return}V()},k=(F,h,V)=>{if(g.value==""){V(new Error("Repository is null"));return}V()},S=async function(F){setTimeout(()=>{r.value=!0,Tt.SearchImageProject(_.value,F).then(h=>{let V=[];for(let I=0;I<h.length;I++)V.push(h[I].name);f.value=V}).finally(()=>{r.value=!1})},300)},x=async function(F){u.value?setTimeout(()=>{b.value=!0,Tt.SearchImageRepository(_.value,u.value,F).then(h=>{let V=[];for(let I=0;I<h.length;I++)V.push(h[I].name.substring(u.value.length+1));C.value=V}).finally(()=>{b.value=!1})},300):C.value=[]};function E(F){u.value="",g.value=""}function z(F){g.value="",f.value=[],C.value=[]}function te(F){let h={domain:_.value,image:F,projectName:"",repositoryName:"",tag:""};if(!F)return h;let V=h.image.split(":");if(h.image=V[0],V.length>1&&(h.tag=V[1]),!h.image)return h;let I=h.image.split("/");if(I[0]==d||I[0]==p){if(h.domain=I[0],I.length>1&&(h.projectName=I[1]),I.length>2){h.repositoryName=I[2];for(let w=3;w<I.length;w++)h.repositoryName=h.repositoryName+"/"+I[w]}return h}if(I.length>1){h.projectName=I[0],h.repositoryName=I[1];for(let w=2;w<I.length;w++)h.repositoryName=h.repositoryName+"/"+I[w];return h}return h}return(F,h)=>{const V=o("el-option"),I=o("el-select"),w=o("el-form-item");return s(),P(oe,null,[c("div",Si,[e(w,{label:"Domain"},{default:t(()=>[e(I,{modelValue:_.value,"onUpdate:modelValue":h[0]||(h[0]=G=>_.value=G),placeholder:"select hub",onChange:E},{default:t(()=>[l.isPrd?U("",!0):(s(),y(V,{key:0,label:d,value:d})),(s(),y(V,{key:1,label:p,value:p}))]),_:1},8,["modelValue"])]),_:1}),e(w,{rules:[{validator:T,trigger:"blur"}],"label-width":"0px",prop:"project",style:{width:"280px"}},{default:t(()=>[e(I,{modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=G=>u.value=G),filterable:"","allow-create":"",remote:"","remote-method":S,loading:r.value,onChange:z,placeholder:"input project",style:{width:"100%"}},{default:t(()=>[(s(!0),P(oe,null,de(f.value,(G,J)=>(s(),y(V,{key:J+1,label:G,value:G},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1},8,["rules"]),e(w,{rules:[{validator:k,trigger:"blur"}],"label-width":"0px",style:{flex:"1"},prop:"repository"},{default:t(()=>[e(I,{modelValue:g.value,"onUpdate:modelValue":h[2]||(h[2]=G=>g.value=G),filterable:"","allow-create":"",remote:"","remote-method":x,loading:b.value,placeholder:"input repository",style:{width:"100%"}},{default:t(()=>[(s(!0),P(oe,null,de(C.value,(G,J)=>(s(),y(V,{key:J+1,label:G,value:G},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1},8,["rules"])]),c("div",Di,[u.value&&g.value?(s(),y(w,{key:0,label:"Image"},{default:t(()=>[v(D(_.value)+"/"+D(u.value)+"/"+D(g.value),1)]),_:1})):U("",!0),!u.value||!g.value?(s(),y(w,{key:1,label:"Image"},{default:t(()=>[Ii]),_:1})):U("",!0)])],64)}}}),Ri=v(" Volumes "),Ni=v("Add Volume"),Ma=he({props:{modelValue:null,isAdmin:{type:Boolean}},emits:["update:modelValue"],setup(l,{emit:a}){const n=l,d=nt({get:()=>n.modelValue,set:C=>{a("update:modelValue",C)}}),p=i([]),_=new RegExp(/^[a-z0-9][-a-z0-9]*[a-z0-9]$/),u=i({name:"",mountPath:""});ze(()=>{ie.getters.ServiceManageOption().then(C=>{p.value=C.globalVolume,g()})});function g(){if(d.value.length===0)return;let C=[];for(let r of d.value)p.value.find(T=>T.mountPath===r.mountPath)||C.push(r);p.value=p.value.concat(C)}function f(){if(u.value.name===""||u.value.mountPath===""){ye({showClose:!0,message:"name or mountPath can not be empty",type:"error"});return}else if(_.test(u.value.name)){if(!u.value.mountPath.startsWith("/")||u.value.mountPath==="/"){wa("The mountPath must start with '/' and can not the root directory");return}}else{wa("The name is invalid,regex used for validation is '^[a-z0-9][-a-z0-9]*[a-z0-9]$'");return}p.value.push(u.value),d.value.push(u.value),u.value={name:"",mountPath:""}}return(C,r)=>{const b=o("el-option"),T=o("el-select"),k=o("el-tag"),S=o("el-col"),x=o("el-input"),E=o("el-form-item"),z=o("el-button"),te=o("el-row"),F=o("el-card");return s(),y(E,{label:"Volume"},{default:t(()=>[e(F,{shadow:"hover",class:"panel"},{default:t(()=>[e(E,{label:"Volumes"},{label:t(()=>[Ri,e(Ee,{title:"Volumes",content:"Please use default volumes,If there is a special volume, contact devops to add it"})]),default:t(()=>[e(te,null,{default:t(()=>[e(S,{span:l.isAdmin?8:24},{default:t(()=>[e(T,{modelValue:m(d),"onUpdate:modelValue":r[0]||(r[0]=h=>Qt(d)?d.value=h:null),multiple:"","reserve-keyword":"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"Please enter a keyword","value-key":"mountPath"},{default:t(()=>[(s(!0),P(oe,null,de(p.value,h=>(s(),y(b,{key:h.mountPath,label:h.mountPath,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("div",null,[(s(!0),P(oe,null,de(m(d),(h,V)=>(s(),y(k,{style:{"margin-right":"5px"},key:V},{default:t(()=>[v(D(h.mountPath),1)]),_:2},1024))),128))])]),_:1},8,["span"]),l.isAdmin?(s(),y(S,{key:0,span:6},{default:t(()=>[e(E,{label:"Name"},{default:t(()=>[e(x,{modelValue:u.value.name,"onUpdate:modelValue":r[1]||(r[1]=h=>u.value.name=h)},null,8,["modelValue"])]),_:1})]),_:1})):U("",!0),l.isAdmin?(s(),y(S,{key:1,span:6},{default:t(()=>[e(E,{label:"MountPath"},{default:t(()=>[e(x,{modelValue:u.value.mountPath,"onUpdate:modelValue":r[2]||(r[2]=h=>u.value.mountPath=h)},null,8,["modelValue"])]),_:1})]),_:1})):U("",!0),l.isAdmin?(s(),y(S,{key:2,span:4},{default:t(()=>[e(z,{style:{"margin-left":"10px"},onClick:f,type:"primary"},{default:t(()=>[Ni]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ui=v("custom"),qa=he({props:{flush:null,get:null},emits:["update:flush","update:get"],setup(l,{emit:a}){const n=i({limits:{cpu:0,memoryUnit:"Mi",memoryValue:0},requests:{cpu:0,memoryUnit:"Mi",memoryValue:0}}),d=i("custom"),p=i({}),_=i({limits:{cpu:"0.5",memory:"256Mi"},requests:{cpu:"0.2",memory:"128Mi"}});Sa(()=>{a("update:flush",r=>{ie.getters.ServiceManageOption().then(b=>{p.value=b.resource,_.value=r,u(_.value),f()})}),a("update:get",()=>(_.value.limits.memory=n.value.limits.memoryValue+n.value.limits.memoryUnit,_.value.requests.memory=n.value.requests.memoryValue+n.value.requests.memoryUnit,_.value.limits.cpu=n.value.limits.cpu.toString(),_.value.requests.cpu=n.value.requests.cpu.toString(),_.value))});function u(r){d.value="custom";for(let b in p.value){let T=p.value[b];if(T.limits.cpu===r.limits.cpu&&T.limits.memory===r.limits.memory&&T.requests.cpu===r.requests.cpu&&T.requests.memory===r.requests.memory){d.value=b;break}}}function g(r){r!="custom"&&(_.value=p.value[r],f())}function f(){let r=_.value.limits;n.value.limits.cpu=+r.cpu,n.value.limits.memoryUnit=r.memory.substring(r.memory.length-2),n.value.limits.memoryValue=parseInt(r.memory.substring(0,r.memory.length-2));let b=_.value.requests;n.value.requests.cpu=+b.cpu,n.value.requests.memoryUnit=b.memory.substring(b.memory.length-2),n.value.requests.memoryValue=parseInt(b.memory.substring(0,b.memory.length-2))}function C(r,b){let k=r==="Mi"?1024:.0009765625,S;b===0?S=n.value.limits:S=n.value.requests,S.memoryValue=S.memoryValue*k}return(r,b)=>{const T=o("el-radio"),k=o("el-radio-group"),S=o("el-input-number"),x=o("el-form-item"),E=o("el-col"),z=o("el-option"),te=o("el-select"),F=o("el-row"),h=o("el-card");return s(),y(x,{label:"Resource"},{default:t(()=>[e(h,{shadow:"hover",class:"panel"},{default:t(()=>[e(k,{modelValue:d.value,"onUpdate:modelValue":b[0]||(b[0]=V=>d.value=V),onChange:b[1]||(b[1]=V=>g(V.toString()))},{default:t(()=>[(s(!0),P(oe,null,de(p.value,(V,I)=>(s(),y(T,{label:I,key:I},{default:t(()=>[v(D(I),1)]),_:2},1032,["label"]))),128)),e(T,{label:"custom"},{default:t(()=>[Ui]),_:1})]),_:1},8,["modelValue"]),e(x,{label:"limits",class:"top"},{default:t(()=>[e(F,{gutter:4},{default:t(()=>[e(E,{span:8},{default:t(()=>[e(x,{label:"cpu"},{default:t(()=>[e(S,{controls:!1,max:4,min:.01,precision:2,disabled:d.value!=="custom",class:"form-body",modelValue:n.value.limits.cpu,"onUpdate:modelValue":b[2]||(b[2]=V=>n.value.limits.cpu=V)},null,8,["min","disabled","modelValue"])]),_:1})]),_:1}),e(E,{span:10},{default:t(()=>[e(x,{label:"memory"},{default:t(()=>[e(S,{controls:!1,min:n.value.limits.memoryUnit==="Mi"?8:.1,max:n.value.limits.memoryUnit==="Mi"?8192:8,precision:1,disabled:d.value!=="custom",class:"form-body",modelValue:n.value.limits.memoryValue,"onUpdate:modelValue":b[3]||(b[3]=V=>n.value.limits.memoryValue=V)},null,8,["min","max","disabled","modelValue"])]),_:1})]),_:1}),e(E,{span:6},{default:t(()=>[e(te,{onChange:b[4]||(b[4]=V=>C(V,0)),disabled:d.value!=="custom",modelValue:n.value.limits.memoryUnit,"onUpdate:modelValue":b[5]||(b[5]=V=>n.value.limits.memoryUnit=V),placeholder:"Select",style:{width:"60px"}},{default:t(()=>[e(z,{label:"Mi",value:"Mi"}),e(z,{label:"Gi",value:"Gi"})]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{label:"requests",class:"top"},{default:t(()=>[e(F,{gutter:4},{default:t(()=>[e(E,{span:8},{default:t(()=>[e(x,{label:"cpu"},{default:t(()=>[e(S,{controls:!1,max:4,min:.01,precision:2,disabled:d.value!=="custom",class:"form-body",modelValue:n.value.requests.cpu,"onUpdate:modelValue":b[6]||(b[6]=V=>n.value.requests.cpu=V)},null,8,["min","disabled","modelValue"])]),_:1})]),_:1}),e(E,{span:10},{default:t(()=>[e(x,{label:"memory"},{default:t(()=>[e(S,{controls:!1,min:n.value.requests.memoryUnit==="Mi"?8:.1,max:n.value.requests.memoryUnit==="Mi"?8192:8,precision:1,disabled:d.value!=="custom",class:"form-body",modelValue:n.value.requests.memoryValue,"onUpdate:modelValue":b[7]||(b[7]=V=>n.value.requests.memoryValue=V)},null,8,["min","max","disabled","modelValue"])]),_:1})]),_:1}),e(E,{span:6},{default:t(()=>[e(te,{onChange:b[8]||(b[8]=V=>C(V,1)),disabled:d.value!=="custom",modelValue:n.value.requests.memoryUnit,"onUpdate:modelValue":b[9]||(b[9]=V=>n.value.requests.memoryUnit=V),placeholder:"Select",style:{width:"60px"}},{default:t(()=>[e(z,{label:"Mi",value:"Mi"}),e(z,{label:"Gi",value:"Gi"})]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});const rt=l=>(Re("data-v-a58580a6"),l=l(),Ne(),l),Pi={style:{display:"flex","margin-left":"8px","margin-bottom":"10px"}},Ai=v(" Copy Setting From"),Ei=v(" Import Setting From"),Ti=v(" NES "),Gi=v(" Spinnaker "),Li=v("Diff"),Oi=v(" HostName "),zi=v(" Monitor Path "),Mi=v(" Container Port "),qi=v(" Service Port "),Hi=v("Key"),ji=v("Value"),Fi={class:"top",style:{width:"100%"}},Bi=rt(()=>c("span",null,"InitialDelaySeconds",-1)),Ki=rt(()=>c("span",null,"InitialDelaySeconds",-1)),Wi=v(" Canary "),Yi={key:0},Ji=v(" Language "),Zi=v(" Analysis Time "),Qi=v("(min)"),Xi={style:{width:"100%"}},eu={style:{"padding-left":"10px"}},tu=v("Ingress Setting "),au=v("Not Activated"),lu=v(),nu=rt(()=>c("span",{style:{"font-weight":"bold",color:"red"}},"(This cluster need approved,please contact DevOps Team)",-1)),ou=rt(()=>c("div",{style:{"padding-left":"20px"}},[v(" Ingress may provide load balancing, SSL termination and name-based virtual hosting, but"),c("span",{style:{"font-weight":"bold"}}," we recommend that you use API Gateway"),v(" access service. For security reasons , the "),c("span",{style:{"font-weight":"bold",color:"orangered"}},"configuration of Ingress needs to be reviewed & approved")],-1)),su={style:{"padding-left":"10px"}},ru=v("Ingress Setting "),iu=rt(()=>c("div",{style:{"padding-left":"20px"}},[v(" Ingress may provide load balancing, SSL termination and name-based virtual hosting, but"),c("span",{style:{"font-weight":"bold"}}," we recommend that you use API Gateway"),v(" access service. For security reasons , the "),c("span",{style:{"font-weight":"bold",color:"orangered"}},"configuration of Ingress needs to be reviewed & approved")],-1)),uu={style:{"padding-left":"20px"}},du={key:0,style:{width:"100%"}},cu=v(" Class "),pu=v(" : "),mu=v("(s)"),vu=v(" Hosts "),_u=v(": "),fu={style:{display:"flex",width:"100%"}},gu=v("Save "),yu=rt(()=>c("span",null,"Current: ",-1)),hu=rt(()=>c("span",{style:{"margin-right":"30px"}}," Target ",-1)),bu=he({props:{version:null,cluster:null,clusterList:null},emits:["save"],setup(l,{emit:a}){const n=l,d=i(!1),p=i(!1),_=i(!1),u=i(!1),g=i(""),f=i(""),C=i(""),r=i(n.cluster),b=["ClusterIP","Loadbalance"],T=["nginx","internal","ec"],k=i(),S=Ue(),x=parseInt(S.currentRoute.value.params.gId),E=i(!1),z=i(1),te=i(new Map([])),F=i({id:null,cluster:r.value.name,canaryConfig:"dotnet-core",versionID:n.version.id,enabled:!1,setp:15,thresholdsMarginal:50,thresholdsPass:75,initTime:15,analysisTime:30}),h=i(!1);ie.getters.CurrentService(S.currentRoute.value.params.sId).then(K=>{K||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),S.push({name:"service-management"})),h.value=K.ingressClusters.filter(M=>M==n.cluster.name).length>0});const V=i(K=>{}),I=i(()=>""),w=i(K=>{}),G=i(()=>({limits:{cpu:"0.5",memory:"256Mi"},requests:{cpu:"0.2",memory:"128Mi"}})),J=(K,M,se)=>{let be=M;r.value.webServiceData.envs.filter(Ve=>Ve.name===be).length>1?se(new Error("Env cannot be repeated")):se()},H=(K,M,se)=>{let be=M;be===""&&se(new Error("IngressPath cannot be empty")),r.value.webServiceData.ingress.paths.filter(Ve=>Ve.path===be).length>1?se(new Error("IngressPath cannot be repeated")):se()},N=(K,M,se)=>{let be=M;be===""&&se(new Error("Host cannot be empty")),r.value.webServiceData.ingress.hosts.filter(Ve=>Ve===be).length>1?se(new Error("Host cannot be repeated")):se()};function A(){r.value.webServiceData.envs=r.value.webServiceData.envs.sort((K,M)=>K.type>M.type?-1:1),ie.getters.CurrentGroup(x).then(K=>{K||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),S.push({name:"service-management"})),d.value=ie.getters.EditAuth(K.id),p.value=ie.getters.IsAdmin}),V.value(r.value.image),w.value(r.value.webServiceData.resource),fe.GetCanaryConfigList().then(K=>te.value=K.data),fe.GetCanaryConfigDetail(n.version.id,r.value.name).then(K=>{K.data&&(F.value=K.data),$()})}ze(()=>{ie.getters.ServiceManageOption().then(K=>{let M=K.cluster[n.cluster.name];_.value=M.isPrd}),A()});const Y=()=>{r.value.webServiceData.hpa.enabled&&(r.value.webServiceData.replicas=r.value.webServiceData.hpa.minReplicas)};function R(K){f.value=JSON.stringify(K,null,4)}function O(){u.value=!0,g.value=JSON.stringify(r.value,null,4)}const $=()=>{let K=r.value.webServiceData.ingress;K.enabled&&!K.hosts&&(K.hosts=[]),K.enabled&&K.hosts.length==0&&(K.hosts=[""]),K.enabled&&!K.paths&&(K.paths=[]),K.enabled&&K.paths.length==0&&(K.paths=[{portName:"http",path:"/"}]),K.enabled&&K.hostPaths&&K.hostPaths.length>0&&(K.paths=K.hostPaths[0].paths,K.hosts=K.hostPaths.map(M=>M.host)),K.enabled&&!K.annotations&&(K.annotations=[]),K.enabled||(K.hosts=[])};function L(K){let M="http"+K.length;K.length==0&&(M="http",r.value.webServiceData.network.monitorPortName=M),K.push({portName:M,containerPort:8080,servicePort:80})}function W(K,M){let se=r.value.webServiceData.network.monitorPortName,be="http";K.splice(M,1),K.forEach((Ve,ve)=>{let le=ve==0?"http":"http"+ve;Ve.portName==se&&(be=le),Ve.portName=le}),r.value.webServiceData.network.monitorPortName=be}async function B(K){!K||await K.validate((M,se)=>{if(M){r.value.image=I.value(),r.value.webServiceData.resource=G.value();let be=r.value.image.split(":");r.value.image=be[0],n.version.clusters=[],r.value.webServiceData.ingress.hostPaths=r.value.webServiceData.ingress.hosts.map(ve=>({host:ve,paths:r.value.webServiceData.ingress.paths})),n.version.clusters.push(r.value);const Ve={version:n.version,canary:F.value};fe.UpsertVersionWithCanary(x,Ve).then(ve=>{ye({showClose:!0,message:"save success",type:"success"}),a("save",n.cluster.name),fe.GetVersionCluster(x,n.version.id,r.value.name,We).then(le=>{r.value=le.data,$(),A()})})}else ye({showClose:!0,message:"Validate failed",type:"error"})})}function Z(K,M){K.splice(M,1)}function X(K){z.value=K,E.value=!0}function ae(K){K.id=r.value.id,K.name=r.value.name,Object.assign(r.value,K),A(),E.value=!1}function j(K){Gt.confirm(`Copy setting with ${K.name} will change ${r.value.name} setting . Continue?`,"Tips",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{let M=$t.exports.cloneDeep(K);M.id=r.value.id,M.name=r.value.name,M.deployInfo.master=!1,M.webServiceData.ingress.enabled=!1,Object.assign(r.value,M),A()})}return(K,M)=>{const se=o("el-icon"),be=o("el-button"),Ve=o("el-dropdown-item"),ve=o("el-dropdown-menu"),le=o("el-dropdown"),Se=o("el-input-number"),ge=o("el-form-item"),ne=o("el-col"),ee=o("el-input"),Q=o("el-row"),_e=o("el-option"),$e=o("el-select"),re=o("el-card"),Le=o("el-checkbox"),Ye=o("el-tooltip"),He=o("el-tag"),it=o("el-collapse-item"),ht=o("el-collapse"),ue=o("el-form"),me=o("el-dialog");return s(),P(oe,null,[e(ue,{ref_key:"ruleFormRef",ref:k,model:r.value,"label-width":"100px"},{default:t(()=>[c("div",Pi,[l.clusterList.filter(q=>q.name!==l.cluster.name).length>0?(s(),y(le,{key:0,trigger:"click",style:{"margin-right":"10px"},onCommand:j,type:"success"},{dropdown:t(()=>[e(ve,null,{default:t(()=>[(s(!0),P(oe,null,de(l.clusterList.filter(q=>q.name!==l.cluster.name),q=>(s(),y(Ve,{command:q,key:q.name},{default:t(()=>[v(D(q.name.toUpperCase()),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:t(()=>[e(be,{icon:m(Lt),type:"success"},{default:t(()=>[Ai,e(se,{class:"el-icon--right"},{default:t(()=>[e(m(At))]),_:1})]),_:1},8,["icon"])]),_:1})):U("",!0),e(le,{trigger:"click",onCommand:X,type:"primary"},{dropdown:t(()=>[e(ve,null,{default:t(()=>[e(Ve,{command:1},{default:t(()=>[Ti]),_:1}),e(Ve,{command:2},{default:t(()=>[Gi]),_:1})]),_:1})]),default:t(()=>[e(be,{icon:m(kl),type:"primary"},{default:t(()=>[Ei,e(se,{class:"el-icon--right"},{default:t(()=>[e(m(At))]),_:1})]),_:1},8,["icon"])]),_:1}),l.clusterList.filter(q=>q.name!==l.cluster.name).length>0?(s(),y(be,{key:1,style:{"margin-left":"8px"},plain:"",icon:m(ta),onClick:O},{default:t(()=>[Li]),_:1},8,["icon"])):U("",!0)]),e(za,{flush:V.value,"onUpdate:flush":M[0]||(M[0]=q=>V.value=q),get:I.value,"onUpdate:get":M[1]||(M[1]=q=>I.value=q),"is-prd":_.value},null,8,["flush","get","is-prd"]),e(Q,{style:{"justify-content":"space-between","align-items":"center"}},{default:t(()=>[e(ne,{span:6},{default:t(()=>[e(ge,{label:"Replicas"},{default:t(()=>[e(Se,{style:{width:"100%"},min:1,max:50,class:"form-body",modelValue:r.value.webServiceData.replicas,"onUpdate:modelValue":M[2]||(M[2]=q=>r.value.webServiceData.replicas=q),"controls-position":"right",disabled:r.value.webServiceData.hpa.enabled},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(ne,{span:18},{default:t(()=>[e(ge,{"label-width":"120px"},{label:t(()=>[Oi,e(Ee,{title:"HostName",content:"The default machine name is Docker container HASH, you can customize the machine name"})]),default:t(()=>[e(ee,{class:"form-body",modelValue:r.value.webServiceData.hostName,"onUpdate:modelValue":M[3]||(M[3]=q=>r.value.webServiceData.hostName=q)},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:24},{default:t(()=>[e(ge,{label:"Command"},{default:t(()=>[e(ee,{textarea:"",class:"form-body",modelValue:r.value.webServiceData.command,"onUpdate:modelValue":M[4]||(M[4]=q=>r.value.webServiceData.command=q)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,{label:"Network"},{default:t(()=>[e(re,{shadow:"hover",class:"panel"},{default:t(()=>[e(ge,{label:"ServiceType",style:{"margin-bottom":"10px"}},{default:t(()=>[e($e,{disabled:!p.value,modelValue:r.value.webServiceData.network.serviceType,"onUpdate:modelValue":M[5]||(M[5]=q=>r.value.webServiceData.network.serviceType=q),class:"m-2",placeholder:"Select"},{default:t(()=>[(s(),P(oe,null,de(b,q=>e(_e,{label:q,value:q,key:q},null,8,["label","value"])),64))]),_:1},8,["disabled","modelValue"])]),_:1}),e(Q,{gutter:10,style:{"margin-bottom":"10px"}},{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,{label:"Monitor Port"},{default:t(()=>[e($e,{modelValue:r.value.webServiceData.network.monitorPortName,"onUpdate:modelValue":M[6]||(M[6]=q=>r.value.webServiceData.network.monitorPortName=q),class:"m-2",placeholder:"Select"},{default:t(()=>[(s(!0),P(oe,null,de(r.value.webServiceData.network.ports,q=>(s(),y(_e,{label:q.portName,value:q.portName,key:q.portName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:8},{default:t(()=>[e(ge,{"label-width":"120px"},{label:t(()=>[zi,e(Ee,{title:"Monitor Path",content:"The prometheus endpoint path, default is `/metrics`, java app maybe `/actuator/prometheus`"})]),default:t(()=>[e(ee,{modelValue:r.value.webServiceData.network.monitorPath,"onUpdate:modelValue":M[7]||(M[7]=q=>r.value.webServiceData.network.monitorPath=q)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge,{label:"PortMapping"},{default:t(()=>[(s(!0),P(oe,null,de(r.value.webServiceData.network.ports,(q,pe)=>(s(),y(Q,{class:"top",gutter:10,key:pe},{default:t(()=>[e(ne,{span:4},{default:t(()=>[e(ge,null,{default:t(()=>[e(ee,{disabled:"",modelValue:q.portName,"onUpdate:modelValue":we=>q.portName=we},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(ne,{span:6},{default:t(()=>[e(ge,{prop:`webServiceData.network.ports.${pe}.containerPort`,"label-width":"120px"},{label:t(()=>[Mi,e(Ee,{title:"Container Port",content:"The port your application listen on"})]),default:t(()=>[e(Se,{controls:!1,min:1001,max:65535,class:"form-body",modelValue:q.containerPort,"onUpdate:modelValue":we=>q.containerPort=we,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(ne,{span:6},{default:t(()=>[e(ge,{prop:`webServiceData.network.ports.${pe}.servicePort`,"label-width":"120px"},{label:t(()=>[qi,e(Ee,{title:"Service Port",content:"The virtual port number provided to other programs to access, mapping to Container Port."})]),default:t(()=>[e(Se,{controls:!1,min:0,max:65535,class:"form-body",modelValue:q.servicePort,"onUpdate:modelValue":we=>q.servicePort=we,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(ne,{span:4},{default:t(()=>[e(be,{disabled:pe===0,type:"danger",icon:m(je),onClick:we=>W(r.value.webServiceData.network.ports,pe),plain:""},null,8,["disabled","icon","onClick"])]),_:2},1024)]),_:2},1024))),128)),e(Q,{class:"top",style:{width:"100%"}},{default:t(()=>[e(be,{icon:m(Me),onClick:M[8]||(M[8]=q=>L(r.value.webServiceData.network.ports)),type:"primary",plain:""},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ge,{label:"Env"},{default:t(()=>[e(re,{shadow:"hover",class:"panel"},{default:t(()=>[e(ge,{label:"Customer"},{default:t(()=>[(s(!0),P(oe,null,de(r.value.webServiceData.envs,(q,pe)=>(s(),y(Q,{gutter:10,class:"top",key:pe,style:{width:"100%"}},{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,{rules:[{required:!0,message:"domain can not be null",trigger:"blur"},{validator:J,trigger:"blur"}],prop:`webServiceData.envs.${pe}.name`},{default:t(()=>[e(ee,{class:"form-body",modelValue:r.value.webServiceData.envs[pe].name,"onUpdate:modelValue":we=>r.value.webServiceData.envs[pe].name=we,disabled:q.type>0},{prepend:t(()=>[Hi]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(ne,{span:12},{default:t(()=>[e(ge,{rules:{required:!0,message:"domain can not be null",trigger:"blur"},prop:`webServiceData.envs.${pe}.value`},{default:t(()=>[e(ee,{class:"form-body",modelValue:r.value.webServiceData.envs[pe].value,"onUpdate:modelValue":we=>r.value.webServiceData.envs[pe].value=we,disabled:q.type>1},{prepend:t(()=>[ji]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:2},1024),e(ne,{span:4},{default:t(()=>[e(be,{type:"danger",icon:m(je),onClick:we=>Z(r.value.webServiceData.envs,pe),plain:"",disabled:q.type>0},null,8,["icon","onClick","disabled"])]),_:2},1024)]),_:2},1024))),128)),c("div",Fi,[e(be,{class:"top",icon:m(Me),onClick:M[9]||(M[9]=q=>r.value.webServiceData.envs.push({name:"",value:"",type:0})),type:"primary",plain:""},null,8,["icon"])])]),_:1})]),_:1})]),_:1}),e(Ma,{modelValue:r.value.webServiceData.volumes,"onUpdate:modelValue":M[10]||(M[10]=q=>r.value.webServiceData.volumes=q),"is-admin":p.value},null,8,["modelValue","is-admin"]),e(qa,{flush:w.value,"onUpdate:flush":M[11]||(M[11]=q=>w.value=q),get:G.value,"onUpdate:get":M[12]||(M[12]=q=>G.value=q)},null,8,["flush","get"]),e(ge,{label:"HPA"},{default:t(()=>[e(re,{shadow:"hover",class:"panel"},{default:t(()=>[e(Le,{modelValue:r.value.webServiceData.hpa.enabled,"onUpdate:modelValue":M[13]||(M[13]=q=>r.value.webServiceData.hpa.enabled=q),label:"Enabled",size:"large",onChange:Y},null,8,["modelValue"]),r.value.webServiceData.hpa.enabled?(s(),y(Q,{key:0},{default:t(()=>[e(ne,{span:6},{default:t(()=>[e(ge,{label:"MinReplicas"},{default:t(()=>[e(Se,{min:1,max:r.value.webServiceData.hpa.maxReplicas,class:"form-body",modelValue:r.value.webServiceData.hpa.minReplicas,"onUpdate:modelValue":M[14]||(M[14]=q=>r.value.webServiceData.hpa.minReplicas=q),"controls-position":"right",onChange:Y},null,8,["max","modelValue"])]),_:1})]),_:1}),e(ne,{span:6},{default:t(()=>[e(ge,{label:"MaxReplicas"},{default:t(()=>[e(Se,{min:r.value.webServiceData.hpa.minReplicas,max:100,class:"form-body",modelValue:r.value.webServiceData.hpa.maxReplicas,"onUpdate:modelValue":M[15]||(M[15]=q=>r.value.webServiceData.hpa.maxReplicas=q),"controls-position":"right"},null,8,["min","modelValue"])]),_:1})]),_:1}),e(ne,{span:6},{default:t(()=>[e(ge,{label:"CpuPercentage"},{default:t(()=>[e(Se,{min:1,max:100,class:"form-body",modelValue:r.value.webServiceData.hpa.metrics.cpuPercentage,"onUpdate:modelValue":M[16]||(M[16]=q=>r.value.webServiceData.hpa.metrics.cpuPercentage=q),"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:6},{default:t(()=>[e(ge,{label:"RequestsPerSeconds","label-width":"150px"},{default:t(()=>[e(Se,{min:1,class:"form-body",modelValue:r.value.webServiceData.hpa.metrics.requestsPerSeconds,"onUpdate:modelValue":M[17]||(M[17]=q=>r.value.webServiceData.hpa.metrics.requestsPerSeconds=q),"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}),e(ge,{label:"Probe"},{default:t(()=>[e(re,{shadow:"hover",class:"panel"},{default:t(()=>[e(ge,{class:"top",label:"LiveProbe"},{default:t(()=>[e(ge,{"label-width":"160px",label:"InitialDelaySeconds"},{label:t(()=>[e(Ye,{class:"box-item",effect:"dark",content:"How many seconds to wait after the container starts before the probe starts",placement:"top-start"},{default:t(()=>[e(se,null,{default:t(()=>[e(m(Pt))]),_:1})]),_:1}),Bi]),default:t(()=>[e(Se,{min:5,class:"form-body",modelValue:r.value.webServiceData.probe.livenessProbe.initialDelaySeconds,"onUpdate:modelValue":M[18]||(M[18]=q=>r.value.webServiceData.probe.livenessProbe.initialDelaySeconds=q),"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(ge,{label:"Path"},{default:t(()=>[e(ee,{disabled:r.value.webServiceData.probe.livenessProbe.usePort,class:"form-body",modelValue:r.value.webServiceData.probe.livenessProbe.path,"onUpdate:modelValue":M[19]||(M[19]=q=>r.value.webServiceData.probe.livenessProbe.path=q)},null,8,["disabled","modelValue"])]),_:1}),e(ge,{style:{"margin-left":"10px"}},{default:t(()=>[e(Le,{modelValue:r.value.webServiceData.probe.livenessProbe.usePort,"onUpdate:modelValue":M[20]||(M[20]=q=>r.value.webServiceData.probe.livenessProbe.usePort=q),label:"UsePort","label-width":"100px"},null,8,["modelValue"])]),_:1})]),_:1}),e(ge,{class:"top",label:"ReadyProbe"},{default:t(()=>[e(ge,{"label-width":"160px",label:"InitialDelaySeconds"},{label:t(()=>[e(Ye,{class:"box-item",effect:"dark",content:"How many seconds to wait after the container starts before the probe starts",placement:"top-start"},{default:t(()=>[e(se,null,{default:t(()=>[e(m(Pt))]),_:1})]),_:1}),Ki]),default:t(()=>[e(Se,{min:5,class:"form-body",modelValue:r.value.webServiceData.probe.readinessProbe.initialDelaySeconds,"onUpdate:modelValue":M[21]||(M[21]=q=>r.value.webServiceData.probe.readinessProbe.initialDelaySeconds=q),"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(ge,{label:"Path"},{default:t(()=>[e(ee,{disabled:r.value.webServiceData.probe.readinessProbe.usePort,class:"form-body",modelValue:r.value.webServiceData.probe.readinessProbe.path,"onUpdate:modelValue":M[22]||(M[22]=q=>r.value.webServiceData.probe.readinessProbe.path=q)},null,8,["disabled","modelValue"])]),_:1}),e(ge,{style:{"margin-left":"10px"}},{default:t(()=>[e(Le,{modelValue:r.value.webServiceData.probe.readinessProbe.usePort,"onUpdate:modelValue":M[23]||(M[23]=q=>r.value.webServiceData.probe.readinessProbe.usePort=q),label:"UsePort"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ge,null,{label:t(()=>[Wi,e(Ee,{title:"Canary Config",content:"Enabled or Disabled your canary analysis"})]),default:t(()=>[e(re,{shadow:"hover",class:"panel"},{default:t(()=>[e(Le,{modelValue:F.value.enabled,"onUpdate:modelValue":M[24]||(M[24]=q=>F.value.enabled=q),label:"Canary Analysis Enabled",size:"large"},null,8,["modelValue"]),F.value.enabled?(s(),P("div",Yi,[e(Q,null,{default:t(()=>[e(ne,{span:1}),e(ne,{span:8},{default:t(()=>[e(ge,null,{label:t(()=>[Ji,e(Ee,{title:"Language",content:"Your coding language"})]),default:t(()=>[e($e,{modelValue:F.value.canaryConfig,"onUpdate:modelValue":M[25]||(M[25]=q=>F.value.canaryConfig=q),class:"m-2",placeholder:"Select",style:{width:"100%"}},{default:t(()=>[(s(!0),P(oe,null,de(te.value,(q,pe,we)=>(s(),y(_e,{label:pe,value:pe,key:we},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:1}),e(ne,{span:9},{default:t(()=>[e(ge,{style:{display:"flex"},"label-width":150},{label:t(()=>[Zi,e(Ee,{title:"Canary Analysis Time",content:"Analysis Time"})]),default:t(()=>[e(Q,null,{default:t(()=>[e(ne,{span:12},{default:t(()=>[e(Se,{min:1,class:"form-body",modelValue:F.value.analysisTime,"onUpdate:modelValue":M[26]||(M[26]=q=>F.value.analysisTime=q),"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(ne,{style:{"margin-left":"5px"},span:2},{default:t(()=>[Qi]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):U("",!0)]),_:1})]),_:1}),e(ge,{label:"Advance"},{default:t(()=>[c("div",Xi,[e(ht,null,{default:t(()=>[h.value?U("",!0):(s(),y(it,{key:0,name:"1"},{title:t(()=>[c("span",eu,[tu,e(He,{size:"small",type:"info"},{default:t(()=>[au]),_:1}),lu,nu])]),default:t(()=>[ou]),_:1})),h.value?(s(),y(it,{key:1,name:"1"},{title:t(()=>[c("span",su,[ru,e(He,{size:"small"},{default:t(()=>[v(D(r.value.webServiceData.ingress.enabled?"Enabled":"Disabled"),1)]),_:1})])]),default:t(()=>[iu,c("div",uu,[e(Le,{modelValue:r.value.webServiceData.ingress.enabled,"onUpdate:modelValue":M[27]||(M[27]=q=>r.value.webServiceData.ingress.enabled=q),label:"Enabled",size:"large",onChange:$},null,8,["modelValue"]),r.value.webServiceData.ingress.enabled?(s(),P("div",du,[e(Q,null,{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,null,{label:t(()=>[cu,e(Ee,{title:"Ingress Class",content:"There are different class depending on the business, if you are not sure, please contact DevOps"}),pu]),default:t(()=>[e($e,{modelValue:r.value.webServiceData.ingress.class,"onUpdate:modelValue":M[28]||(M[28]=q=>r.value.webServiceData.ingress.class=q),class:"m-2",placeholder:"Select",style:{width:"100%"}},{default:t(()=>[(s(),P(oe,null,de(T,q=>e(_e,{label:q,value:q,key:q},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ne,{span:8},{default:t(()=>[e(ge,{label:"Timeout",style:{display:"flex"}},{default:t(()=>[e(Q,null,{default:t(()=>[e(ne,{span:12},{default:t(()=>[e(Se,{min:1,class:"form-body",modelValue:r.value.webServiceData.ingress.timeout,"onUpdate:modelValue":M[29]||(M[29]=q=>r.value.webServiceData.ingress.timeout=q),"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(ne,{style:{"margin-left":"5px"},span:2},{default:t(()=>[mu]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ge,{label:"Hosts:"},{label:t(()=>[vu,e(Ee,{title:"Bind Hosts",content:"List of Domains you want to bind to,example:abc.newegg.org"}),_u]),_:1}),(s(!0),P(oe,null,de(r.value.webServiceData.ingress.hosts,(q,pe)=>(s(),y(Q,{gutter:10,class:"top",key:pe,style:{"padding-left":"50px"}},{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,{rules:[{validator:N,trigger:"blur"}],label:"Host",prop:`ingress.hosts.${pe}`},{default:t(()=>[e(ee,{modelValue:r.value.webServiceData.ingress.hosts[pe],"onUpdate:modelValue":we=>r.value.webServiceData.ingress.hosts[pe]=we},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(ne,{span:4},{default:t(()=>[e(be,{disabled:pe===0,type:"danger",icon:m(je),onClick:we=>Z(r.value.webServiceData.ingress.hosts,pe),plain:""},null,8,["disabled","icon","onClick"])]),_:2},1024)]),_:2},1024))),128)),e(be,{class:"top",style:{"margin-left":"80px"},icon:m(Me),onClick:M[30]||(M[30]=q=>r.value.webServiceData.ingress.hosts.push("")),type:"primary",plain:""},null,8,["icon"]),e(ge,{label:"IngressPath:"}),(s(!0),P(oe,null,de(r.value.webServiceData.ingress.paths,(q,pe)=>(s(),y(Q,{gutter:10,class:"top",key:pe,style:{"padding-left":"50px"}},{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,{label:"PortName"},{default:t(()=>[e($e,{modelValue:q.portName,"onUpdate:modelValue":we=>q.portName=we},{default:t(()=>[(s(!0),P(oe,null,de(r.value.webServiceData.network.ports,(we,Te)=>(s(),y(_e,{label:we.portName,value:we.portName,key:Te},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(ne,{span:8},{default:t(()=>[e(ge,{rules:[{validator:H,trigger:"blur"}],label:"Path",prop:`ingress.paths.${pe}.path`},{default:t(()=>[e(ee,{modelValue:q.path,"onUpdate:modelValue":we=>q.path=we},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(ne,{span:4},{default:t(()=>[e(be,{disabled:pe===0,type:"danger",icon:m(je),onClick:we=>Z(r.value.webServiceData.ingress.paths,pe),plain:""},null,8,["disabled","icon","onClick"])]),_:2},1024)]),_:2},1024))),128)),e(be,{class:"top",style:{"margin-left":"80px"},icon:m(Me),onClick:M[31]||(M[31]=q=>r.value.webServiceData.ingress.paths.push({portName:"http",path:"/"})),type:"primary",plain:""},null,8,["icon"]),e(ge,{label:"Annotations:"}),(s(!0),P(oe,null,de(r.value.webServiceData.ingress.annotations,(q,pe)=>(s(),y(Q,{class:"top",key:pe,gutter:10,style:{"padding-left":"50px"}},{default:t(()=>[e(ne,{span:8},{default:t(()=>[e(ge,{label:"Name",rules:{required:!0,message:"annotation name can not be null",trigger:"blur"},prop:`ingress.annotations.${pe}.name`},{default:t(()=>[e(ee,{class:"form-body",modelValue:r.value.webServiceData.ingress.annotations[pe].name,"onUpdate:modelValue":we=>r.value.webServiceData.ingress.annotations[pe].name=we},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(ne,{span:8},{default:t(()=>[e(ge,{label:"Value",rules:{required:!0,message:"annotation value can not be null",trigger:"blur"},prop:`ingress.annotations.${pe}.value`},{default:t(()=>[e(ee,{class:"form-body",modelValue:r.value.webServiceData.ingress.annotations[pe].value,"onUpdate:modelValue":we=>r.value.webServiceData.ingress.annotations[pe].value=we},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(ne,{span:8},{default:t(()=>[e(be,{type:"danger",icon:m(je),onClick:we=>Z(r.value.webServiceData.ingress.annotations,pe),plain:""},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),128)),e(be,{class:"top",style:{"margin-left":"80px"},icon:m(Me),onClick:M[32]||(M[32]=q=>r.value.webServiceData.ingress.annotations.push({name:"",value:""})),type:"primary",plain:""},null,8,["icon"])])):U("",!0)])]),_:1})):U("",!0)]),_:1})])]),_:1}),d.value?(s(),y(ge,{key:0},{default:t(()=>[c("div",fu,[e(be,{type:"primary",onClick:M[33]||(M[33]=q=>B(k.value)),icon:m(pt)},{default:t(()=>[gu]),_:1},8,["icon"])])]),_:1})):U("",!0)]),_:1},8,["model"]),e(me,{"destroy-on-close":"",modelValue:E.value,"onUpdate:modelValue":M[34]||(M[34]=q=>E.value=q),title:"Version Import",width:"40%"},{default:t(()=>[e(Ci,{cluster:l.cluster.name,kind:z.value,onImportResult:ae},null,8,["cluster","kind"])]),_:1},8,["modelValue"]),e(me,{modelValue:u.value,"onUpdate:modelValue":M[36]||(M[36]=q=>u.value=q),title:"Version Diff",width:"90%"},{default:t(()=>[e(Mt,{show:!0,oldContent:g.value,newContent:f.value,language:"javascript"},{oldTitle:t(()=>[yu,c("span",null,D(r.value.name),1)]),newTitle:t(()=>[e($e,{filterable:"",modelValue:C.value,"onUpdate:modelValue":M[35]||(M[35]=q=>C.value=q),placeholder:"Select Version...",onChange:R,style:{"margin-bottom":"10px"}},{prefix:t(()=>[hu]),default:t(()=>[(s(!0),P(oe,null,de(l.clusterList.filter(q=>q.name!==l.cluster.name),q=>(s(),y(_e,{label:q.name,value:q},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["oldContent","newContent"])]),_:1},8,["modelValue"])],64)}}});var wu=ke(bu,[["__scopeId","data-v-a58580a6"]]);const Ha=l=>(Re("data-v-164e9944"),l=l(),Ne(),l),Cu={style:{display:"flex","margin-left":"8px","margin-bottom":"10px"}},ku=v(" Copy Setting From"),$u=v("Diff"),xu=v(" HostName "),Vu=v("Key"),Su=v("Value"),Du={class:"top",style:{width:"100%"}},Iu={style:{display:"flex",width:"100%"}},Ru=v("Save "),Nu=Ha(()=>c("span",null,"Current: ",-1)),Uu=Ha(()=>c("span",{style:{"margin-right":"30px"}}," Target ",-1)),Pu=he({props:{version:null,cluster:null,clusterList:null},emits:["save"],setup(l,{emit:a}){const n=l,d=i(!1),p=i(!1),_=i(!1),u=i(!1),g=i(""),f=i(""),C=i(""),r=i(n.cluster),b=i(),T=Ue(),k=parseInt(T.currentRoute.value.params.gId);i(!1),i(1);const S=i(!1);ie.getters.CurrentService(T.currentRoute.value.params.sId).then(N=>{N||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),T.push({name:"service-management"})),S.value=N.ingressClusters.filter(A=>A==n.cluster.name).length>0});const x=i(N=>{}),E=i(()=>""),z=i(N=>{}),te=i(()=>({limits:{cpu:"0.5",memory:"256Mi"},requests:{cpu:"0.2",memory:"128Mi"}})),F=(N,A,Y)=>{let R=A;r.value.consoleData.envs.filter(O=>O.name===R).length>1?Y(new Error("Env cannot be repeated")):Y()};function h(){r.value.consoleData.envs=r.value.consoleData.envs.sort((N,A)=>N.type>A.type?-1:1),ie.getters.CurrentGroup(k).then(N=>{N||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),T.push({name:"service-management"})),d.value=ie.getters.EditAuth(N.id),p.value=ie.getters.IsAdmin}),x.value(r.value.image),z.value(r.value.consoleData.resource)}ze(()=>{ie.getters.ServiceManageOption().then(N=>{let A=N.cluster[n.cluster.name];_.value=A.isPrd}),h()});const V=()=>{r.value.consoleData.hpa.enabled&&(r.value.consoleData.replicas=r.value.consoleData.hpa.minReplicas)};function I(N){f.value=JSON.stringify(N,null,4)}function w(){u.value=!0,g.value=JSON.stringify(r.value,null,4)}async function G(N){!N||await N.validate((A,Y)=>{if(A){r.value.image=E.value(),r.value.consoleData.resource=te.value();let R=r.value.image.split(":");r.value.image=R[0],n.version.clusters=[],n.version.clusters.push(r.value),fe.UpsertVersion(k,n.version).then(O=>{ye({showClose:!0,message:"save success",type:"success"}),a("save",n.cluster.name),fe.GetVersionCluster(k,n.version.id,r.value.name,_t).then($=>{r.value=$.data,h()})})}else ye({showClose:!0,message:"Validate failed",type:"error"})})}function J(N,A){N.splice(A,1)}function H(N){Gt.confirm(`Copy setting with ${N.name} will change ${r.value.name} setting . Continue?`,"Tips",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{let A=$t.exports.cloneDeep(N);A.id=r.value.id,A.name=r.value.name,A.deployInfo.master=!1,Object.assign(r.value,A),h()})}return(N,A)=>{const Y=o("el-icon"),R=o("el-button"),O=o("el-dropdown-item"),$=o("el-dropdown-menu"),L=o("el-dropdown"),W=o("el-input-number"),B=o("el-form-item"),Z=o("el-col"),X=o("el-input"),ae=o("el-row"),j=o("el-card"),K=o("el-checkbox"),M=o("el-form"),se=o("el-option"),be=o("el-select"),Ve=o("el-dialog");return s(),P(oe,null,[e(M,{ref_key:"ruleFormRef",ref:b,model:r.value,"label-width":"100px"},{default:t(()=>[c("div",Cu,[l.clusterList.filter(ve=>ve.name!==l.cluster.name).length>0?(s(),y(L,{key:0,trigger:"click",style:{"margin-right":"10px"},onCommand:H,type:"success"},{dropdown:t(()=>[e($,null,{default:t(()=>[(s(!0),P(oe,null,de(l.clusterList.filter(ve=>ve.name!==l.cluster.name),ve=>(s(),y(O,{command:ve,key:ve.name},{default:t(()=>[v(D(ve.name.toUpperCase()),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:t(()=>[e(R,{icon:m(Lt),type:"success"},{default:t(()=>[ku,e(Y,{class:"el-icon--right"},{default:t(()=>[e(m(At))]),_:1})]),_:1},8,["icon"])]),_:1})):U("",!0),l.clusterList.filter(ve=>ve.name!==l.cluster.name).length>0?(s(),y(R,{key:1,style:{"margin-left":"8px"},plain:"",icon:m(ta),onClick:w},{default:t(()=>[$u]),_:1},8,["icon"])):U("",!0)]),e(za,{flush:x.value,"onUpdate:flush":A[0]||(A[0]=ve=>x.value=ve),get:E.value,"onUpdate:get":A[1]||(A[1]=ve=>E.value=ve),"is-prd":_.value},null,8,["flush","get","is-prd"]),e(ae,{style:{"justify-content":"space-between","align-items":"center"}},{default:t(()=>[e(Z,{span:6},{default:t(()=>[e(B,{label:"Replicas"},{default:t(()=>[e(W,{style:{width:"100%"},min:1,max:50,class:"form-body",modelValue:r.value.consoleData.replicas,"onUpdate:modelValue":A[2]||(A[2]=ve=>r.value.consoleData.replicas=ve),"controls-position":"right",disabled:r.value.consoleData.hpa.enabled},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(Z,{span:18},{default:t(()=>[e(B,{"label-width":"120px"},{label:t(()=>[xu,e(Ee,{title:"HostName",content:"The default machine name is Docker container HASH, you can customize the machine name"})]),default:t(()=>[e(X,{class:"form-body",modelValue:r.value.consoleData.hostName,"onUpdate:modelValue":A[3]||(A[3]=ve=>r.value.consoleData.hostName=ve)},null,8,["modelValue"])]),_:1})]),_:1}),e(Z,{span:24},{default:t(()=>[e(B,{label:"Command"},{default:t(()=>[e(X,{textarea:"",class:"form-body",modelValue:r.value.consoleData.command,"onUpdate:modelValue":A[4]||(A[4]=ve=>r.value.consoleData.command=ve)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(B,{label:"Env"},{default:t(()=>[e(j,{shadow:"hover",class:"panel"},{default:t(()=>[e(B,{label:"Customer"},{default:t(()=>[(s(!0),P(oe,null,de(r.value.consoleData.envs,(ve,le)=>(s(),y(ae,{gutter:10,class:"top",key:le,style:{width:"100%"}},{default:t(()=>[e(Z,{span:8},{default:t(()=>[e(B,{rules:[{required:!0,message:"domain can not be null",trigger:"blur"},{validator:F,trigger:"blur"}],prop:`consoleData.envs.${le}.name`},{default:t(()=>[e(X,{class:"form-body",modelValue:r.value.consoleData.envs[le].name,"onUpdate:modelValue":Se=>r.value.consoleData.envs[le].name=Se,disabled:ve.type>0},{prepend:t(()=>[Vu]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(Z,{span:12},{default:t(()=>[e(B,{rules:{required:!0,message:"domain can not be null",trigger:"blur"},prop:`consoleData.envs.${le}.value`},{default:t(()=>[e(X,{class:"form-body",modelValue:r.value.consoleData.envs[le].value,"onUpdate:modelValue":Se=>r.value.consoleData.envs[le].value=Se,disabled:ve.type>1},{prepend:t(()=>[Su]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["prop"])]),_:2},1024),e(Z,{span:4},{default:t(()=>[e(R,{type:"danger",icon:m(je),onClick:Se=>J(r.value.consoleData.envs,le),plain:"",disabled:ve.type>0},null,8,["icon","onClick","disabled"])]),_:2},1024)]),_:2},1024))),128)),c("div",Du,[e(R,{class:"top",icon:m(Me),onClick:A[5]||(A[5]=ve=>r.value.consoleData.envs.push({name:"",value:"",type:0})),type:"primary",plain:""},null,8,["icon"])])]),_:1})]),_:1})]),_:1}),e(Ma,{modelValue:r.value.consoleData.volumes,"onUpdate:modelValue":A[6]||(A[6]=ve=>r.value.consoleData.volumes=ve),"is-admin":p.value},null,8,["modelValue","is-admin"]),e(qa,{flush:z.value,"onUpdate:flush":A[7]||(A[7]=ve=>z.value=ve),get:te.value,"onUpdate:get":A[8]||(A[8]=ve=>te.value=ve)},null,8,["flush","get"]),e(B,{label:"HPA"},{default:t(()=>[e(j,{shadow:"hover",class:"panel"},{default:t(()=>[e(K,{modelValue:r.value.consoleData.hpa.enabled,"onUpdate:modelValue":A[9]||(A[9]=ve=>r.value.consoleData.hpa.enabled=ve),label:"Enabled",size:"large",onChange:V},null,8,["modelValue"]),r.value.consoleData.hpa.enabled?(s(),y(ae,{key:0},{default:t(()=>[e(Z,{span:6},{default:t(()=>[e(B,{label:"MinReplicas"},{default:t(()=>[e(W,{min:1,max:r.value.consoleData.hpa.maxReplicas,class:"form-body",modelValue:r.value.consoleData.hpa.minReplicas,"onUpdate:modelValue":A[10]||(A[10]=ve=>r.value.consoleData.hpa.minReplicas=ve),"controls-position":"right",onChange:V},null,8,["max","modelValue"])]),_:1})]),_:1}),e(Z,{span:6},{default:t(()=>[e(B,{label:"MaxReplicas"},{default:t(()=>[e(W,{min:r.value.consoleData.hpa.minReplicas,max:100,class:"form-body",modelValue:r.value.consoleData.hpa.maxReplicas,"onUpdate:modelValue":A[11]||(A[11]=ve=>r.value.consoleData.hpa.maxReplicas=ve),"controls-position":"right"},null,8,["min","modelValue"])]),_:1})]),_:1}),e(Z,{span:6},{default:t(()=>[e(B,{label:"CpuPercentage"},{default:t(()=>[e(W,{min:1,max:100,class:"form-body",modelValue:r.value.consoleData.hpa.metrics.cpuPercentage,"onUpdate:modelValue":A[12]||(A[12]=ve=>r.value.consoleData.hpa.metrics.cpuPercentage=ve),"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}),d.value?(s(),y(B,{key:0},{default:t(()=>[c("div",Iu,[e(R,{type:"primary",onClick:A[13]||(A[13]=ve=>G(b.value)),icon:m(pt)},{default:t(()=>[Ru]),_:1},8,["icon"])])]),_:1})):U("",!0)]),_:1},8,["model"]),e(Ve,{modelValue:u.value,"onUpdate:modelValue":A[15]||(A[15]=ve=>u.value=ve),title:"Version Diff",width:"90%"},{default:t(()=>[e(Mt,{show:!0,oldContent:g.value,newContent:f.value,language:"javascript"},{oldTitle:t(()=>[Nu,c("span",null,D(r.value.name),1)]),newTitle:t(()=>[e(be,{filterable:"",modelValue:C.value,"onUpdate:modelValue":A[14]||(A[14]=ve=>C.value=ve),placeholder:"Select Version...",onChange:I,style:{"margin-bottom":"10px"}},{prefix:t(()=>[Uu]),default:t(()=>[(s(!0),P(oe,null,de(l.clusterList.filter(ve=>ve.name!==l.cluster.name),ve=>(s(),y(se,{label:ve.name,value:ve},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["oldContent","newContent"])]),_:1},8,["modelValue"])],64)}}});var Au=ke(Pu,[["__scopeId","data-v-164e9944"]]);const Eu={style:{display:"flex"}},Tu=v("Helm Chart "),Gu=v(" Latest Version "),Lu={style:{display:"flex"}},Ou={style:{color:"#409eff","background-color":"#ecf5ff","margin-top":"0","margin-bottom":"0",padding:"10px","padding-left":"10px"}},zu=v("Overwrite Values "),Mu=v("Yaml"),qu={key:0,style:{width:"50%"}},Hu={style:{"background-color":"#cee4fc","margin-top":"0","margin-bottom":"0",padding:"10px","padding-left":"10px"}},ju=v("Chart Default Values "),Fu=v("Read only"),Bu={style:{display:"flex",width:"100%","padding-top":"10px"}},Ku=v("Save "),Wu=he({props:{version:null,cluster:null,clusterList:null},emits:["save"],setup(l,{emit:a}){const n=l,d=i(!1),p=i(!1),_=i(!1),u=i(n.cluster),g=i(),f=Ue(),C=parseInt(f.currentRoute.value.params.gId);i(!1),i(1);const r=i(),b=i(!0),T=i(0),k=i(""),S=i(""),x=i(!1),E=i("");function z(){var w,G;console.log(u.value.helmReleaseData.values),(G=(w=u.value)==null?void 0:w.helmReleaseData)!=null&&G.values&&te(u.value.helmReleaseData.values),ie.getters.CurrentService(f.currentRoute.value.params.sId).then(J=>{J||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),f.push({name:"service-management"})),r.value=J,F(J.helmChart)}),ie.getters.CurrentGroup(C).then(J=>{J||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),f.push({name:"service-management"})),d.value=ie.getters.EditAuth(J.id),p.value=ie.getters.IsAdmin})}const te=w=>{b.value=!1;const G=Kt.dump(w,{flowLevel:5,styles:{"!!null":"camelcase"}});k.value=G,T.value+=1,b.value=!0},F=w=>{const G=w.split("|");if(G.length<2)return;const J=G[0],H=G[1];qe.GetChartList(J,{}).then(N=>{const Y=N.data.filter(O=>O.name===H);if(Y.length==0)return;const R=Y[0].latest_version;S.value=R,qe.GetChartVersionDetail(J,H,R,{}).then(O=>{const $=Kt.dump(O.data.values,{flowLevel:5,styles:{"!!null":"camelcase"}});E.value=$})})},h=()=>{x.value=!x.value},V=w=>{k.value=w},I=()=>{let w=null;try{w=Kt.load(k.value,{}),console.log(k.value,w)}catch{alert("YAML Format Error")}if(!w)return;const G=r.value.helmChart.split("|");u.value.helmReleaseData.values=w,u.value.helmReleaseData.helmRepository=G[0],u.value.helmReleaseData.helmChart=G.length>1?G[1]:"",console.log(u.value),u.value.image=r.value.helmChart,n.version.clusters=[],n.version.clusters.push(u.value),console.log("",n.version),fe.UpsertVersion(C,n.version).then(J=>{ye({showClose:!0,message:"save success",type:"success"}),a("save",n.cluster.name),fe.GetVersionCluster(C,n.version.id,u.value.name,Xe).then(H=>{u.value=H.data,z()})})};return ze(()=>{ie.getters.ServiceManageOption().then(w=>{let G=w.cluster[n.cluster.name];_.value=G.isPrd}),z()}),(w,G)=>{const J=o("el-tag"),H=o("el-icon"),N=o("el-button"),A=o("el-form-item"),Y=o("el-form");return s(),y(Y,{ref_key:"ruleFormRef",ref:g,model:u.value,"label-width":"100px"},{default:t(()=>[c("div",Eu,[c("h4",null,[Tu,e(J,null,{default:t(()=>{var R;return[v(D((R=r.value)==null?void 0:R.helmChart),1)]}),_:1}),Gu,e(J,null,{default:t(()=>[v(D(S.value),1)]),_:1})]),e(N,{onClick:h,style:{"margin-left":"auto","margin-top":"15px"}},{default:t(()=>[e(H,null,{default:t(()=>[x.value?U("",!0):(s(),y(m($l),{key:0})),x.value?(s(),y(m(xl),{key:1})):U("",!0)]),_:1}),v(" "+D(x.value?"Hide":"View")+" default values.yaml",1)]),_:1})]),c("div",Lu,[c("div",{style:st(x.value?"width: 50%":"width: 100%")},[c("h4",Ou,[zu,e(J,{type:"warning"},{default:t(()=>[Mu]),_:1})]),(s(),y(xt,{"v-if":b.value,key:T.value,language:"yaml","read-only":!1,height:400,type:"simple","context-val":k.value,onChange:V},null,8,["v-if","context-val"]))],4),x.value?(s(),P("div",qu,[c("h4",Hu,[ju,e(J,{type:"info"},{default:t(()=>[Fu]),_:1})]),e(xt,{key:"def",language:"yaml","read-only":!0,height:400,type:"simple","context-val":E.value},null,8,["context-val"])])):U("",!0)]),d.value?(s(),y(A,{key:0},{default:t(()=>[c("div",Bu,[e(N,{type:"primary",icon:m(pt),onClick:I,style:{"margin-left":"auto"}},{default:t(()=>[Ku]),_:1},8,["icon"])])]),_:1})):U("",!0)]),_:1},8,["model"])}}});var Yu=ke(Wu,[["__scopeId","data-v-fe4439c4"]]);const Ju=he({setup(l){const a=Ue(),n=parseInt(a.currentRoute.value.params.vId),d=i({id:0,name:"",serviceId:"",description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""}),p=i(""),_=parseInt(a.currentRoute.value.params.gId),u=i({id:"",name:"",kind:"",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",clusterName:[],formTags:[],ingressClusters:[],namespace:"",repository:"",chart:"",helmChart:""});g();function g(){C(n),ie.getters.CurrentService(a.currentRoute.value.params.sId).then(b=>{b||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),a.push({name:"service-management"})),u.value=b})}function f(){a.push({name:"version-list"})}function C(b,T=""){fe.GetVersion(_,b).then(k=>{d.value=k.data,d.value.clusters.length!==0&&(T==""?p.value=d.value.clusters[0].name:p.value=T)})}function r(){let b={};Object.assign(b,d.value);let T=b;return T.clusters=[],T}return(b,T)=>{const k=o("el-page-header"),S=o("el-tab-pane"),x=o("el-tabs"),E=o("el-card");return s(),P(oe,null,[e(k,{icon:m(Vl),onBack:f},{content:t(()=>[c("span",null,"Version: "+D(d.value.name),1)]),_:1},8,["icon"]),e(E,{style:{"margin-top":"8px"},shadow:"hover","body-style":{padding:"0px",overflow:"auto"}},{default:t(()=>[e(x,{modelValue:p.value,"onUpdate:modelValue":T[0]||(T[0]=z=>p.value=z),type:"border-card",class:"demo-tabs"},{default:t(()=>[(s(!0),P(oe,null,de(d.value.clusters,(z,te)=>{var F;return s(),y(S,{label:(F=z.name)==null?void 0:F.toUpperCase(),name:z.name},{default:t(()=>[v(D()+" ",1),u.value.kind===m(We)?(s(),y(wu,{key:0,version:r(),cluster:z,clusterList:d.value.clusters},null,8,["version","cluster","clusterList"])):u.value.kind===m(_t)?(s(),y(Au,{key:1,version:r(),cluster:z,clusterList:d.value.clusters},null,8,["version","cluster","clusterList"])):u.value.kind===m(Xe)?(s(),y(Yu,{key:2,version:r(),cluster:z,clusterList:d.value.clusters},null,8,["version","cluster","clusterList"])):U("",!0)]),_:2},1032,["label","name"])}),256))]),_:1},8,["modelValue"])]),_:1})],64)}}});var Zu=ke(Ju,[["__scopeId","data-v-40db007e"]]);const Qu=v(" Contact "),Xu=v("Save"),ed=he({emits:["finish"],setup(l,{expose:a,emit:n}){const d=i(!1),p=i([]),_=i(!1),u=i(),g=Ue(),f=parseInt(g.currentRoute.value.params.gId),C=g.currentRoute.value.params.sId,r=i(""),b=i({id:0,name:"",serviceId:C,description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""});let T=new RegExp(/^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$/),k=new RegExp(/^(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?$/);const S=(w,G,J)=>{let H=G;T.test(H)||J(new Error("version must consist of lower case alphanumeric characters or '-' ")),J()},x=(w,G)=>{G=G;let J;switch(w){case"CreateVersion":J={id:0,name:"",serviceId:C,description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""};break;case"CopyVersion":J=$t.exports.cloneDeep(G),J.name="";break;case"EditVersion":J=$t.exports.cloneDeep(G),J.clusters=[];break}b.value=J,r.value=w,d.value=!0,b.value.contact===""&&ie.getters.CurrentGroup(g.currentRoute.value.params.gId).then(H=>{H||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),g.push({name:"service-management"})),b.value.contact=H.contact})},te=i({name:[{required:!0,message:"Please input version name",trigger:"blur"},{validator:(w,G,J)=>{G==="primary"&&J(new Error("primary is a keyword")),J()},trigger:"blur"},{validator:S,trigger:"blur"},{min:1,max:16,message:"Length should be 1 to 16",trigger:"blur"}],description:[{min:0,max:255,message:"Length should be 0 to 255",trigger:"blur"}],contact:[{required:!0,message:"Please input contact",trigger:"blur"},{validator:(w,G,J)=>{let H=G;H===""&&J(),k.test(H)||J(new Error("regex used for validation is (([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?")),J()},trigger:"blur"}]});function F(w){w?(_.value=!0,fe.GetNeweggUser(w).then(G=>{_.value=!1,p.value=G.data})):p.value=[]}async function h(w){!w||await w.validate((G,J)=>{if(G)switch(r.value){case"EditVersion":{fe.UpsertVersion(f,b.value).then(H=>{ye({showClose:!0,message:"save success",type:"success"}),d.value=!1,n("finish")});break}case"CreateVersion":{fe.UpsertVersion(f,b.value).then(H=>{ye({showClose:!0,message:"save success",type:"success"}),d.value=!1,V(H.data.id)});break}case"CopyVersion":{fe.CopyVersion(f,b.value).then(H=>{ye({showClose:!0,message:"save success",type:"success"}),d.value=!1,V(H.data.id)});break}}else ye({showClose:!0,message:"Validate failed",type:"error"})})}function V(w){g.push({name:"version-detail",params:{vId:w}})}return a({open:x}),(w,G)=>{const J=o("el-input"),H=o("el-form-item"),N=o("el-option"),A=o("el-select"),Y=o("el-button"),R=o("el-form"),O=o("el-dialog");return s(),y(O,{modelValue:d.value,"onUpdate:modelValue":G[4]||(G[4]=$=>d.value=$),title:r.value,width:"30%"},{default:t(()=>[e(R,{model:b.value,"label-width":"120px",rules:te.value,ref_key:"ruleFormRef",ref:u},{default:t(()=>[e(H,{label:"Version Name",prop:"name"},{default:t(()=>[e(J,{disabled:r.value==="EditVersion",maxlength:"16",class:"form-body",modelValue:b.value.name,"onUpdate:modelValue":G[0]||(G[0]=$=>b.value.name=$)},null,8,["disabled","modelValue"])]),_:1}),e(H,{label:"Description",prop:"description"},{default:t(()=>[e(J,{maxlength:"255",class:"form-body",modelValue:b.value.description,"onUpdate:modelValue":G[1]||(G[1]=$=>b.value.description=$),type:"textarea"},null,8,["modelValue"])]),_:1}),e(H,{prop:"contact"},{label:t(()=>[Qu,e(m(Ee),{title:"Contact User",content:"The service's alert will send to these users"})]),default:t(()=>[e(A,{style:{width:"100%"},modelValue:b.value.contact,"onUpdate:modelValue":G[2]||(G[2]=$=>b.value.contact=$),filterable:"",remote:"","reserve-keyword":"",placeholder:"Please enter a keyword","remote-method":F,loading:_.value,class:"form-body"},{default:t(()=>[(s(!0),P(oe,null,de(p.value,$=>(s(),y(N,{key:$.FullName,label:$.FullName,value:$.FullName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(H,null,{default:t(()=>[e(Y,{type:"primary",onClick:G[3]||(G[3]=$=>h(u.value))},{default:t(()=>[Xu]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const sa=l=>(Re("data-v-2d3108b8"),l=l(),Ne(),l),td=v("Diff"),ad=v("Add Version "),ld=["onClick"],nd=sa(()=>c("span",null,"There are already deployed clusters in the current version, please undeploy first and then delete the version",-1)),od=v("Cancel"),sd=sa(()=>c("span",{style:{"margin-right":"30px"}}," Old ",-1)),rd=sa(()=>c("span",{style:{"margin-right":"30px"}}," New ",-1)),id=he({setup(l){const a=i(!1),n=Ue(),d=i(""),p=i(0),_=n.currentRoute.value.params.sId,u=i([]),g=i([]),f=i(!1),C=i(!1),r=i(0),b=i(""),T=i(""),k=i(""),S=i(""),x=i(""),E=i(!1),z=parseInt(n.currentRoute.value.params.gId);i(!1);let te=1;const F=i();i({id:0,name:"",serviceId:_,description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""});function h(L,W){return fe.formatDate(L[W.property])}V();function V(){ie.getters.CurrentGroup(z).then(L=>{L||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),n.push({name:"service-management"})),a.value=ie.getters.EditAuth(L.id)}),I()}function I(L=te){let W={name:d.value,sid:_,cluster:"",pageIndex:L,pageSize:15};fe.GetVersionBase(z,W).then(B=>{u.value=B.data.versions,p.value=B.data.totalCount})}function w(){if(C.value=!C.value,C.value){let L={name:d.value,sid:_,cluster:"",pageIndex:0,pageSize:0};fe.GetVersionBase(z,L).then(W=>{g.value=W.data.versions})}}function G(L,W){fe.GetVersion(z,L.id).then(B=>{W?(S.value=L.name,T.value=JSON.stringify(B.data,null,4)):(x.value=L.name,k.value=JSON.stringify(B.data,null,4))})}const J=L=>G(L,!0),H=L=>G(L,!1);function N(L){n.push({name:"version-detail",params:{vId:L}})}function A(L,W=void 0){W=W,F.value.open(L,W)}function Y(){I()}function R(){if(!!r.value)return fe.DeleteVersion(z,r.value).then(L=>{ye({showClose:!0,message:"Delete successfully.",type:"success"}),f.value=!1,I()})}function O(L){let W=u.value.find(Z=>Z.id===L);if(!W)return;let B=!1;for(let Z of W.clusters)if(Z.deployInfo.master){B=!0;break}B?E.value=!0:(f.value=!0,r.value=L,b.value=W.name)}function $(L){n.push({name:"service-instance",query:{cluster:L}})}return(L,W)=>{const B=o("el-button"),Z=o("el-input"),X=o("el-col"),ae=o("el-row"),j=o("el-table-column"),K=o("el-tag"),M=o("el-tooltip"),se=o("el-button-group"),be=o("el-table"),Ve=o("el-pagination"),ve=o("el-card"),le=o("el-form-item"),Se=o("el-form"),ge=o("el-dialog"),ne=o("el-option"),ee=o("el-select");return s(),P(oe,null,[e(ve,{style:{"min-height":"360px","padding-top":"10px"},shadow:"hover"},{default:t(()=>[e(ae,null,{default:t(()=>[e(X,{span:20,style:{"padding-left":"10px",display:"flex"}},{default:t(()=>[e(Z,{modelValue:d.value,"onUpdate:modelValue":W[1]||(W[1]=Q=>d.value=Q),placeholder:"Type to search version",onKeyup:W[2]||(W[2]=et(Q=>I(),["enter","native"]))},{append:t(()=>[e(B,{icon:m(tt),onClick:W[0]||(W[0]=Q=>I())},null,8,["icon"])]),_:1},8,["modelValue"]),e(B,{style:{"margin-left":"8px"},plain:"",icon:m(ta),onClick:w},{default:t(()=>[td]),_:1},8,["icon"])]),_:1}),e(X,{span:4,style:{"text-align":"right","padding-right":"10px"}},{default:t(()=>[a.value?(s(),y(B,{key:0,style:{"margin-left":"8px"},onClick:W[3]||(W[3]=Q=>A("CreateVersion")),plain:"",type:"primary",icon:m(Me)},{default:t(()=>[ad]),_:1},8,["icon"])):U("",!0)]),_:1})]),_:1}),e(be,{data:u.value,stripe:""},{default:t(()=>[e(j,{width:"10"}),e(j,{label:"Version",prop:"name",width:"300"},{default:t(Q=>[c("a",{style:{"font-size":"var(--el-font-size-large)"},class:"a-class",href:"",onClick:Fe(_e=>N(Q.row.id),["prevent"])},D(Q.row.name),9,ld)]),_:1}),e(j,{label:"Description",prop:"description","show-overflow-tooltip":""}),e(j,{label:"Cluster",width:"280"},{default:t(Q=>[(s(!0),P(oe,null,de(Q.row.clusters,(_e,$e)=>(s(),y(K,{onClick:re=>$(_e.name),style:{"margin-right":"2px",cursor:"pointer"},class:"ml-2",type:_e.deployInfo.master?"success":"info"},{default:t(()=>{var re;return[v(D((re=_e.name)==null?void 0:re.toUpperCase()),1)]}),_:2},1032,["onClick","type"]))),256))]),_:1}),e(j,{label:"Contact",prop:"contact",width:"140"}),e(j,{label:"Edit Date",prop:"lastEditDate",formatter:h,width:"180"}),e(j,{label:"Edit User",prop:"lastEditUser",width:"140"}),e(j,{label:"Operation",width:"170",fixed:"right"},{default:t(Q=>[e(se,{class:"ml-4"},{default:t(()=>[e(M,{content:"Edit Version",placement:"bottom"},{default:t(()=>[e(B,{type:"primary",plain:"",onClick:_e=>A("EditVersion",Q.row),icon:m(St),"hide-after":"0"},null,8,["onClick","icon"])]),_:2},1024),e(M,{content:"Copy Version",placement:"bottom"},{default:t(()=>[a.value?(s(),y(B,{key:0,type:"primary",plain:"",onClick:_e=>A("CopyVersion",Q.row),icon:m(Sl),"hide-after":"0"},null,8,["onClick","icon"])):U("",!0)]),_:2},1024),e(M,{content:"Delete Version",placement:"bottom"},{default:t(()=>[a.value?(s(),y(B,{key:0,onClick:_e=>O(Q.row.id),type:"danger",plain:"",icon:m(je),"hide-after":"0"},null,8,["onClick","icon"])):U("",!0)]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"]),e(Ve,{style:{"padding-top":"10px"},background:"",layout:"prev, pager, next","hide-on-single-page":!0,total:p.value,"page-size":15,onCurrentChange:I},null,8,["total"])]),_:1}),e(ed,{ref_key:"versionEditRef",ref:F,onFinish:Y},null,512),e(na,{modelValue:f.value,"onUpdate:modelValue":W[4]||(W[4]=Q=>f.value=Q),title:"DeleteVersion","source-name":b.value,"delete-handle":R},null,8,["modelValue","source-name"]),e(ge,{modelValue:E.value,"onUpdate:modelValue":W[6]||(W[6]=Q=>E.value=Q),title:"DeleteVersion",width:"20%"},{default:t(()=>[e(Se,null,{default:t(()=>[e(le,null,{default:t(()=>[nd]),_:1}),e(le,null,{default:t(()=>[e(B,{type:"info",onClick:W[5]||(W[5]=Q=>E.value=!1)},{default:t(()=>[od]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ge,{modelValue:C.value,"onUpdate:modelValue":W[9]||(W[9]=Q=>C.value=Q),title:"Version Diff",width:"90%"},{default:t(()=>[e(Mt,{show:!0,oldContent:T.value,newContent:k.value,language:"javascript"},{oldTitle:t(()=>[e(ee,{filterable:"",modelValue:S.value,"onUpdate:modelValue":W[7]||(W[7]=Q=>S.value=Q),placeholder:"Select Version...",onChange:J,style:{"margin-bottom":"10px"}},{prefix:t(()=>[sd]),default:t(()=>[(s(!0),P(oe,null,de(g.value,Q=>(s(),y(ne,{label:Q.name,value:Q},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),newTitle:t(()=>[e(ee,{filterable:"",modelValue:x.value,"onUpdate:modelValue":W[8]||(W[8]=Q=>x.value=Q),placeholder:"Select Version...",onChange:H,style:{"margin-bottom":"10px"}},{prefix:t(()=>[rd]),default:t(()=>[(s(!0),P(oe,null,de(g.value,Q=>(s(),y(ne,{label:Q.name,value:Q},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1},8,["oldContent","newContent"])]),_:1},8,["modelValue"])],64)}}});var ud=ke(id,[["__scopeId","data-v-2d3108b8"]]);const dd="dev-harbor.newegg.org",cd="harbor.newegg.org";function Zt(l){let a={domain:"",image:l,projectName:"",repositoryName:"",tag:""};if(!l)return a;let n=a.image.split(":");if(a.image=n[0],n.length>1&&(a.tag=n[1]),!a.image)return a;let d=a.image.split("/");if(d[0]==dd||d[0]==cd){if(a.domain=d[0],d.length>1&&(a.projectName=d[1]),d.length>2){a.repositoryName=d[2];for(let p=3;p<d.length;p++)a.repositoryName=a.repositoryName+"/"+d[p]}return a}if(d.length>1){a.projectName=d[0],a.repositoryName=d[1];for(let p=2;p<d.length;p++)a.repositoryName=a.repositoryName+"/"+d[p];return a}return a}const ra=l=>(Re("data-v-04ff6a63"),l=l(),Ne(),l),pd=v(" Canary "),md={style:{"margin-left":"20px"}},vd={key:2},_d=v("Canary Analysis"),fd=v("End"),gd=v(" Are you share you want End Canary Analysis?"),yd=ra(()=>c("br",null,null,-1)),hd=v("Stop Canary & Remove Baselin&Canay"),bd=v("Start Canary Analysis"),wd=v(" View Report "),Cd={style:{margin:"0",color:"#409EFF"}},kd=v(" Canary Analysis "),$d={style:{"padding-left":"20px","padding-right":"20px"}},xd={class:"card-header"},Vd=v(" AnalysisTime "),Sd=v(),Dd={style:{color:"#e70721","font-weight":"bold"}},Id=v(" Setp "),Rd=ra(()=>c("br",null,null,-1)),Nd=v(" Init Time "),Ud=v(" Scope "),Pd=ra(()=>c("br",null,null,-1)),Ad={style:{"font-weight":"bold",color:"blue"}},Ed=he({props:{cluster:null,version:null},emits:["analysis"],setup(l,{emit:a}){const n=l,d=nt(()=>{var $e;const ne=n.version.releaseInfo;if(!ne)return!1;const ee=($e=ne.status)==null?void 0:$e.deployInfo;if(!ee)return!1;let _e=Object.keys(ee).filter(re=>re.endsWith("-canary")||re.endsWith("-baseline")).length==2;return a("analysis",_e),_e}),p=i(""),_=i(""),u=i(0),g=i(-1),f=nt(()=>ie.getters.CanaryStatus),C=i(),r=nt(()=>ie.getters.CanaryConfig),b=i(!0),T=i(),k=i(!1),S=i(-1),x=i(""),E=i(""),z=i(!1),te=i(0),h=i("dev-harbor.newegg.org"),V=i(""),I=i(!0),w=i(""),G=i(""),J=Ue(),H=J.currentRoute.value.params.sId,N=parseInt(J.currentRoute.value.params.gId),A=i({vid:0,primary:!0,cluster:"",image:""}),Y=(ne,ee,Q)=>{ee===""?Q(new Error("required")):Q()},R=(ne,ee,Q)=>{ee===0?Q(new Error("required")):Q()},O=()=>{S.value=n.version,k.value=!0,T.value=null,I.value=!0,z.value=!1,te.value=0,Ve(n.version.versionId)},$=ne=>{if(!ne)return"";const ee=parseInt((new Date().getTime()/1e3).toFixed(0)),Q=parseInt((new Date(ne).getTime()/1e3).toFixed(0));return Ot(ee-Q)},L=ne=>{if(ne.startsWith("1970"))return"N/A";const ee=new Date(ne);return mt(ee).local().format("YYYY-MM-DD HH:mm:ss")},W=ne=>ne.kayentaBaseUrl!==""&&ne.kayentaFinalExecutionID!=="",B=ne=>{switch(ne){case"deploy_created":return"Start Deploy...";case"deploy_padding":return"Wait Deploy done";case"deploy_done":return"Collecting&Analysis...";case"analysis_report":return"Reporting...";default:return ne}},Z=ne=>{switch(ne){case"deploy_created":return{title:"Deploy Canary",content:"Deploy Baseline&Canary version",type:"info"};case"deploy_padding":return{title:"Wait Deploy",content:"Wait Deploy done",type:"info"};case"deploy_done":return{title:"Collecting&Analysis",content:"Deploy done,Collecting&Analysis.. data",type:"info"};case"analysis_report":return{title:"Reporting",content:"Analysis and gen Report",type:"info"};case"canary_terminated":return{title:"Terminated",content:"Canary terminated (user stop)",type:"warning"};case"analysis_done":return{title:"Done",content:"Canary Analysis done&Report success",type:"success"};case"deploy_timeout":return{title:"Timeout",content:"Deploy Timeout,deploy cost too much time",type:"danger"};default:return{title:ne,content:"Unknow stauts"+ne}}},X=()=>{var Le;const ne=n.version.releaseInfo;if(!ne)return!1;const ee=(Le=ne.status)==null?void 0:Le.deployInfo;if(!ee)return!1;const Q=Object.keys(ee).filter(Ye=>!Ye.endsWith("-canary")&&!Ye.endsWith("-baseline"));if(!(Q.length==1))return!1;const $e=ee[Q[0]].image.split(":")[1],re=C.value;return re?$e===re.tag:!1},ae=ne=>{if(ne==="analysis_done"){const ee=C.value;if(!ee)return"Unknown";const Q=ee.thresholdsPass,_e=ee.thresholdsMarginal,$e=ee.finalScore;return $e>=Q?"Pass":$e<_e?"Fail":"Marginal"}else return B(ne)},j=()=>{const ne=C.value;!ne||window.open(`${ne.kayentaBaseUrl}/dashboard/reports/canary/${ne.kayentaFinalExecutionID}`,"_blank")},K=ne=>{window.open(`${ne.kayentaBaseUrl}/dashboard/reports/canary/${ne.kayentaFinalExecutionID}`,"_blank")},M=()=>{const ne=n.version.deployInfo.image.split(":");b.value=!1;const ee={canaryAnalysisID:g.value,serviceID:H,versionID:n.version.versionId,cluster:n.cluster,image:ne[0],tag:ne[1],namespace:n.version.deployInfo.namespace};fe.EndCanaryAnalysis(ee,N).then(Q=>null)};Pe(f,ne=>{const ee=ne.filter(Q=>Q.version===n.version.versionName);ee.length!=0&&(C.value=ee[0],p.value=ee[0].status,_.value=ee[0].startTime,g.value=ee[0].id?ee[0].id:-1,u.value=ee[0].finalScore)});const be=(ne,ee)=>{if(h.value==""||V.value==""||w.value==""){ee([]);return}Tt.SearchImageTags(h.value,V.value,w.value).then(Q=>{const _e=[];for(const $e of Q){if(ne.trim()==""){_e.push({value:$e.name});continue}$e.name.toLowerCase().includes(ne.trim().toLowerCase())&&_e.push({value:$e.name})}ee(_e)})},Ve=ne=>{if(z.value=!1,te.value=0,S.value===-1)return;const ee=r.value.filter(_e=>_e.versionID===ne),Q=n.version;if(Q&&ee&&ee.length>0){const _e=Zt(Q.deployInfo.image);h.value=_e.domain,w.value=_e.repositoryName,V.value=_e.projectName,G.value=_e.tag,z.value=ve(Q),te.value=le(Q),E.value=Q.versionName+"-"+ee[0].serviceName,fe.GetCanaryConfigDetail(ne,n.cluster).then($e=>{T.value=$e.data})}},ve=ne=>{var $e;const ee=ne.releaseInfo;if(!ee)return!1;const Q=($e=ee.status)==null?void 0:$e.deployInfo;return Q?Object.keys(Q).filter(re=>re.endsWith("-canary")||re.endsWith("-baseline")).length==2:!1},le=ne=>{var $e;const ee=ne.releaseInfo;if(!ee)return 0;const Q=($e=ee.status)==null?void 0:$e.deployInfo;if(!Q)return 0;const _e=Object.keys(Q).filter(re=>!re.endsWith("-canary")&&!re.endsWith("-baseline"));return _e.length>0?Q[_e[0]].status.replicas:0},Se=()=>{const ne=r.value.filter(Q=>Q.versionID===S.value.versionId),ee=n.version;if(ee&&ne&&ne.length>0){const Q=Zt(ee.deployInfo.image),_e=ee.versionName+"-"+ne[0].serviceName,$e=ee.deployInfo.namespace,re=Ct({serviceID:H,image:`${Q.domain}/${Q.projectName}/${Q.repositoryName}`,tag:Q.tag,canaryTag:x.value,namespace:$e,scope:_e},ne[0]);I.value=!1,fe.StartCanaryAnalysis(re,N).then(Le=>{Le.status===200?k.value=!1:I.value=!0})}},ge=i({vid:[{required:!0,message:"version is required",trigger:"blur"},{validator:R,trigger:"blur"}],namespace:[{required:!0,message:"namespace is required",trigger:"blur"},{validator:Y,trigger:"blur"}]});return(ne,ee)=>{const Q=o("el-icon"),_e=o("el-tag"),$e=o("el-tooltip"),re=o("el-button"),Le=o("el-popover"),Ye=o("el-button-group"),He=o("el-table-column"),it=o("el-table"),ht=o("el-collapse-item"),ue=o("el-form-item"),me=o("el-col"),q=o("el-row"),pe=o("el-option"),we=o("el-select"),Te=o("el-autocomplete"),ut=o("el-form"),Je=o("el-descriptions-item"),De=o("el-descriptions"),bt=o("el-card"),wt=o("el-alert"),Ft=o("el-dialog");return s(),P(oe,null,[m(r).filter(xe=>xe.cluster===n.cluster&&xe.versionID===l.version.versionId&&xe.enabled).length>0?(s(),y(ht,{key:0,name:"1",class:"canary-table"},{title:t(()=>[pd,c("div",md,[p.value!==""&&m(d)?(s(),y($e,{key:0,class:"box-item",effect:"dark",content:"Canary Status",placement:"bottom"},{default:t(()=>[e(_e,{class:"tag-class",style:{cursor:"default"}},{default:t(()=>[e(Q,null,{default:t(()=>[e(m(Dl))]),_:1}),v(" "+D(B(p.value)),1)]),_:1})]),_:1})):U("",!0),_.value!==""&&m(d)?(s(),y($e,{key:1,class:"box-item",effect:"dark",content:"Canary Running Time",placement:"bottom"},{default:t(()=>[e(_e,{class:"tag-class",style:{cursor:"default"}},{default:t(()=>[e(Q,null,{default:t(()=>[e(m(Il))]),_:1}),v(" "+D($(_.value)),1)]),_:1})]),_:1})):U("",!0),X()?(s(),P("span",vd,[!m(d)&&p.value!==""?(s(),y($e,{key:0,class:"box-item",effect:"dark",content:"Last Canary Status",placement:"bottom"},{default:t(()=>[e(_e,{class:"tag-class",effect:"dark",style:{cursor:"default"}},{default:t(()=>[e(Q,null,{default:t(()=>[e(m(It))]),_:1}),v(" "+D(ae(p.value).toUpperCase()),1)]),_:1})]),_:1})):U("",!0),!m(d)&&p.value==="analysis_done"?(s(),y($e,{key:1,class:"box-item",effect:"dark",content:"Last Canary Score",placement:"bottom"},{default:t(()=>[e(_e,{class:"tag-class tag-click",effect:"dark",onClick:j},{default:t(()=>[e(Q,null,{default:t(()=>[e(m(ea))]),_:1}),v(" "+D(u.value),1)]),_:1})]),_:1})):U("",!0)])):U("",!0)]),m(d)?(s(),y(Ye,{key:0,style:{"margin-left":"auto"}},{default:t(()=>[e(re,{type:"warning",size:"small",loading:"",round:""},{default:t(()=>[_d]),_:1}),e(Le,{placement:"bottom",width:300,trigger:"click"},{reference:t(()=>[e(re,{size:"small",plain:"",round:"",icon:m(fa),type:"danger",disabled:g.value===-1},{default:t(()=>[fd]),_:1},8,["icon","disabled"])]),default:t(()=>[gd,yd,e(re,{size:"small",plain:"",round:"",icon:m(fa),type:"danger",disabled:g.value===-1,onClick:M,style:{"margin-left":"25px"}},{default:t(()=>[hd]),_:1},8,["icon","disabled"])]),_:1})]),_:1})):U("",!0),m(r).filter(xe=>xe.cluster===n.cluster&&xe.versionID===l.version.versionId&&xe.enabled).length===0||m(d)?U("",!0):(s(),y(re,{key:1,size:"small",plain:"",icon:m(It),type:"primary",onClick:O,style:{"margin-bottom":"5px","margin-right":"5px","margin-left":"auto"}},{default:t(()=>[bd]),_:1},8,["icon"]))]),default:t(()=>[e(it,{data:m(f).filter(xe=>xe.version===l.version.versionName).slice(0,3),style:{width:"100%"}},{default:t(()=>[e(He,{prop:"status",label:"Status"},{default:t(xe=>[e($e,{content:Z(xe.row.status).content,placement:"top"},{default:t(()=>[e(_e,{type:Z(xe.row.status).type},{default:t(()=>[v(D(Z(xe.row.status).title),1)]),_:2},1032,["type"])]),_:2},1032,["content"])]),_:1}),e(He,{prop:"tag",label:"Baseline",width:"120"}),e(He,{prop:"canaryTag",label:"Canary",width:"120"}),e(He,{prop:"canaryConfig",label:"Config",width:"100"}),e(He,{prop:"startTime",label:"StartTime",width:"170"},{default:t(xe=>[v(D(L(xe.row.startTime)),1)]),_:1}),e(He,{prop:"lastEditUser",label:"User",width:"70"}),e(He,{prop:"finalScore",label:"Score",width:"80"},{default:t(xe=>[e(_e,{effect:"dark",type:xe.row.finalScore>=xe.row.thresholdsPass?"success":xe.row.finalScore<xe.row.thresholdsPass?"danger":"warning",style:{width:"50px"}},{default:t(()=>[v(D(xe.row.finalScore),1)]),_:2},1032,["type"])]),_:1}),e(He,{prop:"finalScore",label:"Report",width:"140"},{default:t(xe=>[e(re,{type:"primary",size:"small",plain:"",disabled:!W(xe.row),onClick:ca=>K(xe.row)},{default:t(()=>[e(Q,{style:{"margin-right":"5px"}},{default:t(()=>[e(m(Rt))]),_:1}),wd]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):U("",!0),e(Ft,{modelValue:k.value,"onUpdate:modelValue":ee[2]||(ee[2]=xe=>k.value=xe),width:"35%"},{header:t(()=>[c("h2",Cd,[e(Q,null,{default:t(()=>[e(m(It))]),_:1}),kd])]),footer:t(()=>[e(re,{type:z.value?"warning":"success",disabled:!S.value||x.value===""||!I.value,icon:m(Rl),onClick:Se},{default:t(()=>[v(" Start Canary "+D(te.value>0?`& transfer ${(1/(te.value+2)*100).toFixed(1)}% traffic`:""),1)]),_:1},8,["type","disabled","icon"])]),default:t(()=>[e(ut,{ref:"ruleFormRef",rules:ge.value,model:A.value},{default:t(()=>[e(ue,{label:"Cluster","label-width":"100px",style:{width:"95%"}},{default:t(()=>[e(_e,{effect:"dark",size:"large",round:""},{default:t(()=>[v(D(l.cluster),1)]),_:1})]),_:1}),e(ue,{label:"Version","label-width":"100px",prop:"vid",style:{width:"95%"}},{default:t(()=>[e(we,{modelValue:S.value,"onUpdate:modelValue":ee[0]||(ee[0]=xe=>S.value=xe),style:{width:"100%"},onChange:Ve,disabled:!0},{default:t(()=>[(s(!0),P(oe,null,de(m(r).filter(xe=>xe.cluster===l.cluster),xe=>(s(),y(pe,{label:xe.versionName,value:xe.versionID,key:xe.versionID},{default:t(()=>[e(q,null,{default:t(()=>[e(me,{span:16},{default:t(()=>[c("span",null,D(xe.versionName),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),S.value!==null?(s(),y(ue,{key:0,label:"Image","label-width":"100px",style:{width:"95%",color:"blue"}},{default:t(()=>[v(D(h.value)+"/"+D(V.value)+"/"+D(w.value),1)]),_:1})):U("",!0),S.value!==null?(s(),y(ue,{key:1,label:"Base Tag","label-width":"100px",prop:"vid",style:{width:"95%",color:"blue"}},{default:t(()=>[v(D(G.value),1)]),_:1})):U("",!0),S.value!==null?(s(),y(ue,{key:2,label:"* Canary Tag","label-width":"100px",style:{width:"95%"}},{default:t(()=>[e(Te,{modelValue:x.value,"onUpdate:modelValue":ee[1]||(ee[1]=xe=>x.value=xe),style:{width:"100%",height:"100%"},placeholder:"example bts/test:0.0.1","fetch-suggestions":be},null,8,["modelValue"])]),_:1})):U("",!0)]),_:1},8,["rules","model"]),c("div",$d,[T.value?(s(),y(bt,{key:0,shadow:"always",class:"box-card",style:{"background-color":"rgb(251 240 128 / 52%)"},"body-style":"padding-bottom: 10px;padding-right: 20px;padding-left: 20px;padding-top: 10px;"},{header:t(()=>[c("div",xd,[c("span",null,[e(Q,null,{default:t(()=>[e(m(Na))]),_:1}),v(D(T.value.canaryConfig),1)])])]),default:t(()=>[e(De,{class:"canary-config",column:2},{default:t(()=>[e(Je,null,{label:t(()=>[e(Q,null,{default:t(()=>[e(m(Nl))]),_:1}),Vd]),default:t(()=>[Sd,c("span",Dd,D(T.value.analysisTime)+" min",1)]),_:1}),e(Je,null,{label:t(()=>[e(Q,null,{default:t(()=>[e(m(Ul))]),_:1}),Id]),default:t(()=>[v(" "+D(T.value.setp)+" s",1)]),_:1}),Rd,e(Je,null,{label:t(()=>[e(Q,null,{default:t(()=>[e(m(ga))]),_:1}),Nd]),default:t(()=>[v(D(T.value.initTime)+"s",1)]),_:1}),e(Je,null,{label:t(()=>[e(Q,null,{default:t(()=>[e(m(ga))]),_:1}),Ud]),default:t(()=>[v(D(E.value),1)]),_:1}),e(Je,{label:"Marginal"},{default:t(()=>[e(_e,{size:"small"},{default:t(()=>[v(D(T.value.thresholdsMarginal),1)]),_:1})]),_:1}),e(Je,{label:"Pass"},{default:t(()=>[e(_e,{size:"small"},{default:t(()=>[v(D(T.value.thresholdsPass),1)]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),z.value?(s(),y(wt,{key:1,title:"[Warning] Canary runs in your select version,Please be careful",type:"warning",style:{"margin-top":"10px"}})):U("",!0),te.value>0?(s(),y(wt,{key:2,type:"info",style:{"margin-top":"10px"}},{title:t(()=>[v(" Canary/(Current Replicas["+D(te.value)+"] + Baseline + Canary)*100% = ",1),Pd,c("span",Ad,D((1/(te.value+2)*100).toFixed(1))+"%",1),v(" traffic will be transferred to a new Version ["+D(x.value)+"] ",1)]),_:1})):U("",!0)])]),_:1},8,["modelValue"])],64)}}});var Td=ke(Ed,[["__scopeId","data-v-04ff6a63"]]),Gd="/assets/grafana.e87495e3.svg",Ld="/assets/hubble.fdf9eb5e.svg";const yt=l=>(Re("data-v-4a6dbba0"),l=l(),Ne(),l),Od={class:"deploy"},zd=v(" Primary "),Md={style:{"margin-right":"5px","margin-left":"5px"},class:"deploy-title version"},qd={class:"right"},Hd={key:1,style:{display:"flex"}},jd={key:0,class:"line"},Fd={class:"cell-item"},Bd=yt(()=>c("span",{class:"lable-description"}," DeployUser: ",-1)),Kd={class:"cell-item"},Wd=yt(()=>c("span",{class:"lable-description"}," GatewayHost: ",-1)),Yd={key:0},Jd={class:"cell-item"},Zd=yt(()=>c("span",{class:"lable-description"}," DeployDate: ",-1)),Qd={class:"cell-item"},Xd=yt(()=>c("span",{class:"lable-description"}," Monitor ",-1)),ec={style:{display:"flex"}},tc=["src"],ac=v("Grafana Dashboard "),lc=["src"],nc=yt(()=>c("span",{style:{width:"80px"}},"Hubble UI",-1)),oc={key:0,style:{"margin-left":"auto","padding-right":"10px"}},sc=v(" ReDeploy "),rc=v(" UnDeploy "),ic={style:{"margin-right":"5px","margin-left":"3px"}},uc=v(" Primary "),dc=v("Rollback"),cc={key:0},pc={key:1},mc=v(" UnAvailable "),vc=v(" Pending "),_c=v(" Available "),fc=v(" error "),gc={style:{color:"#eebe77"}},yc=v("Warnings "),hc={style:{color:"#b88230"}},bc=yt(()=>c("span",null,"Are you sure you want to undeploy?",-1)),wc=v("Yes"),Cc=v("No"),kc=he({props:{isPrd:{type:Boolean},deployRole:{type:Boolean},version:null,cluster:null},emits:["reDeploy","refresh"],setup(l,{emit:a}){const n=l,d=Ue();d.currentRoute.value.params.sId;const p=parseInt(d.currentRoute.value.params.gId),_=i({id:"",name:"",kind:"",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",clusterName:[],formTags:[],ingressClusters:[],namespace:"",repository:"",chart:"",helmChart:""}),u=i(!1),g=i(!1),f=i(""),C=i(""),r=i(!1);b();function b(){ie.getters.CurrentService(d.currentRoute.value.params.sId).then(I=>{I||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),d.push({name:"service-management"})),_.value=I}),E(n.version)}function T(I){return fe.formatDate(I)}function k(I,w){return fe.formatDate(I[w.property])}const S=I=>{!I||n.cluster==="e9k8s"||(n.cluster==="e11qk8s"?window.open(`https://gqc-hubble.newegg.org/${I}`,"_blank"):window.open(`https://${n.cluster}-hubble.newegg.org/${I}`,"_blank"))},x=I=>{n.cluster==="e11qk8s"?window.open(`https://g.newegg.dev/d/H6hqH3nnz/k8s-service-metric?orgId=1&var-datasource=GQCK8S-Prometheus&var-cluster=&var-namespace=${n.version.deployInfo.namespace}&var-service=${I}`,"_blank"):n.cluster==="e9k8s"?window.open(`https://g.newegg.dev/d/H6hqH3nnz/k8s-service-metric?orgId=1&var-datasource=E9K8S-Prometheus&var-cluster=&var-namespace=${n.version.deployInfo.namespace}&var-service=${I}`,"_blank"):window.open(`https://g.newegg.dev/d/H6hqH3nnz/k8s-service-metric?orgId=1&var-datasource=thanos-prometheus&var-cluster=${n.cluster}&var-namespace=${n.version.deployInfo.namespace}&var-service=${I}`,"_blank")};function E(I){if(I.releaseInfo&&I.releaseInfo.status){if(I.releaseInfo.status.resources)for(let w in I.releaseInfo.status.resources){let G=I.releaseInfo.status.resources[w];G.msg!==""&&G.deployed&&(f.value=G.msg,u.value=!0)}if(I.releaseInfo.status.deployInfo)for(let w in I.releaseInfo.status.deployInfo){let G=I.releaseInfo.status.deployInfo[w];G.status.replicaSetErr&&(C.value=w+": "+G.status.replicaSetErr)}}}Pe(()=>n.version,E);function z(I,w){let G=document.createElement("input");G.value=I,document.body.appendChild(G),G.select(),document.execCommand("Copy"),document.body.removeChild(G),ye({showClose:!0,message:w,type:"success"})}function te(){let I={vid:n.version.versionId,primary:!1,cluster:n.cluster,image:""};a("reDeploy",I)}function F(I,w){let G={vid:n.version.versionId,primary:w,cluster:n.cluster,image:I};a("reDeploy",G)}function h(){fe.UnDeploy(p,{vid:n.version.versionId,cluster:n.cluster,primary:n.version.deployInfo.primary,image:""}).then(I=>{ye({showClose:!0,message:"UnDeploy successfully.",type:"success"}),a("refresh")})}function V(){if(n.isPrd&&!n.deployRole){ye({showClose:!0,message:"You do not have permission to operate the production environment,deploy PRD Cluster through Release Portal.",type:"warning"});return}g.value=!0}return(I,w)=>{const G=o("el-icon"),J=o("el-tag"),H=o("el-button"),N=o("el-descriptions-item"),A=o("el-tooltip"),Y=o("el-descriptions"),R=o("el-table-column"),O=o("el-table"),$=o("el-collapse-item"),L=o("el-collapse"),W=o("el-card"),B=o("router-link"),Z=o("el-form-item"),X=o("el-form"),ae=o("el-dialog");return s(),P(oe,null,[e(W,{class:"summary",shadow:"hover"},{default:t(()=>[c("div",Od,[c("span",{style:st({color:l.version.deployInfo.primary?"#409EFF":"##303133"})},[l.version.deployInfo.primary?(s(),y(J,{key:0,effect:"plain"},{default:t(()=>[e(G,null,{default:t(()=>[e(m(Et))]),_:1}),zd]),_:1})):U("",!0),c("span",Md,D(l.version.versionName),1)],4),c("div",qd,[l.version.releaseInfo?U("",!0):(s(),y(H,{key:0,loading:!0,circle:""})),l.version.releaseInfo?(s(),P("div",Hd,[l.version.releaseInfo&&l.version.releaseInfo.errMsg===""&&l.version.releaseInfo.status?(s(!0),P(oe,{key:0},de(l.version.releaseInfo.status.deployInfo,(j,K,M)=>(s(),P("div",{key:M,style:{display:"flex"}},[M!==0?(s(),P("i",jd)):U("",!0),e(H,{type:j.status.replicas!==j.status.readyReplicas?"default":"success",icon:m(pt),circle:"",loading:j.status.replicas!==j.status.readyReplicas,style:{cursor:"default"}},null,8,["type","icon","loading"])]))),128)):U("",!0),!l.version.releaseInfo||l.version.releaseInfo.errMsg===""&&!l.version.releaseInfo.status?(s(),y(H,{key:1,type:"default",icon:m(pt),loading:!0,circle:"",style:{cursor:"default"}},null,8,["icon"])):U("",!0),l.version.releaseInfo&&!!l.version.releaseInfo.errMsg?(s(),y(H,{key:2,type:"danger",icon:m(Pl),circle:"",style:{cursor:"default"}},null,8,["icon"])):U("",!0)])):U("",!0)])]),e(Y,{style:{"margin-top":"10px"},column:2,size:"small"},{default:t(()=>[e(N,{label:"DeployUser","min-width":200},{label:t(()=>[c("span",Fd,[e(G,null,{default:t(()=>[e(m(Ua))]),_:1}),Bd])]),default:t(()=>[v(" "+D(l.version.deployInfo.lastEditUser),1)]),_:1}),_.value.kind===m(We)?(s(),y(N,{key:0},{label:t(()=>[c("span",Kd,[e(G,null,{default:t(()=>[e(m(Pa))]),_:1}),Wd])]),default:t(()=>[l.version.releaseInfo?(s(),P("span",Yd,[e(A,{class:"box-item",effect:"dark",content:"K8S service name,click to copy",placement:"bottom"},{default:t(()=>[c("a",{style:{"margin-left":"5px"},type:"primary",href:"",onClick:w[0]||(w[0]=Fe(j=>z(l.version.releaseInfo.deployName+"."+l.version.releaseInfo.namespace,"Copy service name success"),["prevent"])),class:"tag-class a-class"},[v(D(l.version.releaseInfo.deployName+"."+l.version.releaseInfo.namespace)+" ",1),e(G,{style:{"margin-left":"5px"}},{default:t(()=>[e(m(Lt))]),_:1})])]),_:1})])):U("",!0)]),_:1})):U("",!0),e(N,{label:"DeployDate"},{label:t(()=>[c("span",Jd,[e(G,null,{default:t(()=>[e(m(Yt))]),_:1}),Zd])]),default:t(()=>[v(" "+D(T(l.version.deployInfo.lastEditDate)),1)]),_:1}),e(N,{label:"Monitor"},{label:t(()=>[c("span",Qd,[e(G,null,{default:t(()=>[e(m(Al))]),_:1}),Xd])]),default:t(()=>[c("div",ec,[e(H,{size:"small",plain:"",type:"info",style:{"margin-left":"0px","margin-bottom":"5px"},onClick:w[1]||(w[1]=j=>x(l.version.releaseInfo.deployName))},{default:t(()=>[c("img",{src:m(Gd),style:{height:"15px","margin-right":"10px"}},null,8,tc),ac]),_:1}),n.cluster!=="e9k8s"&&l.version&&l.version.releaseInfo&&l.version.releaseInfo.namespace?(s(),y(H,{key:0,size:"small",plain:"",type:"info",disabled:r.value,onClick:w[2]||(w[2]=j=>S(l.version.releaseInfo.namespace)),style:{"margin-left":"5px"}},{default:t(()=>[c("img",{src:m(Ld),style:{height:"15px"}},null,8,lc),nc]),_:1},8,["disabled"])):U("",!0),e(A,{disabled:!r.value,class:"box-item",effect:"dark",content:"Canary analysis is running, need to close canary first",placement:"bottom"},{default:t(()=>[l.deployRole?(s(),P("div",oc,[e(H,{style:{"margin-left":"10px"},disabled:r.value,size:"small",icon:m(Ut),type:"success",onClick:te},{default:t(()=>[sc]),_:1},8,["disabled","icon"]),e(H,{size:"small",disabled:r.value,icon:m(je),type:"danger",onClick:V},{default:t(()=>[rc]),_:1},8,["disabled","icon"])])):U("",!0)]),_:1},8,["disabled"])])]),_:1})]),_:1}),e(L,null,{default:t(()=>[e(Td,{cluster:l.cluster,version:l.version,onAnalysis:w[3]||(w[3]=j=>r.value=j)},null,8,["cluster","version"]),l.version.historyDeploys.length>0?(s(),y($,{key:0,name:"2",title:"DeployHistory"},{default:t(()=>[e(O,{data:l.version.historyDeploys,style:{width:"100%"}},{default:t(()=>[e(R,{prop:"image",label:"Image"},{default:t(j=>[c("span",null,[c("span",ic,D(j.row.image),1),j.row.primary?(s(),y(J,{key:0,effect:"plain"},{default:t(()=>[e(G,null,{default:t(()=>[e(m(Et))]),_:1}),uc]),_:1})):U("",!0)])]),_:1}),e(R,{prop:"lastEditUser",label:"DeployUser",width:"100"}),e(R,{prop:"inDate",label:"StartDate",formatter:k,width:"200"}),e(R,{prop:"lastEditDate",label:"EndDate",formatter:k,width:"200"}),e(R,{label:"Operation",width:"140"},{default:t(j=>[e(H,{type:"warning",size:"small",plain:"",onClick:K=>F(j.row.image,j.row.primary)},{default:t(()=>[dc]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):U("",!0)]),_:1}),c("div",null,[l.version.releaseInfo&&l.version.releaseInfo.errMsg&&l.version.releaseInfo.errMsg!==""?(s(),P("div",cc,[e(W,{class:"summary",shadow:"hover"},{default:t(()=>[v(D(l.version.releaseInfo.errMsg),1)]),_:1})])):U("",!0),l.version.releaseInfo&&l.version.releaseInfo.errMsg===""&&l.version.releaseInfo.status?(s(),P("div",pc,[e(O,{data:Object.values(l.version.releaseInfo.status.deployInfo),class:"detail",style:{width:"100%"}},{default:t(()=>[e(R,{label:"Status",width:"140"},{default:t(j=>[j.row.status.replicas<=0?(s(),y(J,{key:0,effect:"plain",type:"danger"},{default:t(()=>[e(G,null,{default:t(()=>[e(m(Wt))]),_:1}),mc]),_:1})):j.row.status.availableReplicas<j.row.status.replicas||!!j.row.status.replicaSetErr?(s(),y(J,{key:1,effect:"plain",type:"warning"},{default:t(()=>[e(G,{class:"is-loading"},{default:t(()=>[e(m(El))]),_:1}),vc]),_:1})):(s(),y(J,{key:2,effect:"plain",type:"success"},{default:t(()=>[e(G,null,{default:t(()=>[e(m(pt))]),_:1}),_c]),_:1}))]),_:1}),e(R,{label:"Name","show-overflow-tooltip":!0},{default:t(j=>[c("span",null,[e(B,{class:"a-class",to:{path:`/service-detail/${l.cluster}/${j.row.namespace}/${j.row.name}/${j.row.labels["app.kubernetes.io/name"]?j.row.labels["app.kubernetes.io/name"]:j.row.name}/${j.row.labels["app.canary.suffixname"]?j.row.labels["app.canary.suffixname"]:""}`}},{default:t(()=>[v(D(j.row.name),1)]),_:2},1032,["to"])]),j.row.status.replicaSetErr?(s(),y(A,{key:0,class:"box-item",content:j.row.status.replicaSetErr,placement:"bottom"},{default:t(()=>[j.row.status.replicaSetErr?(s(),y(J,{key:0,type:"danger",style:{"margin-left":"10px"}},{default:t(()=>[fc]),_:1})):U("",!0)]),_:2},1032,["content"])):U("",!0)]),_:1}),e(R,{label:"Image"},{default:t(j=>[v(D(j.row.image),1)]),_:1}),e(R,{label:"Replicas",width:"80"},{default:t(j=>[v(D(j.row.status.availableReplicas)+"/"+D(j.row.status.replicas),1)]),_:1})]),_:1},8,["data"]),u.value?(s(),y(L,{key:0},{default:t(()=>[e($,{title:"Warnings",name:"1"},{title:t(()=>[c("span",gc,[yc,e(G,{class:"header-icon"},{default:t(()=>[e(m(Pt))]),_:1})])]),default:t(()=>[(s(!0),P(oe,null,de(l.version.releaseInfo.status.resources,(j,K,M)=>(s(),P("div",null,[!j.succeed&&j.msg!==""?(s(),y(W,{key:0,style:{"margin-bottom":"10px"},class:"summary",shadow:"hover"},{header:t(()=>[c("span",null,D(K)+": ",1)]),default:t(()=>[c("span",hc,D(j.msg),1)]),_:2},1024)):U("",!0)]))),256))]),_:1})]),_:1})):U("",!0)])):U("",!0)])]),_:1}),e(ae,{modelValue:g.value,"onUpdate:modelValue":w[6]||(w[6]=j=>g.value=j),title:"Undeploy",width:"20%"},{default:t(()=>[e(X,null,{default:t(()=>[e(Z,null,{default:t(()=>[c("span",null,"Cluster: "+D(l.cluster)+"; Version: "+D(l.version.versionName)+", ",1),bc]),_:1}),e(Z,null,{default:t(()=>[e(H,{type:"danger",onClick:w[4]||(w[4]=j=>h())},{default:t(()=>[wc]),_:1}),e(H,{type:"info",onClick:w[5]||(w[5]=j=>g.value=!1)},{default:t(()=>[Cc]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});var $c=ke(kc,[["__scopeId","data-v-4a6dbba0"]]);const xc=v("deployed"),Vc=v("primary"),Sc={key:0,style:{color:"#E6A23C",width:"100%"}},Dc={style:{"margin-right":"10px"}},Ic={key:0,style:{color:"#E6A23C","margin-left":"5px"}},Rc=v(" Deployment Name: "),Nc={style:{"font-weight":"bold",color:"blue"}},Uc={key:0,style:{color:"#E6A23C"}},Pc={key:1,style:{color:"#E6A23C"}},Ac=v(" ReDeploy Helm Chart "),Ec=v(" Deploy Helm Chart "),Tc=he({props:{serviceBase:null,isPrd:{type:Boolean}},emits:["deploy"],setup(l,{expose:a,emit:n}){const d=l,p=i("Deploy Helm Chart"),_=i(),u=i(!1);i("dev-harbor.newegg.org"),i(""),i("");const f=i(""),C=i([]),r=i(),b=i(!1),T=i(!1),k=Ue(),S=parseInt(k.currentRoute.value.params.gId),x=i({vid:0,primary:!1,cluster:"",image:""}),te=i({vid:[{required:!0,message:"version is required",trigger:"blur"},{validator:(J,H,N)=>{H===0?N(new Error("required")):N()},trigger:"blur"}],namespace:[{required:!0,message:"namespace is required",trigger:"blur"},{validator:(J,H,N)=>{H===""?N(new Error("required")):N()},trigger:"blur"}]}),F=(J,H)=>{var A;const N=(A=r.value)==null?void 0:A.clusters[0].image.split("|");if(!N||N.length!=2){H([]);return}qe.GetChartVersionList(N[0],N[1],{disableLoading:!0}).then(Y=>{const R=Y.data;!R||R.length==0?H([]):H(R.map(O=>({value:O.version})))})};function h(J){if(J=J,J){let H=C.value.find(N=>N.clusters[0]&&N.clusters[0].deployInfo.primary);H&&H.id!==x.value.vid&&(f.value=H.name)}}function V(J){f.value="";let H=C.value.find(N=>N.id===J);H&&(r.value=H,b.value=r.value.clusters[0].deployInfo.master,x.value.primary=r.value.clusters[0].deployInfo.primary,x.value.primary=r.value.clusters[0].deployInfo.primary,r.value.clusters[0].deployInfo.master?(r.value.clusters[0].deployInfo.image,T.value=r.value.clusters[0].image.split(":")[0]!==r.value.clusters[0].deployInfo.image.split(":")[0]):(r.value.clusters[0].image,T.value=!1))}async function I(J){!J||await J.validate((H,N)=>{H?(x.value.image=x.value.tagName?x.value.tagName:"",fe.Deploy(S,x.value).then(A=>{ye({showClose:!0,message:"Deploy successfully.",type:"success"}),u.value=!1,n("deploy")})):ye({showClose:!0,message:"Validate failed",type:"error"})})}return a({openDeploy:(J,H)=>{p.value=J,f.value="",x.value={vid:0,primary:!1,cluster:H.cluster,image:H.image,tagName:H.image};let N={name:"",sid:d.serviceBase.id,cluster:H.cluster,pageIndex:0,pageSize:0};b.value=!1,fe.GetVersionBase(S,N).then(A=>{C.value=A.data.versions.filter(Y=>Y.clusters.length>0),C.value.push({id:0,name:"--/--",serviceId:d.serviceBase.id,description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""}),H.vid!==0&&(H.image===""?(x.value.vid=H.vid,V(H.vid)):(x.value=H,x.value.tagName=H.image))}),u.value=!0}}),(J,H)=>{const N=o("el-col"),A=o("el-tag"),Y=o("el-row"),R=o("el-option"),O=o("el-select"),$=o("el-form-item"),L=o("el-autocomplete"),W=o("el-switch"),B=o("el-alert"),Z=o("el-button"),X=o("el-form"),ae=o("el-dialog");return s(),y(ae,{modelValue:u.value,"onUpdate:modelValue":H[5]||(H[5]=j=>u.value=j),title:p.value,width:"35%"},{default:t(()=>[e(X,{ref_key:"ruleFormRef",ref:_,rules:te.value,model:x.value},{default:t(()=>[e($,{label:"Version","label-width":"100px",prop:"vid",style:{width:"95%"}},{default:t(()=>[e(O,{onChange:V,modelValue:x.value.vid,"onUpdate:modelValue":H[0]||(H[0]=j=>x.value.vid=j),style:{width:"100%"}},{default:t(()=>[(s(!0),P(oe,null,de(C.value,j=>(s(),y(R,{label:j.name,value:j.id},{default:t(()=>[e(Y,null,{default:t(()=>[e(N,{span:16},{default:t(()=>[c("span",null,D(j.name),1)]),_:2},1024),j.clusters.length>0?(s(),y(N,{key:0,span:8,style:{"text-align":"right"}},{default:t(()=>[j.clusters[0].deployInfo.master?(s(),y(A,{key:0},{default:t(()=>[xc]),_:1})):U("",!0),j.clusters[0].deployInfo.primary?(s(),y(A,{key:1},{default:t(()=>[Vc]),_:1})):U("",!0)]),_:2},1024)):U("",!0)]),_:2},1024)]),_:2},1032,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e($,{label:"Namespace","label-width":"100px",style:{width:"95%"}},{default:t(()=>[c("span",null,D(l.serviceBase.namespace),1),r.value&&r.value.clusters[0].deployInfo.namespace!==""&&r.value.clusters[0].deployInfo.namespace!==l.serviceBase.namespace?(s(),P("div",Sc,"Service namespace has changed,current namespace is '"+D(r.value.clusters[0].deployInfo.namespace)+"'",1)):U("",!0)]),_:1}),r.value&&r.value.clusters[0].image!==""?(s(),y($,{key:0,label:"Helm Chart","label-width":"100px",style:{width:"95%"},"show-overflow-tooltip":""},{default:t(()=>[c("strong",Dc,D(r.value.clusters[0].image),1)]),_:1})):U("",!0),x.value.vid>0?(s(),y($,{key:1,label:"Chart Ver.","label-width":"100px",prop:"tagName",style:{width:"95%"},rules:[{required:!0,message:"Please input image tag",trigger:"blur"}]},{default:t(()=>[e(L,{modelValue:x.value.tagName,"onUpdate:modelValue":H[1]||(H[1]=j=>x.value.tagName=j),style:{width:"100%",height:"100%"},placeholder:"example bts/test:0.0.1","fetch-suggestions":F},null,8,["modelValue"])]),_:1})):U("",!0),e($,{style:{width:"95%",display:"flex"}},{default:t(()=>[e($,{label:"Primary","label-width":"100px",style:{flex:"1"}},{default:t(()=>{var j,K;return[e(W,{onChange:h,modelValue:x.value.primary,"onUpdate:modelValue":H[2]||(H[2]=M=>x.value.primary=M),class:"ml-2","active-color":"#13ce66",disabled:(K=(j=r.value)==null?void 0:j.clusters[0])==null?void 0:K.deployInfo.primary},null,8,["modelValue","disabled"]),f.value!==""?(s(),P("span",Ic," The old primary version is "+D(f.value)+",you will overwrite deploy the new primary version",1)):U("",!0)]}),_:1}),x.value.vid>0?(s(),y(B,{key:0,type:"info",style:{"margin-top":"10px","margin-bottom":"10px"}},{title:t(()=>{var j;return[Rc,c("span",Nc,D(x.value.primary?`${l.serviceBase.name}`:`${(j=r.value)==null?void 0:j.name}-${l.serviceBase.name}`),1),f.value===""&&!b.value?(s(),P("div",Uc,"You will have multiple versions at the same time.")):U("",!0),b.value?(s(),P("div",Pc,"Redploy will not happen if the version meta or image has not changed.")):U("",!0)]}),_:1})):U("",!0),e($,{style:{width:"100%"}},{default:t(()=>[b.value?(s(),y(Z,{key:0,disabled:x.value.tagName===""||x.value.vid<=0,onClick:H[3]||(H[3]=j=>I(_.value)),type:"success",style:{"margin-left":"auto"}},{default:t(()=>[Ac]),_:1},8,["disabled"])):U("",!0),b.value?U("",!0):(s(),y(Z,{key:1,disabled:x.value.tagName===""||x.value.vid<=0,onClick:H[4]||(H[4]=j=>I(_.value)),type:"success",style:{"margin-left":"auto"}},{default:t(()=>[Ec]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});const qt=l=>(Re("data-v-0b493d2e"),l=l(),Ne(),l),Gc={class:"deploy"},Lc={style:{"margin-right":"5px","margin-left":"5px"},class:"deploy-title version"},Oc={class:"right"},zc={class:"cell-item"},Mc=qt(()=>c("span",{class:"lable-description"}," DeployUser: ",-1)),qc={class:"cell-item"},Hc=qt(()=>c("span",{class:"lable-description"}," DeployDate: ",-1)),jc={class:"cell-item"},Fc=qt(()=>c("span",{class:"lable-description"}," Chart Version: ",-1)),Bc={style:{display:"flex"}},Kc={style:{"margin-left":"auto"}},Wc=v(" ReDeploy "),Yc=v(" UnDeploy "),Jc={style:{"margin-right":"5px","margin-left":"3px"}},Zc=v(" Primary "),Qc=v("Rollback"),Xc={style:{display:"flex"}},ep={style:{"margin-top":"5px","margin-bottom":"5px"}},tp={style:{"margin-left":"auto","text-align":"right"}},ap={style:{"margin-top":"5px"}},lp={key:0,style:{"padding-right":"10px","padding-bottom":"5px"}},np=qt(()=>c("span",null,"Are you sure you want to undeploy?",-1)),op=v("Yes"),sp=v("No"),rp=he({props:{isPrd:{type:Boolean},deployRole:{type:Boolean},version:null,cluster:null},emits:["reDeploy","refresh"],setup(l,{emit:a}){const n=l,d=Ue();d.currentRoute.value.params.sId;const p=parseInt(d.currentRoute.value.params.gId),_=i([]),u=i({id:"",name:"",kind:"",groupId:0,description:"",tags:[],inUser:"",inDate:"",lastEditUser:"",lastEditDate:"",clusterName:[],formTags:[],ingressClusters:[],namespace:"",repository:"",chart:"",helmChart:""});i(!1);const g=i(!1);i(""),i(""),f();function f(){ie.getters.CurrentService(d.currentRoute.value.params.sId).then(E=>{E||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),d.push({name:"service-management"})),u.value=E}),b(n.version)}function C(E){return fe.formatDate(E)}function r(E,z){return fe.formatDate(E[z.property])}function b(E){E.releaseInfo&&E.releaseInfo.status&&E.releaseInfo.status.conditions&&(_.value=E.releaseInfo.status.conditions.sort((z,te)=>te.lastTransitionTime>z.lastTransitionTime?1:-1))}Pe(()=>n.version,b);function T(){let E={vid:n.version.versionId,primary:!1,cluster:n.cluster,image:""};a("reDeploy",E)}function k(E,z){let te={vid:n.version.versionId,primary:z,cluster:n.cluster,image:E};a("reDeploy",te)}function S(){fe.UnDeploy(p,{vid:n.version.versionId,cluster:n.cluster,primary:n.version.deployInfo.primary,image:""}).then(E=>{ye({showClose:!0,message:"UnDeploy successfully.",type:"success"}),a("refresh")})}function x(){if(n.isPrd&&!n.deployRole){ye({showClose:!0,message:"You do not have permission to operate the production environment,deploy PRD Cluster through Release Portal.",type:"warning"});return}g.value=!0}return(E,z)=>{const te=o("el-icon"),F=o("el-tag"),h=o("el-descriptions-item"),V=o("el-button"),I=o("el-descriptions"),w=o("el-table-column"),G=o("el-table"),J=o("el-collapse-item"),H=o("el-collapse"),N=o("el-progress"),A=o("el-card"),Y=o("el-form-item"),R=o("el-form"),O=o("el-dialog");return s(),P(oe,null,[(s(),y(A,{class:"summary",shadow:"hover",key:l.version.versionName},{default:t(()=>[c("div",Gc,[c("span",{style:st({color:l.version.deployInfo.primary?"#409EFF":"##303133"})},[e(te,null,{default:t(()=>[e(m(Et))]),_:1}),c("span",Lc,D(l.version.versionName),1)],4),c("div",Oc,[e(F,{effect:"dark",type:"info",round:""},{default:t(()=>[v("Helm Chart | "+D(l.version.image.split("|").length>1?l.version.image.split("|")[1]:l.version.image),1)]),_:1})])]),e(I,{style:{"margin-top":"10px"},column:2,size:"small"},{default:t(()=>[e(h,{label:"DeployUser","min-width":200},{label:t(()=>[c("span",zc,[e(te,null,{default:t(()=>[e(m(Ua))]),_:1}),Mc])]),default:t(()=>[v(" "+D(l.version.deployInfo.lastEditUser),1)]),_:1}),e(h,{label:"DeployDate"},{label:t(()=>[c("span",qc,[e(te,null,{default:t(()=>[e(m(Yt))]),_:1}),Hc])]),default:t(()=>[v(" "+D(C(l.version.deployInfo.lastEditDate)),1)]),_:1}),e(h,null,{label:t(()=>[c("span",jc,[e(te,null,{default:t(()=>[e(m(Yt))]),_:1}),Fc])]),default:t(()=>[v(" "+D(l.version.deployInfo.image)+" ",1),c("div",Bc,[c("div",Kc,[l.deployRole?(s(),y(V,{key:0,style:{"margin-left":"10px"},size:"small",icon:m(Ut),type:"success",onClick:T},{default:t(()=>[Wc]),_:1},8,["icon"])):U("",!0),l.deployRole?(s(),y(V,{key:1,size:"small",icon:m(je),type:"danger",onClick:x},{default:t(()=>[Yc]),_:1},8,["icon"])):U("",!0)])])]),_:1})]),_:1}),e(H,null,{default:t(()=>[l.version.historyDeploys.length>0?(s(),y(J,{key:0,name:"1",title:"DeployHistory"},{default:t(()=>[e(G,{data:l.version.historyDeploys,style:{width:"100%"}},{default:t(()=>[e(w,{prop:"image",label:"Chart Version"},{default:t($=>[c("span",null,[c("span",Jc,D($.row.image),1),$.row.primary?(s(),y(F,{key:0,effect:"dark",size:"small"},{default:t(()=>[e(te,null,{default:t(()=>[e(m(Et))]),_:1}),Zc]),_:1})):U("",!0)])]),_:1}),e(w,{prop:"lastEditUser",label:"DeployUser",width:"100"}),e(w,{prop:"inDate",label:"StartDate",formatter:r,width:"200"}),e(w,{prop:"lastEditDate",label:"EndDate",formatter:r,width:"200"}),e(w,{label:"Operation",width:"140"},{default:t($=>[e(V,{type:"warning",size:"small",plain:"",onClick:L=>k($.row.image,$.row.primary)},{default:t(()=>[Qc]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})):U("",!0)]),_:1}),(s(!0),P(oe,null,de(_.value,$=>(s(),y(A,{key:$.message,style:{"margin-bottom":"15px",padding:"5px"}},{default:t(()=>[c("div",Xc,[c("div",null,[c("h4",ep,D($.reason),1),v(" "+D($.message),1)]),c("div",tp,[$.status==="True"?(s(),y(F,{key:0,size:"small",type:"success",effect:"dark",round:""},{default:t(()=>[v(D($.type),1)]),_:2},1024)):U("",!0),$.status!=="True"?(s(),y(F,{key:1,size:"small",type:"warning",effect:"dark",round:""},{default:t(()=>[v(D($.status==="False"?"ERROR":$.status),1)]),_:2},1024)):U("",!0),c("div",ap,D($.lastTransitionTime),1)])]),$.reason==="Progressing"?(s(),P("div",lp,[e(N,{percentage:100,"show-text":!1,indeterminate:!0})])):U("",!0)]),_:2},1024))),128))]),_:1})),e(O,{modelValue:g.value,"onUpdate:modelValue":z[2]||(z[2]=$=>g.value=$),title:"Undeploy",width:"20%"},{default:t(()=>[e(R,null,{default:t(()=>[e(Y,null,{default:t(()=>[c("span",null,"Cluster: "+D(l.cluster)+"; Version: "+D(l.version.versionName)+", ",1),np]),_:1}),e(Y,null,{default:t(()=>[e(V,{type:"danger",onClick:z[0]||(z[0]=$=>S())},{default:t(()=>[op]),_:1}),e(V,{type:"info",onClick:z[1]||(z[1]=$=>g.value=!1)},{default:t(()=>[sp]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}});var ip=ke(rp,[["__scopeId","data-v-0b493d2e"]]);const up=v("deployed"),dp=v("primary"),cp={key:0,style:{color:"#E6A23C",width:"100%"}},pp={key:0},mp={key:1,style:{color:"red"}},vp={key:2,style:{color:"red"}},_p={style:{"margin-right":"10px"}},fp=v("Update"),gp={key:0,style:{color:"#E6A23C","margin-left":"5px"}},yp=v(" Deployment Name: "),hp={style:{"font-weight":"bold",color:"blue"}},bp={key:0,style:{color:"#E6A23C"}},wp={key:1,style:{color:"#E6A23C"}},Cp=c("span",{style:{"font-weight":"bold",color:"red"}}," Canary Analysis is running! ReDeploy will break Canary Analysis",-1),kp=v(" Deploy "),$p=he({props:{serviceBase:null,isPrd:{type:Boolean}},emits:["deploy"],setup(l,{expose:a,emit:n}){const d=l,p=i("Deploy"),_=i(),u=i(!1),g="dev-harbor.newegg.org",f="harbor.newegg.org",C=i(g),r=i(""),b=i(""),T=i(""),k=i([]),S=i(),x=i(!1),E=i(!1),z=Ue(),te=parseInt(z.currentRoute.value.params.gId),F=i({vid:0,primary:!0,cluster:"",image:""}),I=i({vid:[{required:!0,message:"version is required",trigger:"blur"},{validator:(O,$,L)=>{$===0?L(new Error("required")):L()},trigger:"blur"}],namespace:[{required:!0,message:"namespace is required",trigger:"blur"},{validator:(O,$,L)=>{$===""?L(new Error("required")):L()},trigger:"blur"}]}),w=O=>!1,G=(O,$)=>{if(C.value==""||r.value==""||b.value==""){$([]);return}Tt.SearchImageTags(C.value,r.value,b.value).then(L=>{const W=[];for(const B of L){if(O.trim()==""){W.push({value:B.name});continue}B.name.toLowerCase().includes(O.trim().toLowerCase())&&W.push({value:B.name})}$(W)})};function J(O){if(O=O,O){let $=k.value.find(L=>L.clusters[0]&&L.clusters[0].deployInfo.primary);$&&$.id!==F.value.vid&&(T.value=$.name)}}function H(O){if(!O)return;let $=Zt(O);return C.value=$.domain,b.value=$.repositoryName,r.value=$.projectName,F.value.tagName=$.tag,$}function N(O){T.value="";let $=k.value.find(L=>L.id===O);if($){S.value=$,x.value=S.value.clusters[0].deployInfo.master,F.value.primary=S.value.clusters[0].deployInfo.primary;let L="";S.value.clusters[0].deployInfo.master?(L=S.value.clusters[0].deployInfo.image,E.value=S.value.clusters[0].image.split(":")[0]!==S.value.clusters[0].deployInfo.image.split(":")[0]):(L=S.value.clusters[0].image,E.value=!1),H(L)}}async function A(O){!O||await O.validate(($,L)=>{$?(F.value.image=C.value+"/"+r.value+"/"+b.value+":"+F.value.tagName,fe.Deploy(te,F.value).then(W=>{ye({showClose:!0,message:"Deploy successfully.",type:"success"}),u.value=!1,n("deploy")})):ye({showClose:!0,message:"Validate failed",type:"error"})})}return a({openDeploy:(O,$)=>{p.value=O,T.value="",F.value={vid:0,primary:!1,cluster:$.cluster,image:""};let L={name:"",sid:d.serviceBase.id,cluster:$.cluster,pageIndex:0,pageSize:0};x.value=!1,fe.GetVersionBase(te,L).then(W=>{k.value=W.data.versions.filter(B=>B.clusters.length>0),k.value.push({id:0,name:"--/--",serviceId:d.serviceBase.id,description:"",contact:"",clusters:[],inDate:"",inUser:"",lastEditDate:"",lastEditUser:""}),$.vid!==0&&($.image===""?(F.value.vid=$.vid,N($.vid)):(F.value=$,H(F.value.image)))}),u.value=!0}}),(O,$)=>{const L=o("el-col"),W=o("el-tag"),B=o("el-row"),Z=o("el-option"),X=o("el-select"),ae=o("el-form-item"),j=o("el-button"),K=o("el-tooltip"),M=o("el-autocomplete"),se=o("el-switch"),be=o("el-alert"),Ve=o("el-form"),ve=o("el-dialog");return s(),y(ve,{modelValue:u.value,"onUpdate:modelValue":$[6]||($[6]=le=>u.value=le),title:p.value,width:"35%"},{default:t(()=>[e(Ve,{ref_key:"ruleFormRef",ref:_,rules:I.value,model:F.value},{default:t(()=>[e(ae,{label:"Version","label-width":"100px",prop:"vid",style:{width:"95%"}},{default:t(()=>[e(X,{onChange:N,modelValue:F.value.vid,"onUpdate:modelValue":$[0]||($[0]=le=>F.value.vid=le),style:{width:"100%"}},{default:t(()=>[(s(!0),P(oe,null,de(k.value,le=>(s(),y(Z,{label:le.name,value:le.id},{default:t(()=>[e(B,null,{default:t(()=>[e(L,{span:16},{default:t(()=>[c("span",null,D(le.name),1)]),_:2},1024),le.clusters.length>0?(s(),y(L,{key:0,span:8,style:{"text-align":"right"}},{default:t(()=>[le.clusters[0].deployInfo.master?(s(),y(W,{key:0},{default:t(()=>[up]),_:1})):U("",!0),le.clusters[0].deployInfo.primary?(s(),y(W,{key:1},{default:t(()=>[dp]),_:1})):U("",!0)]),_:2},1024)):U("",!0)]),_:2},1024)]),_:2},1032,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(ae,{label:"Namespace","label-width":"100px",style:{width:"95%"}},{default:t(()=>[c("span",null,D(l.serviceBase.namespace),1),S.value&&S.value.clusters[0].deployInfo.namespace!==""&&S.value.clusters[0].deployInfo.namespace!==l.serviceBase.namespace?(s(),P("div",cp,"Service namespace has changed,current namespace is '"+D(S.value.clusters[0].deployInfo.namespace)+"'",1)):U("",!0)]),_:1}),F.value.vid>0?(s(),y(ae,{key:0,label:"Image","label-width":"100px",style:{width:"95%"},"show-overflow-tooltip":""},{default:t(()=>[r.value!==""&&b.value!==""?(s(),P("strong",pp,D(C.value)+"/"+D(r.value)+"/"+D(b.value)+":"+D(F.value.tagName),1)):U("",!0),r.value===""||b.value===""?(s(),P("strong",mp,"image format error, please check")):U("",!0),l.isPrd&&C.value!==f?(s(),P("strong",vp,"Prd cluster only use 'harbor.newegg.org' hub address")):U("",!0)]),_:1})):U("",!0),E.value&&F.value.vid>0?(s(),y(ae,{key:1,label:"Meta Image","label-width":"100px",style:{width:"95%"},"show-overflow-tooltip":""},{default:t(()=>{var le,Se;return[c("strong",_p,D((Se=(le=S.value)==null?void 0:le.clusters[0])==null?void 0:Se.image),1),e(K,{content:"Update meta image to deploy image",placement:"top"},{default:t(()=>[e(j,{size:"small",type:"primary",onClick:$[1]||($[1]=ge=>{var ne,ee;return H((ee=(ne=S.value)==null?void 0:ne.clusters[0])==null?void 0:ee.image)})},{default:t(()=>[fp]),_:1})]),_:1})]}),_:1})):U("",!0),F.value.vid>0?(s(),y(ae,{key:2,label:"Tag","label-width":"100px",prop:"tagName",style:{width:"95%"},rules:[{required:!0,message:"Please input image tag",trigger:"blur"}]},{default:t(()=>[e(M,{modelValue:F.value.tagName,"onUpdate:modelValue":$[2]||($[2]=le=>F.value.tagName=le),style:{width:"100%",height:"100%"},placeholder:"example bts/test:0.0.1","fetch-suggestions":G},null,8,["modelValue"])]),_:1})):U("",!0),e(ae,{style:{width:"95%",display:"flex"}},{default:t(()=>[e(ae,{label:"Primary","label-width":"100px",style:{flex:"1"}},{default:t(()=>[e(se,{onChange:J,modelValue:F.value.primary,"onUpdate:modelValue":$[3]||($[3]=le=>F.value.primary=le),class:"ml-2","active-color":"#13ce66",disabled:S.value&&S.value.clusters[0].deployInfo.primary},null,8,["modelValue","disabled"]),T.value!==""?(s(),P("span",gp," The old primary version is "+D(T.value)+",you will overwrite deploy the new primary version",1)):U("",!0)]),_:1}),F.value.vid>0?(s(),y(be,{key:0,type:"info",style:{"margin-top":"10px","margin-bottom":"10px"}},{title:t(()=>{var le;return[yp,c("span",hp,D(F.value.primary?`${l.serviceBase.name}`:`${(le=S.value)==null?void 0:le.name}-${l.serviceBase.name}`),1),T.value===""&&!x.value?(s(),P("div",bp,"You will have multiple versions at the same time.")):U("",!0),x.value?(s(),P("div",wp,"Redploy will not happen if the version meta or image has not changed.")):U("",!0)]}),_:1})):U("",!0),w(F.value.vid)?(s(),y(be,{key:1,type:"error",style:{"margin-top":"10px","margin-bottom":"10px"}},{title:t(()=>[Cp]),_:1})):U("",!0),e(ae,{style:{width:"100%"}},{default:t(()=>[x.value?(s(),y(j,{key:0,disabled:r.value===""||b.value===""||F.value.vid<=0,onClick:$[4]||($[4]=le=>A(_.value)),type:"success",style:{"margin-left":"auto"}},{default:t(()=>[v(D(w(F.value.vid)?"Break Canary & ":"")+"ReDeploy ",1)]),_:1},8,["disabled"])):U("",!0),x.value?U("",!0):(s(),y(j,{key:1,disabled:r.value===""||b.value===""||F.value.vid<=0,onClick:$[5]||($[5]=le=>A(_.value)),type:"success",style:{"margin-left":"auto"}},{default:t(()=>[kp]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),xp=v("View Canary Report"),Vp={style:{margin:"0",color:"#409EFF"}},Sp=v(" Canary Reports "),Dp=v(" View Report "),Ip=he({props:{cluster:null},setup(l){const a=l,n=Ue(),d=i(n.currentRoute.value.params.sId),p=i(!1),_=i([]),u=b=>{switch(b){case"deploy_created":return{title:"Deploy Canary",content:"Deploy Baseline&Canary version",type:"info"};case"deploy_padding":return{title:"Wait Deploy",content:"Wait Deploy done",type:"info"};case"deploy_done":return{title:"Collecting&Analysis",content:"Deploy done,Collecting&Analysis.. data",type:"info"};case"analysis_report":return{title:"Reporting",content:"Analysis and gen Report",type:"info"};case"canary_terminated":return{title:"Terminated",content:"Canary terminated (user stop)",type:"warning"};case"analysis_done":return{title:"Done",content:"Canary Analysis done&Report success",type:"success"};case"deploy_timeout":return{title:"Timeout",content:"Deploy Timeout,deploy cost too much time",type:"danger"};default:return{title:b,content:"Unknow stauts"+b}}},g=b=>{if(b.startsWith("1970"))return"N/A";const T=new Date(b);return mt(T).local().format("YYYY-MM-DD HH:mm:ss")},f=b=>b.kayentaBaseUrl!==""&&b.kayentaFinalExecutionID!=="",C=b=>{window.open(`${b.kayentaBaseUrl}/dashboard/reports/canary/${b.kayentaFinalExecutionID}`,"_blank")},r=()=>{fe.GetCanaryAnalysisByCluster(d.value,a.cluster).then(b=>{_.value=b.data,p.value=!0})};return(b,T)=>{const k=o("el-button"),S=o("el-icon"),x=o("el-table-column"),E=o("el-tag"),z=o("el-tooltip"),te=o("el-table"),F=o("el-dialog");return s(),P(oe,null,[e(k,{onClick:r,size:"small",icon:m(Rt),plain:""},{default:t(()=>[xp]),_:1},8,["icon"]),e(F,{modelValue:p.value,"onUpdate:modelValue":T[0]||(T[0]=h=>p.value=h),width:"90%"},{header:t(()=>[c("h2",Vp,[e(S,null,{default:t(()=>[e(m(Rt))]),_:1}),Sp])]),default:t(()=>[e(te,{data:_.value,style:{width:"100%"}},{default:t(()=>[e(x,{prop:"version",label:"Version",width:"80"}),e(x,{prop:"status",label:"Status"},{default:t(h=>[e(z,{content:u(h.row.status).content,placement:"top"},{default:t(()=>[e(E,{type:u(h.row.status).type},{default:t(()=>[v(D(u(h.row.status).title),1)]),_:2},1032,["type"])]),_:2},1032,["content"])]),_:1}),e(x,{prop:"tag",label:"Baseline",width:"120"}),e(x,{prop:"canaryTag",label:"Canary",width:"120"}),e(x,{prop:"canaryConfig",label:"Config",width:"100"}),e(x,{prop:"setp",label:"Setp",width:"60"}),e(x,{prop:"startTime",label:"StartTime",width:"170"},{default:t(h=>[v(D(g(h.row.startTime)),1)]),_:1}),e(x,{prop:"endTime",label:"EndTime",width:"170"},{default:t(h=>[v(D(g(h.row.endTime)),1)]),_:1}),e(x,{prop:"lastEditUser",label:"User",width:"70"}),e(x,{prop:"finalScore",label:"Score",width:"80"},{default:t(h=>[e(E,{effect:"dark",type:h.row.finalScore>=h.row.thresholdsPass?"success":h.row.finalScore<h.row.thresholdsPass?"danger":"warning",style:{width:"50px"}},{default:t(()=>[v(D(h.row.finalScore),1)]),_:2},1032,["type"])]),_:1}),e(x,{prop:"finalScore",label:"Report",width:"140"},{default:t(h=>[e(k,{type:"primary",size:"small",plain:"",disabled:!f(h.row),onClick:V=>C(h.row)},{default:t(()=>[e(S,{style:{"margin-right":"5px"}},{default:t(()=>[e(m(Rt))]),_:1}),Dp]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Rp=l=>(Re("data-v-884514d2"),l=l(),Ne(),l),Np=Rp(()=>c("p",null," You don't have a deployable version ",-1)),Up={style:{display:"flex"}},Pp={style:{"margin-left":"auto"}},Ap=v("Deploy "),Ep=v("Try to start Deploy "),Tp=he({setup(l){const a=i(0);i("");const n=i("");i("");const d=i([]),p=i(!1),_=i(!0),u=i(""),g=Ue(),f=i(g.currentRoute.value.params.sId),C=i(parseInt(g.currentRoute.value.params.gId)),r=i([]),b=i(ns);let T;const k=i([]),S=i(),x=i(!1);let E;F(),Xt(I=>{C.value=parseInt(I.params.gId),f.value=I.params.sId});function z(I,w=void 0){if(!p.value){ye({showClose:!0,message:_.value?"You do not have permission to operate the production environment":"You do not have permission to operate",type:"warning"});return}w||(w={vid:0,primary:!1,cluster:u.value,image:""}),w.image!==""&&(I="RollBack"),S.value.openDeploy(I,w)}function te(){V()}function F(){h(!0),ie.getters.CurrentGroup(g.currentRoute.value.params.gId).then(I=>{I||(ye({showClose:!0,message:"this group is not exit.",type:"error"}),g.push({name:"service-management"})),T=I,r.value=T.namespaces;let w=ie.getters.UserAuth;a.value=w.isAdmin?4:w.groups[I.id].auth}),ie.getters.CurrentService(g.currentRoute.value.params.sId).then(I=>{I||(ye({showClose:!0,message:"this service is not exit.",type:"error"}),g.push({name:"service-management"})),n.value=I.name,b.value=I}),b.value.kind===We&&fe.GetCanaryConfigByService(f.value).then(I=>{ie.commit("setCanaryConfig",I.data)}),E=setInterval(()=>V(),5e3)}Vt(()=>{clearInterval(E)});function h(I=!1){fe.GetInstanceCluster(C.value,f.value).then(w=>{var G;if(k.value=w.data,I){let J=g.currentRoute.value.query.cluster;J&&k.value.find(H=>H.cluster===J)?u.value=g.currentRoute.value.query.cluster:(u.value=(G=k.value[0])==null?void 0:G.cluster,g.replace({query:{cluster:u.value}}))}else g.replace({query:{cluster:u.value}});V()})}function V(){fe.GetInstance(C.value,f.value,u.value).then(I=>{d.value=I.data;let w=k.value.find(G=>G.cluster===u.value);_.value=w?w.isPrd:!1,w&&(w.count=d.value.length,p.value=Ea(a.value,w.cluster,w.isPrd))}),b.value.kind===We&&fe.GetCanaryAnalysisByCluster(f.value,u.value).then(I=>{x.value=I.data.length>0,ie.commit("setCanaryStatus",I.data)})}return(I,w)=>{const G=o("el-result"),J=o("el-tag"),H=o("el-button"),N=o("el-timeline-item"),A=o("el-timeline"),Y=o("el-tab-pane"),R=o("el-tabs"),O=o("el-card");return s(),P(oe,null,[e(O,{shadow:"hover","body-style":{padding:"0px"}},{default:t(()=>{var $,L;return[(($=k.value)==null?void 0:$.length)===0?(s(),y(G,{key:0,icon:"info",title:"Can't find Instance"},{"sub-title":t(()=>[Np]),_:1})):U("",!0),((L=k.value)==null?void 0:L.length)!==0?(s(),y(R,{key:1,onTabChange:w[4]||(w[4]=W=>h()),modelValue:u.value,"onUpdate:modelValue":w[5]||(w[5]=W=>u.value=W),type:"border-card"},{default:t(()=>[(s(!0),P(oe,null,de(k.value,W=>(s(),y(Y,{name:W.cluster},{label:t(()=>[c("span",null,D(W.cluster.toUpperCase()),1),e(J,{size:"small",type:"warning",style:{height:"17px","padding-left":"5px","padding-right":"5px",border:"0"}},{default:t(()=>[v(D(W.count.toString()),1)]),_:2},1024)]),default:t(()=>[c("div",Up,[c("div",Pp,[x.value?(s(),y(Ip,{key:0,cluster:W.cluster},null,8,["cluster"])):U("",!0),d.value.length!==0&&p.value?(s(),y(H,{key:1,style:{"margin-left":"10px"},onClick:w[0]||(w[0]=B=>z("Deploy")),size:"small",type:"success",icon:m(Me)},{default:t(()=>[Ap]),_:1},8,["icon"])):U("",!0)])]),d.value.length===0?(s(),y(G,{key:0,icon:"info",title:"Can't find Instance"},{"sub-title":t(()=>[c("p",null,[e(H,{onClick:w[1]||(w[1]=B=>z("Deploy")),size:"small",type:"success",icon:m(Me)},{default:t(()=>[Ep]),_:1},8,["icon"])])]),_:1})):U("",!0),e(A,{class:"timeline"},{default:t(()=>[(s(!0),P(oe,null,de(d.value,(B,Z)=>(s(),y(N,{center:"",placement:"top",key:B.versionName},{default:t(()=>[b.value.kind!=="HelmRelease"?(s(),y($c,{key:0,onReDeploy:w[2]||(w[2]=X=>z("Redeploy",X)),onRefresh:V,cluster:u.value,version:B,isPrd:W.isPrd,deployRole:p.value},null,8,["cluster","version","isPrd","deployRole"])):U("",!0),b.value.kind==="HelmRelease"?(s(),y(ip,{key:1,onReDeploy:w[3]||(w[3]=X=>z("Redeploy",X)),onRefresh:V,cluster:u.value,version:B,isPrd:W.isPrd,deployRole:p.value},null,8,["cluster","version","isPrd","deployRole"])):U("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"]))),256))]),_:1},8,["modelValue"])):U("",!0)]}),_:1}),b.value.kind==="HelmRelease"?(s(),y(Tc,{key:0,ref_key:"instanceDeployRef",ref:S,"is-prd":_.value,"service-base":b.value,onDeploy:te},null,8,["is-prd","service-base"])):U("",!0),b.value.kind!=="HelmRelease"?(s(),y($p,{key:1,ref_key:"instanceDeployRef",ref:S,"is-prd":_.value,"service-base":b.value,onDeploy:te},null,8,["is-prd","service-base"])):U("",!0)],64)}}});var Gp=ke(Tp,[["__scopeId","data-v-884514d2"]]);const Lp={class:"action"},Op={style:{"margin-right":"10px",width:"30px"}},zp=["title"],Mp={key:0},qp=he({setup(l){const n=Ue().currentRoute.value.params.sId,d=i({pageIndex:0,pageSize:10,total:0,activities:[]}),p=i([]);ze(()=>{_(d.value.pageIndex+1)});function _(u){u!=d.value.pageIndex&&(d.value.total>0&&(u-1)*d.value.pageSize>d.value.total||rn.SearchActivitys({type:"",groupName:"",serviceName:"",serviceId:n,pageIndex:u,pageSize:10}).then(g=>{p.value=g.activities.map(f=>(f.show=!1,f.oldData=JSON.stringify(JSON.parse(f.oldData),null,4),f.newData=JSON.stringify(JSON.parse(f.newData),null,4),f.lastEditDate=fe.formatDate(f.lastEditDate),f)),d.value.pageIndex=u,d.value.total=g.total}))}return(u,g)=>{const f=o("el-icon"),C=o("el-col"),r=o("el-row"),b=o("el-collapse-item"),T=o("el-collapse"),k=o("el-card"),S=o("el-timeline-item"),x=o("el-timeline"),E=o("el-pagination");return s(),y(k,{shadow:"hover"},{default:t(()=>[e(x,{style:{"padding-left":"20px","margin-top":"20px"}},{default:t(()=>[(s(!0),P(oe,null,de(p.value,(z,te)=>(s(),y(S,{key:te,type:z.type,timestamp:z.lastEditDate,placement:"top"},{default:t(()=>[e(k,{shadow:"hover","body-style":{paddingTop:"0px",paddingBottom:"0px"}},{default:t(()=>[e(T,{accordion:"",onChange:F=>z.show=!z.show},{default:t(()=>[e(b,{name:"1"},{title:t(()=>[e(r,{style:{width:"100%"}},{default:t(()=>[e(C,{span:18},{default:t(()=>[c("div",Lp,[c("span",Op,[e(f,null,{default:t(()=>[e(m(Tl))]),_:1}),v(" "+D(z.inUser),1)]),c("span",{title:z.action},D(z.action),9,zp)])]),_:2},1024),e(C,{span:6},{default:t(()=>[z.jiraId?(s(),P("span",Mp,[e(f,null,{default:t(()=>[e(m(Ra))]),_:1}),v(" "+D(z.jiraId),1)])):U("",!0)]),_:2},1024)]),_:2},1024)]),default:t(()=>[z.oldData&&z.oldData!="{}"||z.newData&&z.newData!="{}"?(s(),y(Mt,{key:0,show:z.show,oldContent:z.oldData,newContent:z.newData,language:"javascript"},null,8,["show","oldContent","newContent"])):U("",!0)]),_:2},1024)]),_:2},1032,["onChange"])]),_:2},1024)]),_:2},1032,["type","timestamp"]))),128))]),_:1}),e(E,{style:{"padding-top":"10px"},background:"",layout:"prev, pager, next","hide-on-single-page":!0,total:d.value.total,"page-size":d.value.pageSize,onCurrentChange:_},null,8,["total","page-size"])]),_:1})}}});var Hp=ke(qp,[["__scopeId","data-v-4f234e59"]]);const jp=v("Dashboard"),Fp=v("Service Explorer"),Bp=v("Service Management"),Kp=c("span",null,"CRD Manage",-1),Wp=v("CRD"),Yp=v("Service"),Jp=v("Namespaces"),Zp=v("Documents"),Qp=v("Collapse"),Xp=he({setup(l){const a=Ue(),n=i(ie.getters.WindowHeight),d=i(!1),p=i("/dashboard"),_=i(!1);_.value=ie.getters.IsAdmin,Pe(()=>ie.getters.WindowHeight,r=>{n.value=r}),Pe(a.currentRoute,r=>{p.value=r.path});const u=(r,b)=>{},g=(r,b)=>{},f=()=>{d.value=!d.value},C=()=>{window.open("/docs")};return(r,b)=>{const T=o("el-icon"),k=o("el-menu-item"),S=o("el-menu-item-group"),x=o("el-sub-menu"),E=o("el-menu");return s(),y(E,{"default-active":p.value,class:"el-menu-vertical-demo",collapse:d.value,router:!0,onOpen:u,onClose:g},{default:t(()=>[e(k,{style:{"margin-top":"10px"},index:"/dashboard"},{title:t(()=>[jp]),default:t(()=>[e(T,null,{default:t(()=>[e(m(ea))]),_:1})]),_:1}),e(k,{index:"/service-explorer"},{title:t(()=>[Fp]),default:t(()=>[e(T,null,{default:t(()=>[e(m(Pa))]),_:1})]),_:1}),e(k,{index:"/service-management"},{title:t(()=>[Bp]),default:t(()=>[e(T,null,{default:t(()=>[e(m(Na))]),_:1})]),_:1}),m(ie).getters.IsAdmin?(s(),y(x,{key:0,index:"#"},{title:t(()=>[e(T,null,{default:t(()=>[e(m(Gl))]),_:1}),Kp]),default:t(()=>[e(S,null,{default:t(()=>[e(k,{index:"/crd-manage/crd"},{default:t(()=>[Wp]),_:1}),e(k,{index:"/crd-manage/service"},{default:t(()=>[Yp]),_:1})]),_:1})]),_:1})):U("",!0),m(ie).getters.IsAdmin?(s(),y(k,{key:1,index:"/namespaces"},{title:t(()=>[Jp]),default:t(()=>[e(T,null,{default:t(()=>[e(m(Ll))]),_:1})]),_:1})):U("",!0),e(k,{index:"#",onClick:b[0]||(b[0]=z=>C())},{title:t(()=>[Zp]),default:t(()=>[e(T,null,{default:t(()=>[e(m(Ol))]),_:1})]),_:1}),e(k,{class:"bottom-item",index:"#",onClick:b[1]||(b[1]=z=>f())},{title:t(()=>[Qp]),default:t(()=>[e(T,null,{default:t(()=>[d.value?U("",!0):(s(),y(m(Ia),{key:0})),d.value?(s(),y(m(zl),{key:1})):U("",!0)]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])}}});const em={class:"pod-array"},tm={class:"badge",style:{left:"-6px"}},am=["onClick"],lm=he({props:{pods:{required:!0,type:Array},namespace:{required:!0,type:String},onPodClick:{required:!0,type:Function,coerce:l=>!0}},setup(l){const a=l,n=10,{pods:d}=ot(a);i(!0);const p=_=>_==="Running"?`<span style='font-weight: bold;color:lightgreen'>${_}</span>`:`<span style='font-weight: bold;color:orange'>${_}</span>`;return(_,u)=>{const g=o("el-tooltip");return s(),P("div",em,[m(d).filter(f=>f.status==="Running").length>n?(s(),y(g,{key:0,class:"box-item",effect:"dark",placement:"top",content:"Running"},{default:t(()=>[c("div",null,[c("div",{class:Be(["pod aggr",{success:!0}])}),c("div",tm,[c("span",null,D(m(d).filter(f=>f.status==="Running").length),1)])])]),_:1})):U("",!0),(s(!0),P(oe,null,de(m(d).filter(f=>f.status==="Running").length>n?m(d).filter(f=>f.status!=="Running"):m(d),(f,C)=>(s(),y(g,{class:"box-item",effect:"dark",placement:"top",key:f.name,content:`${f.name} | ${p(f.status)}${f.errMsg?`>${f.errMsg}`:""}`,"raw-content":""},{default:t(()=>[c("div",{class:Be(["pod",{success:f.status==="Running",warn:f.status==="Pending",none:f.status!=="Running"&&f.status!=="Pending"}]),onClick:r=>a.onPodClick(a.namespace,f.name)},null,10,am)]),_:2},1032,["content"]))),128))])}}});var nm=ke(lm,[["__scopeId","data-v-37cff3c8"]]);const om=he({props:{servicePorts:{required:!0,type:Array}},setup(l){const a=l,{servicePorts:n}=ot(a);return(d,p)=>{const _=o("el-tag");return s(!0),P(oe,null,de(m(n),u=>(s(),P("div",{key:u.name},[e(_,{class:"service-port",type:"info",size:"small"},{default:t(()=>[v(D(u.name)+":"+D(u.port),1)]),_:2},1024)]))),128)}}});var sm=ke(om,[["__scopeId","data-v-2be8764d"]]);const rm={class:"hpa"},im={class:"metrics"},um=he({props:{hpa:{required:!0,type:Object}},setup(l){const a=l,{hpa:n}=ot(a);i(n.value?n.value.currentMetric:[]);const d=(_,u,g)=>(console.log(u,g),_==="v2beta1"?g.map((f,C)=>{if(f.type=="Resource")return{metricName:f.resource.name,current:u&&u[C]&&u[C].resource?u[C].resource.currentAverageUtilization+"%":"",threshold:f.resource.targetAverageUtilization+"%"};if(f.type=="Pods")return{metricName:f.pods?f.pods.metricName:"",current:u&&u[C]&&u[C].pods?u[C].pods.currentAverageValue:"",threshold:f.pods?f.pods.targetAverageValue:""}}):g.map((f,C)=>{if(f.type=="Resource")return{metricName:f.resource.name,current:u&&u[C]&&u[C].resource?u[C].resource.current.averageUtilization+"%":"",threshold:f.resource.target.averageUtilization+"%"};if(f.type=="Pods")return{metricName:f.pods?f.pods.metric.name:"",current:u&&u[C]&&u[C].pods?u[C].pods.current.averageValue:"",threshold:f.pods?f.pods.target.averageValue:""}})),p=_=>{switch(_){case"http_server_requests_seconds_count":case"http_request_duration_seconds_count":return"REQ";default:return"CPU"}};return(_,u)=>{const g=o("el-tag");return s(),P("div",rm,[c("div",null,D(m(n).minReplicas)+"~"+D(m(n).maxReplicas),1),c("div",im,[(s(!0),P(oe,null,de(d(m(n).apiVersion,m(n).currentMetric,m(n).setMetric),f=>(s(),P("div",{key:f.metricName},[e(g,{class:"hpa-metrics green",type:"info",size:"small"},{default:t(()=>[v(D(p(f.metricName))+":"+D(f.current)+"/"+D(f.threshold),1)]),_:2},1024)]))),128))])])}}});var dm=ke(um,[["__scopeId","data-v-30186cd6"]]);class xa{constructor(){Ge(this,"metadata");Ge(this,"spec");Ge(this,"status")}}const Ht=l=>(Re("data-v-64c7996e"),l=l(),Ne(),l),cm={class:"header"},pm=v("Pod Info "),mm={class:"function"},vm={class:"body"},_m={class:"charts"},fm={class:"switch"},gm=v("CPU "),ym=v(" Memory "),hm=["innerHTML"],bm=Ht(()=>c("div",{class:"title"},[c("h4",null,"Containers")],-1)),wm={class:"podname"},Cm=Ht(()=>c("div",{class:"container success"},null,-1)),km=["innerHTML"],$m=Ht(()=>c("div",{class:"title"},[c("h4",null,"Events")],-1)),xm={class:"event"},Vm=Ht(()=>c("br",null,null,-1)),Sm={style:{"margin-left":"5px","font-weight":"bold"}},Dm=["innerHTML"],Im=he({props:{isOpen:{required:!0,type:Boolean},onClose:{required:!0,type:Function,coerce:l=>!0},onOpenLog:{required:!0,type:Function},cluster:{required:!0,type:String},namespace:{required:!0,type:String},pod:{required:!0,type:String}},setup(l){const a=l,n=i(a.isOpen),d=i(new xa),p=i([]),_=i("cpu"),u=i([]);Pe(()=>a.isOpen,h=>{n.value=h});const g=()=>{Ae.GetPodDetail(a.cluster,a.namespace,a.pod).then(h=>{const V=Object.assign(new xa,h.data);d.value=V,T(V.metadata,V.spec,V.status),k(V.spec,V.status)}),Ae.GetEvents(a.cluster,a.namespace,"Pod",a.pod,100,1).then(h=>{u.value=h.data.events}),f()},f=()=>{Ae.GetPodMetrics(a.cluster,a.namespace,a.pod,_.value).then(h=>{h.data&&h.data.data&&h.data.data.result&&h.data.data.result[0]&&h.data.data.result[0].values&&(p.value=h.data.data.result[0].values)})},C=()=>{confirm(`Are you share want to delete [${a.pod}]`)&&Ae.DeletePodMetrics(a.cluster,a.namespace,a.pod).then(h=>{})},r=()=>{a.onOpenLog(d.value.metadata.name,d.value.spec.containers.map(h=>h.name))},b=h=>{_.value=h,f()},T=(h,V,I)=>{const w=[{key:"Created",value:h.creationTimestamp},{key:"Labels",value:S(h.labels)},{key:"Annotations",value:S(h.labels)},{key:"Node",value:V.nodeName},{key:"Hostname",value:V.hostname?V.hostname:"None"},{key:"Status",value:I.phase}];te.value=w},k=(h,V)=>{const I=h.containers.map((w,G)=>({name:w.name,infos:[{key:"Status",value:V.containerStatuses[G].state?Object.keys(V.containerStatuses[G].state).join(","):""},{key:"Restarts",value:V.containerStatuses[G].restartCount},{key:"Image",value:w.image},{key:"Ports",value:z(w.ports)},{key:"Environment",value:x(w.env)},{key:"VolumeMount",value:E(w.volumeMounts)}]}));F.value=I},S=h=>Object.keys(h).map(V=>`${V}=${h[V]}`).join("<br/>"),x=h=>h?h.map(V=>`${V.name}:${V.value}`).join("<br/>"):"None",E=h=>h?h.map(V=>`[${V.name}]  ${V.mountPath}`).join("<br/>"):"None",z=h=>h?h.map(V=>`${V.name?V.name:""}:${V.containerPort}/${V.protocol}`).join("<br/>"):"None",te=i([]),F=i([]);return(h,V)=>{const I=o("el-tag"),w=o("el-button"),G=o("el-icon"),J=o("el-button-group"),H=o("el-table-column"),N=o("el-table"),A=o("el-divider"),Y=o("el-drawer");return s(),y(Y,{modelValue:n.value,"onUpdate:modelValue":V[3]||(V[3]=R=>n.value=R),"with-header":!1,"show-close":!1,"before-close":()=>a.onClose(),"append-to-body":!1,"custom-class":"drawer podinfo",size:"50%",onOpen:g},{default:t(()=>[c("div",cm,[c("h3",null,[pm,e(I,{class:"pod",type:"success"},{default:t(()=>[v(D(a.pod),1)]),_:1})]),c("div",mm,[e(w,{icon:m(Ml),type:"primary",onClick:r},null,8,["icon"]),m(ie).getters.IsAdmin?(s(),y(w,{key:0,icon:m(je),type:"primary",onClick:C},null,8,["icon"])):U("",!0),e(G,{size:25,class:"close",onClick:V[0]||(V[0]=()=>a.onClose())},{default:t(()=>[e(m(Aa))]),_:1})])]),c("div",vm,[c("div",_m,[c("div",fm,[e(J,{size:"small"},{default:t(()=>[e(w,{type:_.value=="cpu"?"success":"",onClick:V[1]||(V[1]=R=>b("cpu"))},{default:t(()=>[gm]),_:1},8,["type"]),e(w,{type:_.value=="memory"?"success":"",onClick:V[2]||(V[2]=R=>b("memory"))},{default:t(()=>[ym]),_:1},8,["type"])]),_:1})]),e(m(pv),{data:p.value,metrics:_.value},null,8,["data","metrics"])]),e(N,{data:te.value,"show-header":!1,"highlight-current-row":!1,"row-style":{"background-color":"#44464a",color:"white"},style:{width:"100%"},"cell-style":{background:"#44464a"}},{default:t(()=>[e(H,{prop:"key",width:"150"}),e(H,{prop:"value"},{default:t(R=>[c("div",{innerHTML:R.row.value},null,8,hm)]),_:1})]),_:1},8,["data"]),bm,(s(!0),P(oe,null,de(F.value,R=>(s(),P("div",{key:R.name},[c("div",wm,[Cm,c("span",null,D(R.name),1)]),e(N,{data:R.infos,"show-header":!1,"highlight-current-row":!1,"row-style":{"background-color":"#44464a",color:"white"},style:{width:"100%"},"cell-style":{background:"#44464a"}},{default:t(()=>[e(H,{prop:"key",width:"150"}),e(H,{prop:"value"},{default:t(O=>[c("div",{innerHTML:O.row.value},null,8,km)]),_:1})]),_:2},1032,["data"])]))),128)),$m,c("div",xm,[e(N,{data:u.value,"show-header":!1,"highlight-current-row":!1,"row-style":{"background-color":"#44464a",color:"white"},style:{width:"100%"},"cell-style":{background:"#44464a"}},{default:t(()=>[e(H,{prop:"reason",width:"170"},{default:t(R=>[R.row.firstTimestamp>0?(s(),y(I,{key:0,effect:"plain",size:"small",type:"info",style:{"margin-bottom":"5px"}},{default:t(()=>[v(D(m(ft)(R.row.firstTimestamp)),1)]),_:2},1024)):U("",!0),Vm,c("span",Sm,D(R.row.reason),1)]),_:1}),e(H,{prop:"value"},{default:t(R=>[c("div",{innerHTML:R.row.message,class:Be({warntext:R.row.type==="Warning",none:R.row.type!=="Warning"})},null,10,Dm)]),_:1})]),_:1},8,["data"]),e(A)])])]),_:1},8,["modelValue","before-close"])}}});var ja=ke(Im,[["__scopeId","data-v-64c7996e"]]);const Rm={class:"pod-array"},Nm=he({props:{containers:{required:!0,type:Array}},setup(l){const a=l,{containers:n}=ot(a);return(d,p)=>{const _=o("el-tooltip");return s(),P("div",Rm,[(s(!0),P(oe,null,de(m(n),u=>(s(),y(_,{class:"box-item",effect:"dark",placement:"top",key:u.name,content:u.status},{default:t(()=>[c("div",{class:Be(["pod",{success:u.status=="running",warn:u.status!="running"}])},null,2)]),_:2},1032,["content"]))),128))])}}});var Um=ke(Nm,[["__scopeId","data-v-7aeacdcc"]]);const Pm=l=>(Re("data-v-1d0130fa"),l=l(),Ne(),l),Am={class:"header"},Em={class:"function"},Tm={class:"body",tabindex:"-1"},Gm={class:"title"},Lm=Pm(()=>c("h4",null,"Container:",-1)),Om={class:"function"},zm=v("Long-term JSON Log"),Mm=v("Long-term non-JSON Log"),qm=["innerHTML"],Hm=he({props:{isOpen:{required:!0,type:Boolean},onClose:{required:!0,type:Function,coerce:l=>!0},cluster:{required:!0,type:String},namespace:{required:!0,type:String},pod:{required:!0,type:String},containers:{required:!0,type:Array}},setup(l){const a=l,n=i(a.isOpen),d=i(""),p=i(""),_=i(!1),u=i(!1);Pe(()=>a.isOpen,k=>{n.value=k}),Pe(()=>_.value||u.value,k=>{b(a.cluster,a.namespace,a.pod,a.containers[0])});const g=()=>{d.value=a.containers[0],T.value=a.containers.map(k=>({value:k,label:k})),b(a.cluster,a.namespace,a.pod,a.containers[0])},f=()=>{let k="";switch(a.cluster){case"e11k8s":case"e4k8s":case"e11pk8s":case"e4pk8s":k=`https://k.newegg.dev/esview/statistic/Logx/logx*:logx2_k8s_ns_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27${a.cluster}~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break;case"e11qk8s":k=`http://twbd.newegg.org:8008/esview/statistic/K8SGQC/logx2_k8s_ns_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27gqck8s~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break;case"e9k8s":k=`http://twbd.newegg.org:8008/esview/statistic/LogxDev/logx2_k8s_ns_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27${a.cluster}~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break}k!==""&&window.open(k,"_blank")},C=()=>{let k="";switch(a.cluster){case"e11k8s":case"e4k8s":case"e11pk8s":case"e4pk8s":k=`https://k.newegg.dev/esview/statistic/Logx/logx*:logx2_k8s_ns2_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27${a.cluster}~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break;case"e11qk8s":k=`http://twbd.newegg.org:8008/esview/statistic/K8SGQC/logx2_k8s_ns2_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27gqck8s~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break;case"e9k8s":k=`http://twbd.newegg.org:8008/esview/statistic/LogxDev/logx2_k8s_ns2_*/?last=60&stf=pod_name.keyword&f=~(~(key~%27location.keyword~name~%27location.keyword~compareOperator~%27*3d~value~%27${a.cluster}~logicalOperator~%27AND)~(key~%27pod_namespace.keyword~name~%27pod_namespace.keyword~compareOperator~%27*3d~value~%27${a.namespace}~logicalOperator~%27AND)~(key~%27pod_name.keyword~name~%27pod_name.keyword~compareOperator~%27*3d~value~%27${a.pod}~logicalOperator~%27AND))&tz=America/Los_Angeles`;break}k!==""&&window.open(k,"_blank")},r=k=>{!k||b(a.cluster,a.namespace,a.pod,k)},b=(k,S,x,E)=>{p.value="Loading...",Ae.GetPodLogs(k,S,x,E,_.value,u.value).then(z=>{const te=z.data.toString().replaceAll('\\"','"');p.value=te||"Not Found"}).catch(z=>{p.value="Can't get logs may be that POD has not ready!"})},T=i([]);return(k,S)=>{const x=o("el-icon"),E=o("el-option"),z=o("el-select"),te=o("el-checkbox"),F=o("el-tooltip"),h=o("el-button"),V=o("el-popover"),I=o("el-drawer");return s(),y(I,{modelValue:n.value,"onUpdate:modelValue":S[4]||(S[4]=w=>n.value=w),"with-header":!1,"show-close":!1,"before-close":()=>a.onClose(),"append-to-body":!0,onOpen:g,direction:"btt","custom-class":"drawer podlog",size:"50%"},{default:t(()=>[c("div",Am,[c("h3",null,"Pod Logs: "+D(a.pod),1),c("div",Em,[e(x,{size:25,class:"close",onClick:S[0]||(S[0]=()=>a.onClose())},{default:t(()=>[e(m(Aa))]),_:1})])]),c("div",Tm,[c("div",Gm,[Lm,e(z,{modelValue:d.value,"onUpdate:modelValue":S[1]||(S[1]=w=>d.value=w),class:"select",placeholder:"Containers",onChange:r},{default:t(()=>[(s(!0),P(oe,null,de(T.value,w=>(s(),y(E,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("div",Om,[e(te,{modelValue:_.value,"onUpdate:modelValue":S[2]||(S[2]=w=>_.value=w),label:"Show timestamp",name:"type"},null,8,["modelValue"]),e(F,{class:"box-item",effect:"dark",placement:"top",content:"Show previous log (if the Container has restarted)"},{default:t(()=>[e(te,{modelValue:u.value,"onUpdate:modelValue":S[3]||(S[3]=w=>u.value=w),label:"Show previous",name:"type"},null,8,["modelValue"])]),_:1}),e(F,{class:"box-item",effect:"dark",placement:"top",content:"View long-trem log in ESView"},{default:t(()=>[e(h,{type:"primary",round:"",onClick:f,size:"small"},{default:t(()=>[zm]),_:1})]),_:1}),e(V,{placement:"bottom-start",width:160,trigger:"click"},{reference:t(()=>[e(h,{icon:m(At),circle:"",size:"small"},null,8,["icon"])]),default:t(()=>[e(h,{type:"primary",round:"",onClick:C,size:"small"},{default:t(()=>[Mm]),_:1})]),_:1})])]),c("div",{class:"logs",innerHTML:p.value.split("\\n").map(w=>`<div>${w}</div>`).join("")},null,8,qm)])]),_:1},8,["modelValue","before-close"])}}});var ia=ke(Hm,[["__scopeId","data-v-1d0130fa"]]);class jm{constructor(){Ge(this,"limitsCpuHard");Ge(this,"limitsCpuUsed");Ge(this,"limitsMemoryHard");Ge(this,"limitsMemoryUsed");Ge(this,"podsHard");Ge(this,"podsUsed");Ge(this,"requestsCpuHard");Ge(this,"requestsCpuUsed");Ge(this,"requestsMemoryHard");Ge(this,"requestsMemoryUsed");Ge(this,"requestsStorageHard");Ge(this,"requestsStorageUsed")}}const jt=l=>(Re("data-v-3d252016"),l=l(),Ne(),l),Fm={class:"hpaedit"},Bm=jt(()=>c("h3",{style:{"margin-top":"10px"}},"HPA Setting",-1)),Km=jt(()=>c("h4",null,"Trigger Threshold",-1)),Wm=v("%"),Ym=v("%"),Jm=v("req/s"),Zm=v("req/s"),Qm=jt(()=>c("h4",null,"Replicas",-1)),Xm=v("Min"),ev=v("~ Max "),tv={key:0,style:{color:"red"}},av={key:1,style:{color:"red"}},lv={key:2},nv=jt(()=>c("h4",{style:{color:"gray"}},"Current Namespace Resource Limit",-1)),ov={class:"progress"},sv={class:"progress"},rv={class:"progress"},iv={key:3,class:"save",style:{"margin-top":"10px","margin-bottom":"0px"}},uv=v(" Save "),dv=he({props:{isOpen:{required:!0,type:Boolean},onClose:{required:!0,type:Function,coerce:l=>!0},cluster:{required:!0,type:String},namespace:{required:!0,type:String},service:{required:!0,type:String},hpa:{type:Object}},setup(l){const a=l,n=i(a.isOpen),d=i(null),p=i({minReplicas:0,maxReplicas:0,currentReplicas:0,setMetric:[],currentMetric:[],apiVersion:""}),_=a.hpa;Pe(()=>a.isOpen,k=>{n.value=k});const u=()=>{p.value=Ct({},a.hpa),Ae.GetNamespaceResource(a.cluster,a.namespace).then(k=>{if(!k.data.data.result||k.data.data.result.length==0)return;const S=g(k);d.value=S})},g=k=>{const S=k.data.data.result.map(E=>({[Pn(`${E.metric.resource.replace("."," ")} ${E.metric.type}`)]:E.value[1]})).reduce((E,z)=>Ct(Ct({},E),z),{});return Object.assign(new jm,S)},f=()=>{const k={apiVersion:p.value.apiVersion,namespace:a.namespace,hpaName:a.service,minReplicas:p.value.minReplicas,maxReplicas:p.value.maxReplicas,metrics:p.value.setMetric};Ae.UpdateHPA(a.cluster,k),n.value=!1,a.onClose()},C={cpu:{title:"CPU Threshold",content:"Most services use 300% : ({CPU limit}/{CPU Request}*100%)*0.75 ex:{1.6}/{0.4}*100%*0.75=300%"},memory:{title:"Memory Threshold",content:"Most services use 70% "},http_request_duration_seconds_count:{title:"Http Request Threshold",content:"Review to performance test results,How many requests per second each pod exceeds"}},r=k=>!!C[k],b=k=>C[k]?C[k].content:"",T=k=>C[k]?C[k].title:"";return(k,S)=>{const x=o("el-divider"),E=o("el-input"),z=o("el-form-item"),te=o("el-form"),F=o("el-col"),h=o("el-progress"),V=o("el-button"),I=o("el-dialog");return s(),P("div",Fm,[e(I,{modelValue:n.value,"onUpdate:modelValue":S[2]||(S[2]=w=>n.value=w),title:"HPA Edit","before-close":()=>a.onClose(),onOpen:u},{default:t(()=>[Bm,e(x,{style:{"margin-top":"0px","margin-bottom":"0px"}}),Km,p.value!=null&&p.value.setMetric!=null?(s(),y(te,{key:0,"label-width":"300px"},{default:t(()=>[(s(!0),P(oe,null,de(p.value.setMetric.filter(w=>w.type=="Resource"),w=>(s(),y(z,{key:w.resource.name},{label:t(()=>[v(D(w.resource.name)+" ",1),r(w.resource.name)?(s(),y(m(Ee),{key:0,title:T(w.resource.name),content:b(w.resource.name)},null,8,["title","content"])):U("",!0)]),default:t(()=>[p.value.apiVersion==="v2beta1"?(s(),y(E,{key:0,modelValue:w.resource.targetAverageUtilization,"onUpdate:modelValue":G=>w.resource.targetAverageUtilization=G,modelModifiers:{number:!0}},{append:t(()=>[Wm]),_:2},1032,["modelValue","onUpdate:modelValue"])):(s(),y(E,{key:1,modelValue:w.resource.target.averageUtilization,"onUpdate:modelValue":G=>w.resource.target.averageUtilization=G,modelModifiers:{number:!0}},{append:t(()=>[Ym]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},1024))),128)),(s(!0),P(oe,null,de(p.value.setMetric.filter(w=>w.type=="Pods"),(w,G)=>(s(),y(z,{key:G},el({default:t(()=>[p.value.apiVersion==="v2beta1"?(s(),y(E,{key:0,modelValue:w.pods.targetAverageValue,"onUpdate:modelValue":J=>w.pods.targetAverageValue=J},{append:t(()=>[Jm]),_:2},1032,["modelValue","onUpdate:modelValue"])):(s(),y(E,{key:1,modelValue:w.pods.target.averageValue,"onUpdate:modelValue":J=>w.pods.target.averageValue=J},{append:t(()=>[Zm]),_:2},1032,["modelValue","onUpdate:modelValue"]))]),_:2},[p.value.apiVersion==="v2beta1"?{name:"label",fn:t(()=>[v(D(w.pods.metricName)+" ",1),r(w.pods.metricName)?(s(),y(m(Ee),{key:0,title:T(w.pods.metricName),content:b(w.pods.metricName)},null,8,["title","content"])):U("",!0)])}:{name:"label",fn:t(()=>[v(D(w.pods.metric.name)+" ",1),r(w.pods.metric.name)?(s(),y(m(Ee),{key:0,title:T(w.pods.metric.name),content:b(w.pods.metric.name)},null,8,["title","content"])):U("",!0)])}]),1024))),128))]),_:1})):U("",!0),Qm,p.value!=null?(s(),y(te,{key:1,"label-width":"120px"},{default:t(()=>[e(z,{label:""},{default:t(()=>[e(F,{span:3,class:"text-center"},{default:t(()=>[c("span",null,[Xm,e(m(Ee),{title:"Min Replicas",content:"Minimum number of pods required"})])]),_:1}),e(F,{span:9},{default:t(()=>[e(E,{modelValue:p.value.minReplicas,"onUpdate:modelValue":S[0]||(S[0]=w=>p.value.minReplicas=w),modelModifiers:{number:!0}},{append:t(()=>[v("pods (limit:1-"+D(m(_).minReplicas*2)+")",1)]),_:1},8,["modelValue"])]),_:1}),e(F,{span:3,class:"text-center"},{default:t(()=>[c("span",null,[ev,e(m(Ee),{title:"Max Replicas",content:"Maximum number of pods,need to take into account the resource limit of the Namespace"})])]),_:1}),e(F,{span:9},{default:t(()=>[e(E,{modelValue:p.value.maxReplicas,"onUpdate:modelValue":S[1]||(S[1]=w=>p.value.maxReplicas=w),modelModifiers:{number:!0}},{append:t(()=>[v("pods (limit:"+D(p.value.minReplicas)+"-"+D(m(_).maxReplicas*2)+")",1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),p.value.maxReplicas>m(_).maxReplicas*2?(s(),P("div",tv,"Max value must be less or equal: "+D(m(_).maxReplicas*2),1)):U("",!0),p.value.minReplicas>m(_).minReplicas*2?(s(),P("div",av,"Min value must be less or equal: "+D(m(_).minReplicas*2),1)):U("",!0)]),_:1})):U("",!0),e(x,{style:{"margin-top":"0px","margin-bottom":"0px"}}),d.value!=null?(s(),P("div",lv,[nv,c("div",ov,[c("div",null,"CPU Limit: "+D(d.value.limitsCpuUsed)+"/"+D(d.value.limitsCpuHard)+" core",1),e(h,{percentage:parseInt((d.value.limitsCpuUsed/d.value.limitsCpuHard*100).toFixed(0))},null,8,["percentage"])]),c("div",sv,[c("div",null,"Memory Limit: "+D(d.value.limitsMemoryUsed/1024/1024/1024)+"/"+D(d.value.limitsMemoryHard/1024/1024/1024)+" Gi ",1),e(h,{percentage:parseInt((d.value.limitsMemoryUsed/d.value.limitsMemoryHard*100).toFixed(0))},null,8,["percentage"])]),c("div",rv,[c("div",null,"Pod Limit: "+D(d.value.podsUsed)+"/"+D(d.value.podsHard)+" pods",1),e(h,{percentage:parseInt((d.value.podsUsed/d.value.podsHard*100).toFixed(0))},null,8,["percentage"])])])):U("",!0),m(ie).getters.IsAdmin?(s(),P("div",iv,[e(V,{type:"primary",disabled:p.value.minReplicas<=0||p.value.maxReplicas<p.value.minReplicas||p.value.maxReplicas>m(_).maxReplicas*2||p.value.minReplicas>m(_).minReplicas*2,onClick:f},{default:t(()=>[uv]),_:1},8,["disabled"])])):U("",!0)]),_:1},8,["modelValue","before-close"])])}}});var Fa=ke(dv,[["__scopeId","data-v-3d252016"]]);const cv=he({props:{data:{required:!0,type:Array},metrics:{required:!0,type:String}},setup(l){const a=l;ql([Hl,jl,Fl,Bl,Kl,Wl,Yl]);const n=i();Va(()=>{let p=Jl(n.value);Pe(()=>a.data,u=>{if(u.length>0){const g=d(u,a.metrics);p.setOption(g),p.resize()}});const _=d(a.data,a.metrics);p.setOption(_),window.addEventListener("resize",()=>{p.resize()})});const d=(p,_)=>({backgroundColor:"#44464a",textStyle:{color:"#fff"},tooltip:{trigger:"item",valueFormatter:u=>`${_=="cpu"?parseFloat(u).toFixed(4):parseFloat(u)/1024/1024} ${_=="cpu"?"Core":"MB"}`},xAxis:{type:"time",axisLabel:{formatter:u=>`${ft(u)}`}},yAxis:{type:"value",axisLabel:{formatter:u=>`${_=="cpu"?parseFloat(u).toFixed(3):(parseFloat(u)/1024/1024).toFixed(1)}  ${_=="cpu"?"Core":"MB"}`}},series:[{data:p,type:"line"}]});return(p,_)=>(s(),P("div",{ref_key:"container",ref:n,class:"container"},null,512))}});var pv=ke(cv,[["__scopeId","data-v-03b0abba"]]);const mv=l=>(Re("data-v-412cf606"),l=l(),Ne(),l),vv=mv(()=>c("div",{class:"card-header"},[c("h3",null,"Pods")],-1)),_v={style:{"margin-left":"10px"}},fv={key:0,title:"scope.row.Status.errMsg",class:"warn"},gv={key:1,class:"success"},yv=v(" Log "),hv=v("Detail"),bv=he({props:{cluster:{required:!0,type:String},namespace:{required:!0,type:String},podList:{required:!0,type:Array}},setup(l){const[a,n]=[i(""),i([])],[d,p]=[i(!1),i(!1)],_=i([]),u=x=>{_.value=x},g=()=>{d.value=!1},f=()=>{p.value=!1},C=(x,E)=>{n.value=E,d.value=!0},r=(x,E)=>{a.value=x,n.value=k(E),d.value=!0},b=x=>{p.value=!0,a.value=x},T=x=>{const E=parseInt((new Date().getTime()/1e3).toFixed(0));return Ot(E-x)},k=x=>x.map(E=>E.name),S=x=>x.filter(E=>E.status==="running").length;return(x,E)=>{const z=o("el-table-column"),te=o("el-tag"),F=o("el-button"),h=o("el-table"),V=o("el-card");return s(),P("div",null,[e(V,{class:"box-card","body-style":{padding:"10px"}},{header:t(()=>[vv]),default:t(()=>[e(h,{ref:"multipleTableRef",data:l.podList,style:{width:"100%"},onSelectionChange:u},{default:t(()=>[e(z,{label:"Name","min-width":"180","show-overflow-tooltip":""},{default:t(I=>[c("span",_v,D(I.row.name),1)]),_:1}),e(z,{label:"Containers","min-width":"120"},{default:t(I=>[e(m(Um),{containers:I.row.container},null,8,["containers"])]),_:1}),e(z,{label:"Replicas","min-width":"80"},{default:t(I=>[c("span",{class:Be({warn:S(I.row.container)!==I.row.container.length,success:S(I.row.container)===I.row.container.length})},D(S(I.row.container))+"/"+D(I.row.container.length),3)]),_:1}),e(z,{label:"Restart","min-width":"80"},{default:t(I=>[c("span",{class:Be({warn:I.row.Status.restartCount>0})},D(I.row.Status.restartCount),3)]),_:1}),e(z,{label:"Ports","min-width":"100"},{default:t(I=>[(s(!0),P(oe,null,de(I.row.port,w=>(s(),P("div",{key:w.containerPort},[e(te,{class:"service-port",type:"info",size:"small"},{default:t(()=>[v(D(w.name)+":"+D(w.containerPort),1)]),_:2},1024)]))),128))]),_:1}),e(z,{label:"Age","min-width":"80"},{default:t(I=>[v(D(T(I.row.Status.startTime)),1)]),_:1}),e(z,{prop:"Status.state",label:"Status",width:"150"},{default:t(I=>[I.row.Status.errMsg!=""?(s(),P("span",fv,"Waring")):U("",!0),I.row.Status.errMsg==""?(s(),P("span",gv,D(I.row.Status.state),1)):U("",!0)]),_:1}),e(z,{width:"135"},{default:t(I=>[e(F,{type:"info",size:"small",round:"",onClick:w=>r(I.row.name,I.row.container)},{default:t(()=>[yv]),_:2},1032,["onClick"]),e(F,{type:"primary",size:"small",round:"",onClick:w=>b(I.row.name)},{default:t(()=>[hv]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(m(ia),{isOpen:m(d),onClose:g,cluster:l.cluster,namespace:l.namespace,pod:m(a),containers:m(n)},null,8,["isOpen","cluster","namespace","pod","containers"]),e(m(ja),{isOpen:m(p),onClose:f,onOpenLog:C,cluster:l.cluster,namespace:l.namespace,pod:m(a)},null,8,["isOpen","cluster","namespace","pod"])])}}});var wv=ke(bv,[["__scopeId","data-v-412cf606"]]);const Cv=l=>(Re("data-v-0ddcbe3a"),l=l(),Ne(),l),kv=Cv(()=>c("div",{class:"header-button"},[c("h3",{class:"first-header"},"Service")],-1)),$v={class:"ip"},xv={class:"ip"},Vv=he({props:{service:{type:Object}},setup(l){const a=l;return(n,d)=>{const p=o("el-table-column"),_=o("el-tag"),u=o("el-table"),g=o("el-card");return s(),P("div",null,[kv,e(g,{shadow:"always","body-style":{padding:"0px"},style:{"min-height":"50px"}},{default:t(()=>[a.service!==null?(s(),y(u,{key:0,data:[a.service],style:{width:"100%"}},{default:t(()=>[e(p,{prop:"type",label:"Type","min-width":"150"}),e(p,{label:"ClusterIP","min-width":"150"},{default:t(f=>[c("span",$v,D(f.row.clusterIp),1)]),_:1}),e(p,{prop:"statusLoadBalancer",label:"External IPs","min-width":"200","show-overflow-tooltip":""},{default:t(f=>[(s(!0),P(oe,null,de(f.row.statusLoadBalancer.ingress,C=>(s(),P("div",{key:C.ip},[c("span",xv,D(C.ip),1)]))),128))]),_:1}),e(p,{label:"Ports",width:"400","show-overflow-tooltip":""},{default:t(f=>[(s(!0),P(oe,null,de(f.row.ports,C=>(s(),P("div",{key:C.port},[e(_,{class:"service-port",type:"info",size:"small"},{default:t(()=>[v(D(C.port)+":"+D(C.targetPort)+"/"+D(C.name),1)]),_:2},1024)]))),128))]),_:1})]),_:1},8,["data"])):U("",!0)]),_:1})])}}});var Sv=ke(Vv,[["__scopeId","data-v-0ddcbe3a"]]);const Dv=l=>(Re("data-v-b9b4fdb0"),l=l(),Ne(),l),Iv={class:"header-button"},Rv=Dv(()=>c("h3",{class:"header"},"HPA",-1)),Nv=v("HPA Setting "),Uv=he({props:{cluster:{required:!0,type:String},namespace:{required:!0,type:String},service:{required:!0,type:String},hpa:{type:Object}},setup(l){const a=l,n=i(!1),d=(_,u,g)=>(console.log(u,g),_==="v2beta1"?g.map((f,C)=>{if(f.type=="Resource")return{metricName:f.resource.name,current:u&&u[C]&&u[C].resource?u[C].resource.currentAverageUtilization+"%":"",threshold:f.resource.targetAverageUtilization+"%"};if(f.type=="Pods")return{metricName:f.pods?f.pods.metricName:"",current:u&&u[C]&&u[C].pods?u[C].pods.currentAverageValue:"",threshold:f.pods?f.pods.targetAverageValue:""}}):g.map((f,C)=>{if(f.type=="Resource")return{metricName:f.resource.name,current:u&&u[C]&&u[C].resource?u[C].resource.current.averageUtilization+"%":"",threshold:f.resource.target.averageUtilization+"%"};if(f.type=="Pods")return{metricName:f.pods?f.pods.metric.name:"",current:u&&u[C]&&u[C].pods?u[C].pods.current.averageValue:"",threshold:f.pods?f.pods.target.averageValue:""}})),p=()=>{n.value=!1};return(_,u)=>{const g=o("el-button"),f=o("el-tooltip"),C=o("el-table-column"),r=o("el-tag"),b=o("el-table"),T=o("el-card");return s(),P("div",null,[c("div",Iv,[Rv,m(ie).getters.IsAdmin?(s(),y(f,{key:0,class:"box-item",effect:"dark",placement:"top",content:"Edit HPA Config"},{default:t(()=>[e(g,{type:"primary",size:"small",onClick:u[0]||(u[0]=k=>n.value=!0),disabled:a.hpa==null},{default:t(()=>[Nv]),_:1},8,["disabled"])]),_:1})):U("",!0)]),e(T,{shadow:"always","body-style":{padding:"0px","min-height":"50px"}},{default:t(()=>[a.hpa!=null?(s(),y(b,{key:0,data:[a.hpa],style:{width:"100%"}},{default:t(()=>[e(C,{prop:"minReplicas",label:"Min","min-width":"50"}),e(C,{prop:"maxReplicas",label:"Max","min-width":"50"}),e(C,{prop:"currentReplicas",label:"Current","min-width":"50"}),e(C,{label:"Metrics  (Name | Current/Target)","min-width":"150"},{default:t(k=>[(s(!0),P(oe,null,de(d(k.row.apiVersion,k.row.currentMetric,k.row.setMetric),S=>(s(),P("div",{key:S.metricName},[e(r,{class:"service-port",type:"info",size:"small"},{default:t(()=>[v(D(S.metricName)+"|"+D(S.current)+"/"+D(S.threshold),1)]),_:2},1024)]))),128))]),_:1})]),_:1},8,["data"])):U("",!0)]),_:1}),e(m(Fa),{isOpen:n.value,onClose:p,cluster:a.cluster,namespace:a.namespace,service:a.service,hpa:a.hpa},null,8,["isOpen","cluster","namespace","service","hpa"])])}}});var Pv=ke(Uv,[["__scopeId","data-v-b9b4fdb0"]]);const Av=l=>(Re("data-v-395b93f1"),l=l(),Ne(),l),Ev=Av(()=>c("h3",{class:"header"},"Ingress",-1)),Tv=["onClick"],Gv=he({props:{ingress:{type:Object}},setup(l){const a=l,n=d=>{window.open(`http://${d}`,"_blank")};return(d,p)=>{const _=o("el-table-column"),u=o("el-table"),g=o("el-card");return s(),P("div",null,[Ev,e(g,{shadow:"always","body-style":{padding:"0px","min-height":"50px"}},{default:t(()=>[a.ingress!=null?(s(),y(u,{key:0,data:a.ingress.rules,style:{width:"100%"}},{default:t(()=>[e(_,{label:"Host","min-width":"150","show-overflow-tooltip":""},{default:t(f=>[c("span",{class:"host",onClick:C=>n(f.row.host)},D(f.row.host),9,Tv)]),_:1}),e(_,{label:"IPs","min-width":"130"},{default:t(f=>[(s(!0),P(oe,null,de(a.ingress.status.ingress,C=>(s(),P("div",{key:C.ip},D(C.ip),1))),128))]),_:1}),e(_,{prop:"path",label:"Path","min-width":"120","show-overflow-tooltip":""},{default:t(f=>[c("span",null,D(f.row.http.paths[0].path),1)]),_:1}),e(_,{label:"backend","min-width":"130","show-overflow-tooltip":""},{default:t(f=>[c("span",null,D(f.row.http.paths[0].backend.serviceName),1)]),_:1})]),_:1},8,["data"])):U("",!0)]),_:1})])}}});var Lv=ke(Gv,[["__scopeId","data-v-395b93f1"]]);const Ov=l=>(Re("data-v-24084628"),l=l(),Ne(),l),zv={class:"meta"},Mv=Ov(()=>c("h3",null,"Meta Info",-1)),qv=["innerHTML"],Hv=he({props:{serviceDetail:{required:!0,type:Object}},setup(l){const a=l,n=_=>{const u=parseInt((new Date().getTime()/1e3).toFixed(0));return Ot(u-_)},d=_=>_?Object.keys(_).map(u=>{if(!u.startsWith("k0s.app."))return`<div class="el-tag el-tag--light">${u}=${_[u]}</div>`}).filter(u=>u&&u.trim()).join("<br/>"):"",p=[{key:"Created",value:n(a.serviceDetail.createTime)},{key:"Image",value:a.serviceDetail.image},{key:"Labels",value:d(a.serviceDetail.labels)},{key:"Owner",value:a.serviceDetail.owner}];return(_,u)=>{const g=o("el-table-column"),f=o("el-table"),C=o("el-card");return s(),P("div",zv,[Mv,e(C,{shadow:"always","body-style":{padding:"12px","min-height":"182px"}},{default:t(()=>[e(f,{data:p,"show-header":!1,style:{width:"100%",height:"100%"}},{default:t(()=>[e(g,{prop:"key",width:"100"}),e(g,{prop:"value"},{default:t(r=>[c("div",{innerHTML:r.row.value},null,8,qv)]),_:1})]),_:1})]),_:1})])}}});var jv=ke(Hv,[["__scopeId","data-v-24084628"]]);const ua=l=>(Re("data-v-206b6a60"),l=l(),Ne(),l),Fv={class:"ns-container"},Bv=ua(()=>c("div",null,[c("h1",null,"Namespaces")],-1)),Kv={style:{display:"flex"}},Wv=ua(()=>c("span",{style:{"margin-right":"30px"}}," Cluster ",-1)),Yv=ua(()=>c("span",{style:{"vertical-align":"middle"}},"Add Namespace",-1)),Jv={class:"ns-table"},Zv={key:0},Qv={key:0},Xv=v("Yes"),e_=v("No"),t_={key:0},a_=v(" Edit "),l_=v(" Delete "),n_={style:{margin:"6px"}},o_=v("Key"),s_=v("Value"),r_={class:"dialog-footer"},i_={style:{"margin-right":"10px"}},u_=v("Cancel"),d_=v("Apply"),c_=he({setup(l){const a=Qe({cluster:"",keyword:""}),n=i(Array()),d=i([]),p=i(),_=i(),u=i(!1),g=i(!1),f=i(!0),C=i("Add Namespace"),r=i({name:"",cluster:"",labels:[{key:"owner",value:""}]}),b=new RegExp(/^[a-z0-9]([-a-z0-9]*[a-z0-9])?/),T=new RegExp(/^[a-zA-Z0-9][-A-Za-z0-9/_.]*[a-zA-Z0-9]$/),k=new RegExp(/^[a-zA-Z0-9][-A-Za-z0-9_.]*[a-zA-Z0-9]$/),S=(W,B,Z)=>{d.value.some(ae=>ae.name===B)&&!g.value?Z(new Error('The namespace "'+B+'" already exists')):b.test(B)?Z():Z(new Error("The namespace is invalid,regex used for validation is '^[a-z0-9]([-a-z0-9]*[a-z0-9])?'"))},x=(W,B,Z)=>{T.test(B)?r.value.labels.filter((X,ae)=>X.key===B).length>1?Z(new Error("The key is already exist")):Z():Z(new Error("The key is invalid,regex used for validation is '^[a-zA-Z0-9][-A-Za-z0-9/_.]*[a-zA-Z0-9]$'"))},E=(W,B,Z)=>{k.test(B)?Z():Z(new Error("The  is invalid,regex used for validation is '^[a-zA-Z0-9][-A-Za-z0-9_.]{0,58}[a-zA-Z0-9]$'"))},z=Qe([{required:!0,message:"Key can not be null",trigger:"blur"},{min:2,max:50,message:"Length should be 2 to 50",trigger:"blur"},{validator:x,trigger:"blur"}]),te=Qe([{required:!0,message:"Value can not be null",trigger:"blur"},{min:2,max:50,message:"Length should be 2 to 50",trigger:"blur"},{validator:E,trigger:"blur"}]),F=Qe({name:[{required:!0,message:"Please input Namespace name",trigger:"blur"},{min:2,max:50,message:"Length should be 2 to 50",trigger:"blur"},{validator:S,trigger:"blur"}]}),h=nt(()=>{var W;return(W=r.value.cluster)==null?void 0:W.toUpperCase()}),V=()=>{C.value="Add Namespace",r.value.cluster=a.cluster,r.value.name="",r.value.labels=[{key:"owner",value:""}],u.value=!0,g.value=!1},I=()=>{u.value=!1,p.value.resetFields()},w=()=>{I()},G=async W=>{!W||await W.validate(B=>{B&&(g.value?Dt.UpdateNamespace(r.value).then(Z=>{var X,ae;Z&&Ze((ae=(X=Z.data)==null?void 0:X.msg)!=null?ae:"Update namespace success.")}):Dt.InsertNamespace(r.value).then(Z=>{var X,ae;Z&&Ze((ae=(X=Z.data)==null?void 0:X.msg)!=null?ae:"Create namespace success.")}),I(),setTimeout(()=>{L()},1500))})},J=(W,B)=>{W>=0&&(r.value.labels.splice(W,1),H(B))},H=W=>{W&&W.validate(()=>{})},N=()=>{r.value.labels.push({key:"",value:""})},A=W=>{C.value="Edit Namespace",u.value=!0,g.value=!0,r.value.cluster=a.cluster,r.value.name=W.name,r.value.labels=[],Object.keys(W.labels).map(B=>{r.value.labels.push({key:B,value:W.labels[B]})})},Y=W=>{const B=W==null?void 0:W.name;B&&(Jt("Delete the Namespace [ "+B+" ]?").then(()=>{Dt.DeleteNamespace(a.cluster,B).then(Z=>{var X;Ze((X=Z.msg)!=null?X:"Delete success.")})}),setTimeout(()=>{L()},1500))},R=()=>{L(!1)},O=()=>{L(!1)};ze(()=>{$(),_.value=setInterval(()=>{L()},5e3)}),Vt(()=>{_.value&&clearInterval(_.value)});const $=async()=>{const W=await Oe.GetClusterInfo(),B=W==null?void 0:W.data.envs;n.value=Object.keys(B).map(Z=>({name:Z})),n.value&&n.value.length>0&&(a.cluster=n.value[0].name,await L(!1))},L=async W=>{const B={disableLoading:W!=null?W:!0,params:{cluster:a.cluster}};a.cluster&&Dt.GetNamespaces(B).then(Z=>{d.value=Z.data,a.keyword&&(d.value=d.value.filter(X=>X.name.indexOf(a.keyword)!=-1)),d.value.sort((X,ae)=>X.name.localeCompare(ae.name)),d.value.forEach(X=>{X.labels&&Object.keys(X.labels).filter(ae=>ae!=="owner"&&ae!=="name").map(ae=>{X.showLabels||(X.showLabels=new Object),X.showLabels[ae]=X.labels[ae]})})})};return(W,B)=>{const Z=o("el-option"),X=o("el-select"),ae=o("el-form-item"),j=o("el-button"),K=o("el-input"),M=o("el-form"),se=o("el-table-column"),be=o("el-tag"),Ve=o("el-tooltip"),ve=o("el-table"),le=o("el-col"),Se=o("el-row"),ge=o("el-card"),ne=o("el-dialog");return s(),P("div",Fv,[Bv,e(M,{onSubmit:B[3]||(B[3]=Fe(ee=>R(),["prevent"]))},{default:t(()=>[c("div",Kv,[e(ae,null,{default:t(()=>[e(X,{modelValue:m(a).cluster,"onUpdate:modelValue":B[0]||(B[0]=ee=>m(a).cluster=ee),onChange:O,placeholder:"Select Cluster..."},{prefix:t(()=>[Wv]),default:t(()=>[(s(!0),P(oe,null,de(n.value,ee=>{var Q;return s(),y(Z,{label:(Q=ee.name)==null?void 0:Q.toUpperCase(),value:ee.name},null,8,["label","value"])}),256))]),_:1},8,["modelValue"])]),_:1}),e(ae,{style:{width:"800px"}},{default:t(()=>[e(K,{clearable:"",style:{width:"100%"},modelValue:m(a).keyword,"onUpdate:modelValue":B[1]||(B[1]=ee=>m(a).keyword=ee),modelModifiers:{trim:!0},placeholder:"Enter Namespace name",onKeyup:B[2]||(B[2]=et(ee=>R(),["enter","native"]))},{append:t(()=>[e(j,{icon:m(tt),"native-type":"submit"},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),m(ie).getters.IsAdmin?(s(),y(ae,{key:0,style:{"margin-left":"10px"}},{default:t(()=>[e(j,{type:"primary",onClick:V,plain:"",icon:m(Me)},{default:t(()=>[Yv]),_:1},8,["icon"])]),_:1})):U("",!0)])]),_:1}),c("div",Jv,[e(ve,{data:d.value,border:"",stripe:"","table-layout":"fixed"},{default:t(()=>[e(se,{type:"index",align:"center"}),e(se,{prop:"name",label:"Name",width:"220px"}),e(se,{label:"Labels"},{default:t(ee=>[ee.row.showLabels?(s(),P("div",Zv,[(s(!0),P(oe,null,de(ee.row.showLabels,(Q,_e)=>(s(),y(be,{style:{margin:"3px"},type:"info"},{default:t(()=>[v(D(_e)+"="+D(Q),1)]),_:2},1024))),256))])):U("",!0)]),_:1}),e(se,{align:"center",label:"LabelName",width:"100px"},{default:t(ee=>{var Q,_e;return[(_e=(Q=ee.row)==null?void 0:Q.labels)!=null&&_e.name?(s(),P("div",Qv,[ee.row.labels.name===ee.row.name?(s(),y(Ve,{key:0,class:"box-item",effect:"dark",content:ee.row.labels.name,placement:"top"},{default:t(()=>[e(be,null,{default:t(()=>[Xv]),_:1})]),_:2},1032,["content"])):U("",!0),ee.row.labels.name!==ee.row.name?(s(),y(Ve,{key:1,class:"box-item",effect:"dark",content:ee.row.labels.name,placement:"top"},{default:t(()=>[e(be,{type:"danger"},{default:t(()=>[e_]),_:1})]),_:2},1032,["content"])):U("",!0)])):U("",!0)]}),_:1}),e(se,{align:"center",label:"Owner",width:"140px"},{default:t(ee=>{var Q,_e;return[(_e=(Q=ee.row)==null?void 0:Q.labels)!=null&&_e.owner?(s(),P("div",t_,D(ee.row.labels.owner),1)):U("",!0)]}),_:1}),e(se,{prop:"createTime",align:"center",label:"Age",width:"140px"},{default:t(ee=>[e(Nt,{timestamp:ee.row.createTime},null,8,["timestamp"])]),_:1}),e(se,{label:"Status",align:"center",width:"130px"},{default:t(ee=>[e(be,{type:ee.row.status==="Active"?"success":"danger"},{default:t(()=>[v(D(ee.row.status),1)]),_:2},1032,["type"])]),_:1}),e(se,{label:"Operate",align:"center",width:"180px"},{default:t(ee=>[e(j,{size:"small",onClick:Q=>A(ee.row)},{default:t(()=>[a_]),_:2},1032,["onClick"]),e(j,{size:"small",type:"danger",onClick:Q=>Y(ee.row)},{default:t(()=>[l_]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),e(ne,{modelValue:u.value,"onUpdate:modelValue":B[7]||(B[7]=ee=>u.value=ee),title:C.value,width:"50%",top:"8vh",onClose:I},{footer:t(()=>[c("span",r_,[c("div",i_,[e(j,{onClick:w},{default:t(()=>[u_]),_:1}),e(j,{type:"primary",onClick:B[6]||(B[6]=ee=>G(p.value))},{default:t(()=>[d_]),_:1})])])]),default:t(()=>[c("div",n_,[e(M,{rules:m(F),"inline-message":f.value,ref_key:"dialogRuleFormRef",ref:p,model:r.value,"label-width":"80px"},{default:t(()=>[e(Se,{style:{"justify-content":"space-between","align-items":"center"}},{default:t(()=>[e(le,{span:24},{default:t(()=>[e(ae,{label:"Cluster",prop:"cluster"},{default:t(()=>[e(K,{disabled:"",modelValue:m(h),"onUpdate:modelValue":B[4]||(B[4]=ee=>Qt(h)?h.value=ee:null)},null,8,["modelValue"])]),_:1}),e(ae,{label:"Name",prop:"name"},{default:t(()=>[e(K,{disabled:g.value,placeholder:"Input Namespace name",modelValue:r.value.name,"onUpdate:modelValue":B[5]||(B[5]=ee=>r.value.name=ee)},null,8,["disabled","modelValue"])]),_:1})]),_:1}),e(le,{span:24},{default:t(()=>[e(ae,{label:"Label",prop:"labels"},{default:t(()=>[e(ge,{shadow:"hover",class:"labels"},{default:t(()=>[(s(!0),P(oe,null,de(r.value.labels,(ee,Q)=>(s(),y(Se,{style:{"margin-bottom":"16px"},gutter:10},{default:t(()=>[e(le,{span:11},{default:t(()=>[e(ae,{rules:m(z),prop:`labels.${Q}.key`},{default:t(()=>[e(K,{modelValue:r.value.labels[Q].key,"onUpdate:modelValue":_e=>r.value.labels[Q].key=_e},{prepend:t(()=>[o_]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(le,{span:11},{default:t(()=>[e(ae,{rules:m(te),prop:`labels.${Q}.value`},{default:t(()=>[e(K,{modelValue:r.value.labels[Q].value,"onUpdate:modelValue":_e=>r.value.labels[Q].value=_e},{prepend:t(()=>[s_]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules","prop"])]),_:2},1024),e(le,{span:2},{default:t(()=>[e(j,{onClick:_e=>J(Q,p.value),type:"danger",icon:m(je),plain:""},null,8,["onClick","icon"])]),_:2},1024)]),_:2},1024))),256)),e(Se,null,{default:t(()=>[e(le,{span:22},{default:t(()=>[e(j,{icon:m(Me),onClick:N,style:{width:"100%","margin-top":"10px"},type:"primary",plain:""},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["rules","inline-message","model"])])]),_:1},8,["modelValue","title"])])}}});var p_=ke(c_,[["__scopeId","data-v-206b6a60"]]);const m_={class:"close"},v_=v(" Close "),__=he({props:{isOpen:{required:!0,type:Boolean},onClose:{required:!0,type:Function,coerce:l=>!0},cluster:{required:!0,type:String},namespace:{required:!0,type:String},service:{required:!0,type:String}},setup(l){const a=l,n=i(a.isOpen),d=i(),p=i(1),_=i(0);Pe(()=>a.isOpen,f=>{n.value=f});const u=f=>{_.value=f,Ae.GetEvents(a.cluster,a.namespace,"all",a.service,10,f).then(C=>{d.value=C.data.events,p.value=C.data.pageTotal,_.value=C.data.pageIndex})},g=()=>{Ae.GetEvents(a.cluster,a.namespace,"all",a.service,10,1).then(f=>{d.value=f.data.events,p.value=f.data.pageTotal,_.value=f.data.pageIndex})};return(f,C)=>{const r=o("el-table-column"),b=o("el-tag"),T=o("el-table"),k=o("el-pagination"),S=o("el-button"),x=o("el-dialog");return s(),y(x,{modelValue:n.value,"onUpdate:modelValue":C[1]||(C[1]=E=>n.value=E),title:"Events Viewer","before-close":()=>a.onClose(),onOpen:g,width:"80%"},{default:t(()=>[e(T,{data:d.value,style:{width:"100%"}},{default:t(()=>[e(r,{prop:"involvedObject.kind",label:"Kind",width:"180"}),e(r,{label:"FirstTimestamp",width:"150"},{default:t(E=>[e(b,{size:"small"},{default:t(()=>[v(D(m(ft)(E.row.firstTimestamp)),1)]),_:2},1024)]),_:1}),e(r,{prop:"type",label:"Type",width:"100"},{default:t(E=>[e(b,{type:E.row.type==="Normal"?"success":"warning",size:"small"},{default:t(()=>[v(D(E.row.type),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"reason",label:"Reason",width:"220"}),e(r,{prop:"message",label:"Message"})]),_:1},8,["data"]),c("div",m_,[e(k,{layout:"prev, pager, next","page-size":10,total:p.value,onCurrentChange:u},null,8,["total"]),e(S,{type:"primary",onClick:C[0]||(C[0]=()=>a.onClose())},{default:t(()=>[v_]),_:1})])]),_:1},8,["modelValue","before-close"])}}});var f_=ke(__,[["__scopeId","data-v-28435d51"]]);const g_=l=>(Re("data-v-b5f21cc6"),l=l(),Ne(),l),y_=g_(()=>c("span",null,"Loading... Please wait.",-1)),h_=he({setup(l){Ue();const a=ie.getters.IsLogin,n=i(!1),d=i(""),p=i({groups:[],services:[]});ze(()=>{let g=document.getElementsByClassName("input-sm")[0];g&&(g.addEventListener("focus",()=>{_(!0)}),g.addEventListener("blur",()=>{_(!1)}),setTimeout(()=>{vt.EnableSearchPanel(f=>{d.value=f,n.value=!0,qe.GlobalSearch(f).then(C=>{p.value=C})})},2e3))});const _=g=>{setTimeout(()=>{g?n.value=!0:(vt.ClearSearchValue(),d.value="",n.value=!1)},200)},u=()=>{ie.commit("setWindowWidth",window.innerWidth),ie.commit("setWindowHeight",window.innerHeight)};return window.addEventListener("resize",u),Vt(()=>{window.removeEventListener("resize",u)}),(g,f)=>{const C=o("router-view"),r=o("el-main"),b=o("el-container");return m(a)?(s(),y(b,{key:0,class:"el-container"},{default:t(()=>[e(m(Xp)),e(r,null,{default:t(()=>[(s(),y(tl,null,{default:t(()=>[e(C)]),fallback:t(()=>[y_]),_:1}))]),_:1}),e(m(Xo),{enabled:n.value,keywords:d.value,globalSearchData:p.value},null,8,["enabled","keywords","globalSearchData"])]),_:1})):U("",!0)}}});var b_=ke(h_,[["__scopeId","data-v-b5f21cc6"]]);const w_=[{path:"/crd-manage/crd",name:"crd",component:Ds,meta:{needAdmin:!0,title:"Crd-List"}},{path:"/crd-manage/service",name:"cr",component:qs,meta:{needAdmin:!0,title:"Crd-Service"}},{path:"/crd-manage/crd-redeploy",name:"crd-redeploy",component:ar,meta:{needAdmin:!0,title:"Crd-Service-ReDeploy"}}],C_=[{path:"/namespaces",name:"namespaces",component:p_,meta:{needAdmin:!0,title:"Namespace"}}],k_=[{path:"/",redirect:"dashboard",meta:{title:"Dashboard"}},{path:"/dashboard",name:"dashboard",component:Nn,meta:{title:"Dashboard"}},...w_,...C_,{path:"/service-management",name:"service-management",component:fr,meta:{title:"Group-List"}},{path:"/service-management/group/:id/edit",name:"edit-group",props:!0,component:ka,meta:{title:"Group-Edit"}},{path:"/service-management/group/new",name:"new-group",component:ka,meta:{title:"Group-New"}},{path:"/service-management/:gId/service",name:"service-list",component:qr,meta:{title:"Service-List"}},{path:"/service-management/:gId/service/:sId/detail",name:"service-detail",component:di,children:[{path:"base",name:"service-base",component:$a,meta:{title:"Service-Base"}},{path:"version/:vId",name:"version-detail",component:Zu,meta:{title:"Version-Detail"}},{path:"version",name:"version-list",component:ud,meta:{title:"Version-List"}},{path:"instance",name:"service-instance",component:Gp,meta:{title:"Service-Instance"}},{path:"activity",name:"service-activity",component:Hp,meta:{title:"Service-Activity"}}]},{path:"/service-management/:gId/service/new",name:"service-create",component:$a,meta:{title:"Service-New"}},{path:"/service-explorer",name:"serviceexplorer",component:ha,meta:{title:"ServiceExplorer"}},{path:"/service-explorer/:cluster/:namespace",name:"serviceexplorer-params",component:ha,meta:{title:"ServiceExplorer"}},{path:"/service-detail/:cluster/:namespace/:service/:realName",name:"servicedetail",component:ba,meta:{title:"ServiceExplorer-Detail"}},{path:"/service-detail/:cluster/:namespace/:service/:realName/:canaryName",name:"servicedetail-canary",component:ba,meta:{title:"ServiceExplorer-Detail"}},{path:"/401",name:"401",component:Ro,meta:{title:"401"}},{path:"/:pathMatch(.*)*",name:"404",component:Lo,meta:{title:"404"}}],da=rl({history:il("/"),routes:k_});da.beforeEach(async(l,a,n)=>["404","401"].indexOf((l.name||"").toString())!==-1?n():l.meta.needAdmin===!0&&!ie.getters.IsAdmin?n("401"):n());const $_="K0S";da.afterEach((l,a,n)=>{window.document.title=l.meta.title?l.meta.title+" - K0S":$_});const Ba=al(b_);Ba.use(sl,ie);ie.dispatch("login").finally(()=>{Ba.use(da).mount("#app")});
